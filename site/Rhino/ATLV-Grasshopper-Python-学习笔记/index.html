
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A new project generated from the default template project.">
      
      
        <meta name="author" content="Alex">
      
      
      
        <link rel="prev" href="../Grasshooper%E5%85%A5%E9%97%A8%E4%B8%8E%E6%8F%90%E9%AB%98/">
      
      
        <link rel="next" href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A01%E8%8A%82/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.ico">
      <meta name="generator" content="zensical-0.0.15">
    
    
      
        <title>ATLV Grasshopper Python 学习笔记 - Alex The Creator</title>
      
    
    
      
        
      
      <link rel="stylesheet" href="../../assets/stylesheets/modern/main.f1b6466b.min.css">
      
        
          
        
        <link rel="stylesheet" href="../../assets/stylesheets/modern/palette.dfe2e883.min.css">
      
      
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  
  <style>:root{}</style>



  
  
    
      
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
    
      
      
        
      
      
    
  
  
  <style>:root{.md-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20fill%3D%22none%22%20stroke%3D%22currentColor%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20stroke-width%3D%222%22%20class%3D%22lucide%20lucide-hash%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M4%209h16M4%2015h16M10%203%208%2021M16%203l-2%2018%22/%3E%3C/svg%3E');}.md-tag.md-tag--life{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M360%200c13.3%200%2024%2010.7%2024%2024v19c0%2040.3%2016%2079%2044.5%20107.5l21%2021C469%20191%20480%20217.4%20480%20245v19c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-19c0-14.9-5.9-29.1-16.4-39.6l-21-21C357.1%20146.9%20336%2096%20336%2043V24c0-13.3%2010.7-24%2024-24m192%20288c-13.3%200-24-10.7-24-24v-19c0-40.3-16-79-44.5-107.5l-21-21C443%2097%20432%2070.6%20432%2043V24c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v19c0%2014.9%205.9%2029.1%2016.4%2039.6l21%2021C554.9%20141.1%20576%20192%20576%20245v19c0%2013.3-10.7%2024-24%2024M320%20448h96v-32h-96zM0%20416c0-35.3%2028.7-64%2064-64h384c17.7%200%2032%2014.3%2032%2032v96c0%2017.7-14.3%2032-32%2032H64c-35.3%200-64-28.7-64-64zm576-40v112c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24V376c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024%22/%3E%3C/svg%3E');}.md-tag.md-tag--py{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M439.8%20200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0%2036.8-31.2%2067.8-66.8%2067.8H172.7c-29.2%200-53.4%2025-53.4%2054.3v101.8c0%2029%2025.2%2046%2053.4%2054.3%2033.8%209.9%2066.3%2011.7%20106.8%200%2026.9-7.8%2053.4-23.5%2053.4-54.3v-40.7H226.2v-13.6h160.2c31.1%200%2042.6-21.7%2053.4-54.2%2011.2-33.5%2010.7-65.7%200-108.6M286.2%20444.7a20.4%2020.4%200%201%201%200-40.7%2020.4%2020.4%200%201%201%200%2040.7M167.8%20248.1h106.8c29.7%200%2053.4-24.5%2053.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2%208-53.4%2024.7-53.4%2055.6v40.7h106.9v13.6h-147c-31.1%200-58.3%2018.7-66.8%2054.2-9.8%2040.7-10.2%2066.1%200%20108.6%207.6%2031.6%2025.7%2054.2%2056.8%2054.2H101v-48.8c0-35.3%2030.5-66.4%2066.8-66.4m-6.6-183.4a20.4%2020.4%200%201%201%200%2040.8%2020.4%2020.4%200%201%201%200-40.8%22/%3E%3C/svg%3E');}.md-tag.md-tag--rhino{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M6.823%203.103q-.15%200-.34.017c-.511.044-1.25.18-1.802.329a6.3%206.3%200%200%200-1.15.42c-.231.112-.33.178-.354.273-.023.094.028.217.16.436s.346.533.535.961.356.97.361%201.651c.006.68-.149%201.5-.245%201.962s-.133.568-.227.618-.245.044-.525-.021c-.281-.065-.69-.187-1.1-.259s-.819-.093-1.122-.038c-.304.056-.504.189-.645.369-.14.18-.224.406-.282.75A7%207%200%200%200%200%2011.687c.005.317.047.49.136.584.088.094.223.109.492.054s.672-.18%201.224-.215a6.3%206.3%200%200%201%201.94.202c.685.182%201.353.49%201.95.93.598.438%201.127%201.007%201.566%201.593.438.586.787%201.189%201.004%201.541.217.353.304.455.372.42s.117-.207.145-.417a3.1%203.1%200%200%200-.02-.848%207.5%207.5%200%200%200-.32-1.365%205.6%205.6%200%200%200-.495-1.018c-.146-.247-.241-.408-.245-.51s.085-.148.51-.315c.424-.167%201.185-.457%201.958-.808s1.556-.764%202.042-1.106c.486-.341.674-.61.724-.937.05-.326-.039-.71-.16-1.076a7%207%200%200%200-.529-1.193A14%2014%200%200%200%2011.28%205.6a9%209%200%200%200-1.1-1.236c-.282-.255-.421-.31-.51-.29s-.131.115-.168.47c-.037.356-.07.973-.144%201.559a7.5%207.5%200%200%201-.432%201.773%2012.5%2012.5%200%200%201-.99%201.982c-.388.64-.803%201.212-1.054%201.462-.25.25-.336.18-.477.064l-.486-.4c-.15-.125-.253-.213-.273-.293s.045-.15.27-.448c.227-.299.615-.825.96-1.478a7.8%207.8%200%200%200%20.796-2.282%2010%2010%200%200%200%20.095-2.338c-.044-.564-.124-.77-.306-.896-.137-.095-.332-.146-.638-.146m6.48%207.034h-.012c-.084.01-.192.112-.415.294a7%207%200%200%201-1.017.7c-.458.257-1.038.507-1.51.734-.47.226-.831.429-1.004.712-.172.283-.155.648.04.85.194.204.566.246.883.259s.58-.002.826.087c.246.09.475.285.764.516.288.23.637.498.925.561s.518-.079.766-.202c.249-.124.516-.23.888-.225.371.005.847.12%201.318.37.47.248.938.63%201.184.866.247.236.272.327.245.362-.028.036-.108.018-.304-.14-.196-.157-.508-.454-.917-.688s-.916-.404-1.4-.391c-.482.013-.94.21-1.23.55s-.412.822-.546%201.164c-.133.341-.28.543-.47.617s-.424.02-.703-.099c-.28-.12-.604-.307-.874-.442-.269-.136-.484-.22-.62-.353s-.195-.31-.203-.571c-.01-.26.032-.6.05-.853.02-.25.018-.413-.038-.56a1.1%201.1%200%200%200-.232-.35c-.07-.07-.099-.075-.113-.058s-.012.058.01.158c.023.1.067.26.05.581-.019.321-.098.803-.16%201.17s-.107.618-.02.808.306.322.707.54c.4.22.982.527%201.518.855.537.327%201.027.673%201.562%201.089.534.415%201.112.9%201.5%201.238.39.339.588.532.742.59.154.059.264-.018.307-.138.044-.12.023-.285-.014-.429a1.2%201.2%200%200%200-.24-.46%205%205%200%200%200-.68-.704c-.287-.243-.614-.463-.803-.614s-.242-.233-.212-.259.14.004.302.108c.162.103.375.28.612.459.237.178.499.356.733.584.235.228.443.506.583.706.14.201.214.324.294.372.08.049.165.022.277-.05a3%203%200%200%200%20.426-.355c.178-.169.398-.393.551-.633s.242-.496.299-.772.08-.572.247-.862.476-.574.994-1.025%201.244-1.07%201.891-1.664c.648-.595%201.216-1.165%201.696-1.802.479-.638.87-1.342%201.067-1.743.199-.4.205-.498.14-.526-.063-.027-.198.015-.61.313-.414.297-1.106.849-1.886%201.43-.781.58-1.65%201.19-2.336%201.569-.686.378-1.19.524-1.55.562-.361.037-.58-.034-.724-.11-.143-.077-.21-.158-.224-.241-.013-.084.03-.17.135-.275s.277-.232.447-.392.338-.354.468-.556.22-.411.261-.592.034-.333-.04-.376-.215.023-.376.11c-.162.086-.343.192-.593.3a2.7%202.7%200%200%201-.92.235%201.63%201.63%200%200%201-1.088-.313c-.343-.26-.635-.71-.866-1.147s-.398-.865-.512-1.12c-.108-.242-.168-.33-.246-.33zm-2.215%204.075a.42.42%200%200%200-.294.115c-.094.086-.145.2-.034.338.112.137.385.297.636.469.252.172.481.357.666.42.184.064.323.006.402-.096s.1-.247-.003-.404-.327-.325-.564-.481c-.238-.157-.488-.302-.681-.346a.6.6%200%200%200-.128-.015m.252.208q.038%200%20.083.01c.118.026.272.115.418.211s.283.2.333.289.014.163-.048.216a.26.26%200%200%201-.247.053c-.1-.031-.216-.126-.36-.219-.145-.093-.319-.184-.387-.268s-.031-.162.029-.218a.26.26%200%200%201%20.18-.074zm4.778%203.728c.211-.008.42.06.602.24.183.178.34.467.383.732s-.03.505-.125.692a1.6%201.6%200%200%201-.289.397c-.074.074-.109.095-.14.095h-.003c-.033-.001-.062-.023-.208-.171a7%207%200%200%201-.573-.642c-.165-.22-.232-.383-.263-.568-.032-.185-.027-.39.082-.536s.323-.23.534-.239m.093%201.111a.26.26%200%200%200-.153.046c-.058.041-.105.113-.093.185.012.073.085.146.174.255s.195.255.264.335c.068.08.1.093.127.091.029-.002.054-.018.086-.048a.35.35%200%200%200%20.094-.157.5.5%200%200%200%20.002-.316.67.67%200%200%200-.218-.282.48.48%200%200%200-.283-.109%22/%3E%3C/svg%3E');}}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="/assets/styles/custom_stepslist.css">
    
      <link rel="stylesheet" href="/assets/styles/format.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-VQRYHY3Y8P"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-VQRYHY3Y8P",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-VQRYHY3Y8P",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#0-gh-python" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!--
  Copyright (c) 2025 Zensical and contributors

  SPDX-License-Identifier: MIT
  Third-party contributions licensed under DCO

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine classes -->





<!-- Header -->
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="页眉">

        <!-- Link to home -->
        <a href="../.." title="Alex The Creator"
            class="md-header__button md-logo" aria-label="Alex The Creator" data-md-component="logo">
            
  <img src="../../assets/images/favicon.ico" alt="logo">

        </a>

        <!-- Button to open drawer -->
        <label class="md-header__button md-icon" for="__drawer">
            
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-menu" viewBox="0 0 24 24"><path d="M4 5h16M4 12h16M4 19h16"/></svg>
        </label>

        <!-- Header title -->
        <div class="md-header__title" data-md-component="header-title">
            <div class="md-header__ellipsis">
                <div class="md-header__topic">
                    <span class="md-ellipsis">
                        Alex The Creator
                    </span>
                </div>
                <div class="md-header__topic" data-md-component="header-topic">
                    <span class="md-ellipsis">
                        
                        ATLV Grasshopper Python 学习笔记
                        
                    </span>
                </div>
            </div>
        </div>

        <!-- Navigation tabs (sticky) -->
        
        
        
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  Alex The Creator

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Rhino

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Python/" class="md-tabs__link">
          
  
  Python

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../About/about/" class="md-tabs__link">
          
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
        
        


        <!-- Color palette toggle -->
        
        
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="none" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="none" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-moon" viewBox="0 0 24 24"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></svg>
      </label>
    
  
</form>
        
        

        <!-- User preference: color palette -->
        
        <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
        

        <!-- Site language selector -->
        

        <!-- Button to open search modal -->
        
        

        <!-- Check if search is actually enabled - see https://t.ly/DT_0V -->
        
        <label class="md-header__button md-icon" for="__search">
            
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-search" viewBox="0 0 24 24"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
        </label>

        <!-- Search interface -->
        <div class="md-search" data-md-component="search" role="dialog" aria-label="查找">
  <button type="button" class="md-search__button">
    查找
  </button>
</div>
        
        

        <!-- Repository information -->
        <div class="md-header__source">
            <!--  -->
            <a href="https://github.com/chinabiue/al666ex" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.291.068A1.29 1.29 0 0 0 0 1.36v3.352a1.29 1.29 0 0 0 1.291 1.291h3.354a1.29 1.29 0 0 0 1.289-1.291V1.359A1.29 1.29 0 0 0 4.644.07Zm9.033 0a1.29 1.29 0 0 0-1.29 1.291v3.352a1.29 1.29 0 0 0 1.29 1.291H22.71A1.29 1.29 0 0 0 24 4.711V1.359A1.29 1.29 0 0 0 22.709.07ZM1.291 9.033A1.29 1.29 0 0 0 0 10.323v3.353a1.29 1.29 0 0 0 1.291 1.29h21.418A1.29 1.29 0 0 0 24 13.677v-3.354a1.29 1.29 0 0 0-1.291-1.289Zm0 8.965A1.29 1.29 0 0 0 0 19.289v3.352a1.29 1.29 0 0 0 1.291 1.29h12.385a1.29 1.29 0 0 0 1.29-1.29v-3.352a1.29 1.29 0 0 0-1.29-1.291zm18.064 0a1.29 1.29 0 0 0-1.289 1.291v3.352a1.29 1.29 0 0 0 1.29 1.29h3.353A1.29 1.29 0 0 0 24 22.642V19.29a1.29 1.29 0 0 0-1.291-1.291z"/></svg>
  </div>
  <div class="md-source__repository">
    CLAT
  </div>
</a>
            <!--  -->
        </div>
    </nav>

    <!-- Navigation tabs (sticky) -->
    <!-- 
    
    
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  Alex The Creator

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Rhino

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Python/" class="md-tabs__link">
          
  
  Python

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../About/about/" class="md-tabs__link">
          
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
     -->
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Alex The Creator" class="md-nav__button md-logo" aria-label="Alex The Creator" data-md-component="logo">
      
  <img src="../../assets/images/favicon.ico" alt="logo">

    </a>
    Alex The Creator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/chinabiue/al666ex" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.291.068A1.29 1.29 0 0 0 0 1.36v3.352a1.29 1.29 0 0 0 1.291 1.291h3.354a1.29 1.29 0 0 0 1.289-1.291V1.359A1.29 1.29 0 0 0 4.644.07Zm9.033 0a1.29 1.29 0 0 0-1.29 1.291v3.352a1.29 1.29 0 0 0 1.29 1.291H22.71A1.29 1.29 0 0 0 24 4.711V1.359A1.29 1.29 0 0 0 22.709.07ZM1.291 9.033A1.29 1.29 0 0 0 0 10.323v3.353a1.29 1.29 0 0 0 1.291 1.29h21.418A1.29 1.29 0 0 0 24 13.677v-3.354a1.29 1.29 0 0 0-1.291-1.289Zm0 8.965A1.29 1.29 0 0 0 0 19.289v3.352a1.29 1.29 0 0 0 1.291 1.29h12.385a1.29 1.29 0 0 0 1.29-1.29v-3.352a1.29 1.29 0 0 0-1.29-1.291zm18.064 0a1.29 1.29 0 0 0-1.289 1.291v3.352a1.29 1.29 0 0 0 1.29 1.29h3.353A1.29 1.29 0 0 0 24 22.642V19.29a1.29 1.29 0 0 0-1.291-1.291z"/></svg>
  </div>
  <div class="md-source__repository">
    CLAT
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alex The Creator
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Rhino
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Rhino
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9B%B2%E7%BA%BF%E5%8F%82%E6%95%B0%E7%A9%BA%E9%97%B4/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-tangent" viewBox="0 0 24 24"><circle cx="17" cy="4" r="2"/><path d="M15.59 5.41 5.41 15.59"/><circle cx="4" cy="17" r="2"/><path d="M12 22s-4-9-1.5-11.5S22 12 22 12"/></svg>
  
  <span class="md-ellipsis">
    
  
    曲线参数空间
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%E7%BB%8F%E5%85%B8%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1C8.14 1 5 4.14 5 8a7 7 0 0 0 7 7c3.86 0 7-3.13 7-7 0-3.86-3.14-7-7-7m0 2.15c2.67 0 4.85 2.17 4.85 4.85s-2.18 4.85-4.85 4.85A4.85 4.85 0 0 1 7.15 8 4.85 4.85 0 0 1 12 3.15M11 5v3.69l3.19 1.84.75-1.3-2.44-1.41V5M4 16v8h2v-3h12v3l4-4-4-4v3H6v-3"/></svg>
  
  <span class="md-ellipsis">
    
  
    Rhino经典理论知识整理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Grasshooper%E5%85%A5%E9%97%A8%E4%B8%8E%E6%8F%90%E9%AB%98/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20H2v-2h5.75C7 15.19 4.81 13 2 12.26c.64-.16 1.31-.26 2-.26 4.42 0 8 3.58 8 8m10-7.74c-.64-.16-1.31-.26-2-.26-2.93 0-5.5 1.58-6.88 3.93.29.66.53 1.35.67 2.07.13.65.21 1.32.21 2h8v-2h-5.76c.76-2.81 2.95-5 5.76-5.74M15.64 11c.78-2.07 2.23-3.82 4.09-5-4.29.16-7.73 3.67-7.73 8 .95-1.25 2.2-2.28 3.64-3m-4.22-2.15A8.53 8.53 0 0 0 6.7 4C8.14 5.86 9 8.18 9 10.71c0 .21-.03.41-.04.61.43.24.83.52 1.22.82a9.9 9.9 0 0 1 1.24-3.29"/></svg>
  
  <span class="md-ellipsis">
    
  
    Grasshooper入门与提高
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20H2v-2h5.75C7 15.19 4.81 13 2 12.26c.64-.16 1.31-.26 2-.26 4.42 0 8 3.58 8 8m10-7.74c-.64-.16-1.31-.26-2-.26-2.93 0-5.5 1.58-6.88 3.93.29.66.53 1.35.67 2.07.13.65.21 1.32.21 2h8v-2h-5.76c.76-2.81 2.95-5 5.76-5.74M15.64 11c.78-2.07 2.23-3.82 4.09-5-4.29.16-7.73 3.67-7.73 8 .95-1.25 2.2-2.28 3.64-3m-4.22-2.15A8.53 8.53 0 0 0 6.7 4C8.14 5.86 9 8.18 9 10.71c0 .21-.03.41-.04.61.43.24.83.52 1.22.82a9.9 9.9 0 0 1 1.24-3.29"/></svg>
  
  <span class="md-ellipsis">
    
  
    ATLV Grasshopper Python 学习笔记
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20H2v-2h5.75C7 15.19 4.81 13 2 12.26c.64-.16 1.31-.26 2-.26 4.42 0 8 3.58 8 8m10-7.74c-.64-.16-1.31-.26-2-.26-2.93 0-5.5 1.58-6.88 3.93.29.66.53 1.35.67 2.07.13.65.21 1.32.21 2h8v-2h-5.76c.76-2.81 2.95-5 5.76-5.74M15.64 11c.78-2.07 2.23-3.82 4.09-5-4.29.16-7.73 3.67-7.73 8 .95-1.25 2.2-2.28 3.64-3m-4.22-2.15A8.53 8.53 0 0 0 6.7 4C8.14 5.86 9 8.18 9 10.71c0 .21-.03.41-.04.61.43.24.83.52 1.22.82a9.9 9.9 0 0 1 1.24-3.29"/></svg>
  
  <span class="md-ellipsis">
    
  
    ATLV Grasshopper Python 学习笔记
  

    
  </span>
  
  

      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        0. GH Python参考、资源
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. GH Python 基础
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. GH Python 基础">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 第1行代码
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-for" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 For循环
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.3 List 列表
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-if" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4 if 条件
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-if-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.5 if 条件（2）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-math" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.6 math库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.7 随机数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18-2for" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.8 2维嵌套for循环
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#19-andor" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.9 循环里的and/or条件
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#110" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.10 条件和范式
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. GH Python:输入
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. GH Python:输入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 整型/浮点型输入
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 点输入
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 点输入（2）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4 点输入（3）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5 曲线输入：最近均分间的直线
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.6 曲线输入（2）交叉点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.7 曲面输入:镶板
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.8 曲面输入:镶板（2）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#29-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.9 曲面输入:镶板（3）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#210-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.10 曲面输入:镶板（4）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#211-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.11 曲面输入:镶板（5）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.12 曲面输入:镶板（6）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.13 树形数据输入：迭代所有元素
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.14 树形数据输入（2）：条件迭代
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.15 树形数据输入（3）：连接最近的树元素
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. GH Python: 函数和递归
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. GH Python: 函数和递归">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 简单函数：1个参数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 简单函数：3个参数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 线分支函数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34a" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4a 直线递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34b" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4b 直线递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34c" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4c 直线递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34d" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4d 直线递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35a" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.5a 通过递归分支直线
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35b" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.5b 通过递归分支直线
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.6 矩形平面递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.7 通过递归分支直线-&gt;生成方块
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.8 曲面上的细分方块
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.9 通过递归进行六边形分支
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#310" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.10 通过递归进行网络细分
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. GH Python:烘培和物体属性
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. GH Python:烘培和物体属性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 烘培着色点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 烘培着色曲线
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 烘培简单材质的曲面
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. GH Python:面向对象编程
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. GH Python:面向对象编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 定义带构造函数的类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 添加一个方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 添加一个有返回值的方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4 添加更多方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5 作为几何模块的类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.6 作为几何模块的类(2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.7 作为几何模块的类(3)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#58-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.8 作为几何模块的类(4)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. GH Python:可连接的模块
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. GH Python:可连接的模块">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 可连接的模块 1:距离关系的连接
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 可连接的模块 2:最大连接数与排序
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 可连接的模块 2:树形输出
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-43" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4 可连接的模块 4:3点输出
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-connective-module-5-face-points-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5 Connective Module 5 : Face Points Output
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66-connective-module-6-point-output-for-specific-geometry-component" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6 Connective Module 6 : Point Output for Specific Geometry Component
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#67-connective-module-7-different-module-types-and-links" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.7. Connective Module 7 : Different Module Types and Links
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. GH Python:自定义细分
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. GH Python:自定义细分">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 顶点控制 1：偏移顶点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-vertex-control-2-randomize-vertices" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Vertex Control 2: Randomize Vertices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-vertex-control-3-move-vertices-by-attractors" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3 Vertex Control 3: Move Vertices by Attractors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-subdivision-1-triangle-center-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4 Subdivision 1: Triangle Center Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-subdivision-2-triangle-subdivision-with-vector-interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5 Subdivision 2: Triangle Subdivision with Vector Interpolation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-subdivision-3-quad-center-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.6 Subdivision 3: Quad Center Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77-subdivision-4-quad-subdivision-with-vector-interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.7 Subdivision 4: Quad Subdivision with Vector Interpolation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78-subdivision-5-1d-fractal-quad-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.8 Subdivision 5: 1D Fractal Quad Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79-subdivision-6-triangular-probabilistic-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9 Subdivision 6: Triangular Probabilistic Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#710-subdivision-7-frame-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.10 Subdivision 7: Frame Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#712-subdivision-9-quad-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.12 Subdivision 9: Quad Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#718-subdivision-15-quad-probabilistic-subdivision-with-depth-control-by-area" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.18 Subdivision 15: Quad Probabilistic Subdivision with Depth Control by Area
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#721-subdivision-18-tubular-subdivision-with-tab-faces" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.21 Subdivision 18: Tubular Subdivision with Tab Faces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#722-subdivision-19-long-edge-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.22 Subdivision 19: Long Edge Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#727-subdivision-24-vertex-based-subdivision-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.27 Subdivision 24: Vertex-Based Subdivision 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#728-subdivision-25-vertex-based-subdivision-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.28 Subdivision 25: Vertex-Based Subdivision 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#729-subdivision-26-vertex-based-polyhedron-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.29 Subdivision 26: Vertex-Based Polyhedron Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#730-custom-mesh-tool-1-dispatch-faces-randomly" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.30 Custom Mesh Tool 1: Dispatch Faces Randomly
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#731-custom-mesh-tool-2-dispatch-faces-by-attractors" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.31 Custom Mesh Tool 2: Dispatch Faces by Attractors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7323334-custom-subdivision-combination-example-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.32/33/34 Custom Subdivision Combination Example 1
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Rhino Python Primer 101 第8章
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Rhino Python Primer 101 第8章
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A01%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 2a8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8m0 5a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.1 openNURB(tm)内核
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A02%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.6 13v-.1l-.3-.3h-.1L9.6 12c.4-.3.8-.5 1.3-.5s1 .2 1.4.6.6.8.6 1.3-.1.9-.5 1.3zm-1.9 6.3c-.3-1-.1-2.2.7-3.8l1.2 3.1c.2.6 0 1-.6 1.3s-1 .1-1.3-.6m-5.6-6.2q.3-.9 1.2-.6l3.2 1.2c-1.6.8-2.8 1-3.8.7-.6-.3-.8-.7-.6-1.3m7.9-5h-1v1.4h-.4c-1.1 0-2 .4-2.8 1.2l-.4.6-1.4-.8c-.3-.1-.6-.1-1-.1-.6 0-1.2.2-1.7.6s-.9.8-1.1 1.4c-.2.7-.2 1.3 0 2 .3.7.6 1.2 1.1 1.5-.4 1.5-.1 2.8 1 3.9.8.8 1.7 1.2 2.8 1.2.5 0 .8 0 1.1-.1.6.8 1.4 1.3 2.4 1.3.3 0 .7 0 1-.1.6-.2 1-.6 1.4-1.1.4-.6.6-1.1.6-1.7 0-.4 0-.7-.1-1l-.6-1.4.6-.4c.8-.8 1.2-1.9 1.1-3.1H16v-1h-1.6q-.6-1.8-2.4-2.4zm5.3-1.3c-.2-.2-.3-.5-.3-.7 0-.3.1-.5.3-.7s.4-.3.7-.3.5.1.7.3c.2.1.3.4.3.7s-.1.5-.3.7-.4.2-.7.2-.5 0-.7-.2m3.4-2.7h-1.1l-.3-.9c-.2-.7-.6-1-1.3-1s-1.2.3-1.3 1l-.3.9h-1.1c-.6 0-1 .3-1.3.9q-.3.9.6 1.5l.9.5-.4 1.2c-.2.4-.1.8.1 1.2.3.4.6.6 1.1.6q.6 0 .9-.3l.8-.6.8.7c.2.1.5.2.9.2.5 0 .8-.2 1.1-.6.2-.4.3-.8.1-1.2L20.5 7l.8-.5q.9-.6.6-1.5c-.2-.7-.6-.9-1.2-.9"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.2 Rhino里的物体
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A03%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 9v6h6V9zm2 2h2v2h-2z"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.3 点和点云
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A04%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.4 线段与多重直线
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A05%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v16a2 2 0 0 0 2 2h16c1.11 0 2-.89 2-2V4a2 2 0 0 0-2-2M4 6l2-2h4.9L4 10.9zm0 7.7L13.7 4h4.9L4 18.6zM20 18l-2 2h-4.9l6.9-6.9zm0-7.7L10.3 20H5.4L20 5.4z"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.5 平面
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A06%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 4a8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8m0 14a6 6 0 0 0 6-6 6 6 0 0 0-6-6 6 6 0 0 0-6 6 6 6 0 0 0 6 6M3 12a5.99 5.99 0 0 0 4 5.65v2.09c-3.45-.89-6-4.01-6-7.74s2.55-6.85 6-7.74v2.09C4.67 7.17 3 9.39 3 12"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.6 圆、椭圆和弧线
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A07%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 2A1.5 1.5 0 0 1 20 3.5 1.5 1.5 0 0 1 18.5 5c-.23 0-.45-.05-.65-.15l-3.69 3.7.34.45c2.19-1.26 4.76-2 7.5-2l1 .03v2.01L22 9c-2.58 0-5 .75-7 2.04A3.96 3.96 0 0 1 11.04 15C9.75 17 9 19.42 9 22l.04 1H7.03L7 22c0-2.74.74-5.31 2-7.5l-.45-.34-3.7 3.69c.1.2.15.42.15.65A1.5 1.5 0 0 1 3.5 20 1.5 1.5 0 0 1 2 18.5 1.5 1.5 0 0 1 3.5 17c.23 0 .45.05.65.15l3.69-3.7C7.31 12.78 7 11.92 7 11a4 4 0 0 1 4-4c.92 0 1.78.31 2.45.84l3.7-3.69c-.1-.2-.15-.42-.15-.65A1.5 1.5 0 0 1 18.5 2M11 9a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.7 Nurbs曲线
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A08%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m13.62 13.28 1.64 2.26c.03-.54.12-1.07.3-1.61.18-.56.44-1.07.74-1.52zM17.77 19c-.02-1.32.18-2.73.64-4.15.47-1.43 1.15-2.71 1.95-3.76l-2.04.66c-.78.51-1.45 1.39-1.82 2.48-.33 1.06-.32 2.13 0 2.99zm1.48 2q-.75.69-1.62 1.2l-.32-.44C15.9 21 14.04 20.5 12 20.5s-3.9.5-5.31 1.26l-.32.44q-.87-.51-1.62-1.2l.25-.31c.33-1.61.22-3.57-.42-5.55-.64-1.95-1.68-3.58-2.87-4.68l-.44-.14c.15-.66.36-1.32.62-1.91l.4.13c1.63-.17 3.45-.89 5.14-2.11 1.66-1.21 2.89-2.7 3.57-4.17v-.47l1-.04 1 .04v.42c.67 1.5 1.91 3.02 3.6 4.24 1.66 1.21 3.46 1.92 5.07 2.11l.44-.15c.26.59.47 1.25.62 1.91l-.5.18c-1.19 1.08-2.23 2.71-2.86 4.66-.63 1.93-.75 3.84-.45 5.41zM11 11.37V8.5c-.34.42-.74.82-1.22 1.17-.49.33-1.01.62-1.53.83zm0-7.15c-.75 1.09-1.76 2.13-3 3.02-1.22.9-2.54 1.54-3.82 1.92l1.97.64c.96.08 2.07-.24 3.04-.94.94-.68 1.57-1.59 1.81-2.5zm2 7.15 2.74-.87c-.51-.2-1.02-.47-1.49-.81-.49-.36-.91-.77-1.25-1.19zm6.8-2.21c-1.27-.38-2.57-1.01-3.8-1.9-1.23-.9-2.24-1.95-3-3.06v2.07c.22.94.86 1.9 1.84 2.61.93.68 1.99.99 2.93.94zm-9.42 4.12-2.74-.89c.31.45.56.96.74 1.52.19.59.28 1.15.3 1.71zm-6.8-2.21c.8 1.05 1.48 2.33 1.95 3.76.47 1.46.67 2.91.64 4.25l1.21-1.67c.38-.91.42-2.05.05-3.19-.36-1.1-1.03-1.98-1.82-2.49zM12 14.45l-1.65 2.27a6.3 6.3 0 0 1 3.3 0zm-4.16 5.73c1.24-.43 2.66-.68 4.16-.68s2.92.25 4.16.68l-1.28-1.76c-.72-.57-1.75-.92-2.88-.92s-2.16.35-2.88.92z"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.8 网格
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A09%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m0 12c-4.42 0-8-.89-8-2 0-1.1 3.58-2 8-2s8 .9 8 2c0 1.11-3.58 2-8 2m0-10c3.37 0 6.25 2.09 7.43 5.05C17.93 8.43 15.61 8 12 8c-2.2 0-5.27.19-7.43 1.05C5.75 6.09 8.63 4 12 4m0 16c-3.37 0-6.25-2.09-7.43-5.05C6.07 15.57 8.39 16 12 16c2.2 0 5.27-.19 7.43-1.05C18.25 17.91 15.37 20 12 20"/></svg>
  
  <span class="md-ellipsis">
    
  
    8.9 曲面
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC9%E7%AB%A09%E8%8A%82/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5c.74 0 1.47.1 2.15.29l1.63-2.83c.28-.46.89-.64 1.37-.36.48.27.64.9.35 1.36L16 6.07A8.07 8.07 0 0 1 18.93 9H5.07A8.07 8.07 0 0 1 8 6.07L6.5 3.46a.98.98 0 0 1 .35-1.36c.48-.28 1.09-.1 1.37.36l1.63 2.83C10.53 5.1 11.26 5 12 5m8 8a8 8 0 0 1-7.25 7.97V10.5h6.85c.26.79.4 1.63.4 2.5M4 13c0-.87.14-1.71.4-2.5h6.85v10.47A8 8 0 0 1 4 13"/></svg>
  
  <span class="md-ellipsis">
    
  
    Rev3程序勘误
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../Python/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Python
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/calculus-with-python/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-calculator" viewBox="0 0 24 24"><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M8 6h8M16 14v4M16 10h.01M12 10h.01M8 10h.01M12 14h.01M8 14h.01M12 18h.01M8 18h.01"/></svg>
  
  <span class="md-ellipsis">
    
  
    用Python来微积分
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/anaconda%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 17H18c1.1 0 2-.9 2-2s-.9-2-2-2V9c0-1 0-2-1.08-2.86.05-.21.08-.42.08-.64C17 3.57 15 2 12.5 2c-2.26 0-4.12 1.31-4.43 3H6L3.71 2.79 3 3.5l2 2-2 2 .71.71L6 6h2.07c.31 1.69 2.17 3 4.43 3 .5 0 1-.08 1.43-.2.04.07.07.14.07.2v4H8c-1.1 0-2 .9-2 2s.9 2 2 2H6.5A2.5 2.5 0 0 0 4 19.5c0 .17 0 .34.05.5H4c-1.1 0-2 .9-2 2h17.5a2.5 2.5 0 0 0 0-5M12 5c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"/></svg>
  
  <span class="md-ellipsis">
    
  
    anaconda简单配置使用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/notepad-%E9%85%8D%E7%BD%AEpython%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83-%E4%BB%A3%E7%A0%81%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96-%E8%BF%90%E8%A1%8C-%E9%AB%98%E4%BA%AE/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.443 2.285c-.305.005-.6.06-.853.248-.256.168-.546.32-.723.578a6.3 6.3 0 0 0-.71 2.463c-1.009-.413-2.08-.716-3.177-.676a8.6 8.6 0 0 0-1.93.604c-1.26.657-2.058 1.943-2.53 3.246a6.8 6.8 0 0 0-.604 1.805c-.107.568-.322 1.115-.357 1.695-.002.394.029.788.023 1.182-.422.263-.926.245-1.398.328-.34-.008-.67-.18-1.014-.07-.36.172-.75.269-1.111.437-.087.51-.166 1.225.457 1.424 1.064-.002 2.132.002 3.195.021.192.98.38 1.99.898 2.86.613.987 1.213 2.025 2.147 2.75.888.593 2.02.617 3.039.441.387-.043.656-.35 1.004-.492.212-.126.527-.156.607-.428.698-1.13.163-2.531-.47-3.56-.403-.707-1.275-.853-2.018-.82-.436.065-.712.44-1.063.667-.388.235-.761.735-.468 1.186.251.473.561 1.107 1.193 1.074.399-.046.932-.136 1.106-.553.077-.505-.519-.748-.92-.838.019.247.045.494.07.743q-.31-.213-.625-.418c.128-.667.87-.65 1.38-.854.52.81 1.068 1.852.645 2.815-.489.612-1.37.535-2.054.375-.894-.137-1.487-.933-1.881-1.682-.594-1.035-1.323-2.145-1.196-3.387q.626-.032 1.25.004c.398.094.752.438 1.182.27.922-.252 1.881-.1 2.822-.11a20 20 0 0 1 2.225-.031c.268.073.411.4.72.38.358.12.558-.246.827-.4a18 18 0 0 1 1.79.002c.283.494.706 1.022 1.31 1.092.734.027 1.356-.493 1.753-1.064.52.117 1.082.282 1.586.021 1.095-.464 2.3-.464 3.43-.785v-.322c-.907-.61-2.027-.441-3.043-.695-.775-.133-1.562-.012-2.34-.022-.345-.236-.683-.509-1.119-.537q-.202.087-.404.168c.356.04.728.12.994.38-.336-.02-.684-.004-1.002-.126-.428.157-.835.4-.902.894-.182-.255.083-.493.189-.72-.24-.507-.826-.768-.994-1.315a.29.29 0 0 1 .48-.008q.352.519.573 1.104.325.019.654.045v-.25q-.163.066-.322.142a10 10 0 0 1-.485-1.271c.258.062.506.155.766.207 1.176-.184 2.439-.412 3.36-1.232.194-.2.542-.37.484-.698-.057-.474-.402-.841-.573-1.277.267-.101.535-.2.793-.32.918-.899 1.377-2.185 1.477-3.448-.092-.673-.282-1.413-.803-1.886-.95-.48-2.07-.324-3.035.025-.437.174-.76.527-1.123.813-.296-.066-.477-.41-.672-.633-.375-.64-.89-1.235-1.596-1.51-.293-.011-.608-.055-.914-.05zm.395.516c.59.02 1.109.506 1.443.972.222.37.524.682.885.916a5.22 5.22 0 0 1-.277 3.791c-.167.375-.519.605-.864.795-.91.267-1.874-.133-2.521-.783l.012-.094c-.458-.214-.537-.767-.616-1.21-.39-.893-.293-1.916-.006-2.823.212-.71.756-1.39 1.526-1.498a1.1 1.1 0 0 1 .418-.066m5.592 1.025c.616.002 1.29.28 1.44.926.48 1.112-.052 2.344-.688 3.273-.368.345-.792.627-1.137 1-.425-.844-1.359-1.219-2.223-1.437.16-.808.04-1.628.022-2.44.468-.835 1.44-1.154 2.326-1.304q.127-.017.26-.018m.775 1.62a8 8 0 0 1-.523.138q-.187.272-.381.545c.141.372.636.718.984.38a1.3 1.3 0 0 0-.08-1.064c-.178-.318 0 0 0 0zm-11.988.046c.9-.011 1.793.272 2.601.653.38.153.353.6.438.933.065.26.14.516.217.774.126.383.292.78.62 1.037.546.418 1.108.867 1.794 1.025a2.42 2.42 0 0 0 1.787-.303c.45-.404.668-1.007 1.137-1.396.44.215.927.318 1.351.568.44.278.653.777.912 1.207.09.194.164.392.242.588-.786.782-1.936.988-2.974 1.23-.43.128-.829-.096-1.186-.304-.184.101-.367.209-.552.309a3.7 3.7 0 0 1-2.145.45 33 33 0 0 1-.55-.072c.084-.376.182-.749.259-1.127-.092.008-.277.02-.37.026-.31.476-.325 1.052-.263 1.597q.023.31.037.62a1.57 1.57 0 0 1-.408-.932c.016-.391.065-.778.1-1.168-.41-.177-.571.292-.647.596 0 .168.012.335.024.502-.714.163-1.48.246-2.188.011-.514-.168-1.075-.182-1.557-.445q-.023-.3-.054-.596-.212-.038-.422-.08c-.189.507-.452 1.021-.424 1.575.095.365.401.634.629.925-.335.098-.791.022-1.016.334-.135.601.413.948.772 1.319-.516-.19-1.089-.463-1.266-1.03q.39-.455.881-.797c-.471-.698-.676-1.743-.066-2.421-.118-.143-.257-.39-.477-.268-.172.162-.318.35-.484.52-.7.533-.976 1.386-1.399 2.12q-.308-.012-.615-.013l-.01-.254a4.6 4.6 0 0 1-.023-1.014c.153-.596.418-1.158.568-1.755l.051-.194.086-.293c.452-1.231 1.008-2.494 2.012-3.379.642-.636 1.563-.81 2.396-1.07q.091-.005.182-.008m5.12.496c-.38-.012-.738.145-.675.596-.055.394.323.572.592.76.602-.003.872-.686.707-1.178a1.26 1.26 0 0 0-.623-.178zm-8.064 5.79a1.87 1.87 0 0 0 .225 1.622c-.391.203-.826.213-1.256.211-.09-.648.318-1.202.621-1.736q.207-.045.41-.098zm1.213.544c.353.101.773.09 1.051.358a8 8 0 0 0-.113.525 5 5 0 0 0-.654.465 1.75 1.75 0 0 1-.284-1.348m7.168.324c.211.023.262.279.4.407.236.306.573.512.852.775-.67.018-1.475.102-1.88-.562-.271.074-.543.183-.684.445l-.4-.217q-.007-.376.025-.752h.457q.62.005 1.23-.096m-5.306.147c.02.336.18.73-.07 1.02-.246-.021-.492-.041-.733-.084.326-.195.567-.505.674-.87zm2.51.117c.315.24.445.634.591.986q-1.408.054-2.814-.039c.064-.31.17-.61.252-.916.655-.02 1.313 0 1.97-.03zm.826.535q.228.276.498.512c.24-.277.775-.727.998-.193-.363.174-.813.305-.934.742l-.012.053q.114.572.307 1.123c-.773-.505-.391-1.548-.857-2.237m-10.815.293c-.02.295-.422.42-.373.727q.137.436.354.838c-.491-.023-.989.003-1.475-.088-.046-.256-.161-.635.11-.805.259-.16.47-.389.615-.658.255.04.516.036.77-.014zm.66.153c-.208.362-.461.81-.138 1.191l-.176.078a2.7 2.7 0 0 1-.361-.676 7 7 0 0 0 .28-.566 9 9 0 0 0 .395-.027m.518.086.033.08.11-.047c-.04.227-.205.391-.346.562.233.014.296.764-.041.557l-.127-.225c.024-.227-.012-.48.181-.648l.055-.067.086-.095zm3.943.074c.347.082.895-.121 1.11.166.31.05.603.197.92.205 1.122-.329 2.316-.154 3.47-.154.006.1.02.298.028.398q-1.303.048-2.604.014c-.452-.003-.881-.307-1.338-.17-.2.018-.424.229-.6.043-.28-.003-.562-.012-.843-.018-.045-.17-.1-.34-.143-.484m-2.428.017c.375.05.849-.096 1.131.225l-.12.27c-.74-.036-1.48-.043-2.221-.065.151-.495.8-.404 1.21-.43m15.87.016c.502-.022.98.166 1.478.215.003.207.065.428-.035.623-.608.116-1.185.383-1.81.398q.017-.252.023-.506l.287-.187zm-1.61.014q.153 0 .307.01c.229.044.396.227.588.347-.552.275-1.181.207-1.772.127-.456-.062-.93.022-1.377-.115l.125-.225c.708-.06 1.416-.151 2.13-.144zm-3.761.097q.325.004.652.006.033.33-.28.319c-.517.014-1.034.012-1.55-.018-.05-.306.34-.249.525-.295.217-.013.435-.014.653-.012m-.516.647c.542 0 1.083.051 1.615.152.744-.097 1.494-.005 2.235-.135.306.024.95-.115.876.371-.349.042-.674-.177-1.027-.14-.694.043-1.393.107-2.08-.045-.787.165-1.591.088-2.387.137l-.021-.305c.268-.03.546-.024.789-.035m-10.418.012c.6 0 1.203.111 1.803.132l.125.143c-.808-.002-1.622.062-2.426-.022l-.104-.209q.301-.046.602-.044m3.426.119c.34.003.683.008 1.025.002 1.337.016 2.672.035 4.006.125l-.098.168c-1.304.043-2.606.02-3.91.015l-.822-.029q-.1-.143-.201-.281m8.642.39c.43.192.857.393 1.305.543.259-.104.615-.671.826-.26-.328.305-.791.614-1.26.51-.36-.17-.59-.52-.87-.793zm-11.984.07.33.05c.363.841.38 1.81.873 2.599.284.467.518.96.793 1.432.287.492.762.824 1.207 1.162.955.702 2.52.596 3.197-.438.427-.922-.104-1.898-.474-2.74-.634-.996-2.29-.238-2.242.848.364.218.767.663 1.222.384a11 11 0 0 1-.013-.533c.108.12.19.261.296.383-.255.329-.67.314-1.045.262-.151-.168-.307-.331-.46-.496-.188-1.083 1.193-1.994 2.11-1.446.655.42.838 1.228 1.099 1.91.301.821-.144 1.793-.924 2.159-.601.388-1.346.234-2.018.234-.917-.044-1.515-.793-2.117-1.387-.58-.712-.958-1.557-1.41-2.351a7.7 7.7 0 0 1-.424-2.031z"/></svg>
  
  <span class="md-ellipsis">
    
  
    notepad++配置python运行环境
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/python%E6%89%B9%E9%87%8F%E8%BD%AC%E6%8D%A2svg%E5%9B%BE%E7%89%87%E4%B8%BApng_cairosvg%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0c-1.497 0-2.749.965-3.248 2.17a3.45 3.45 0 0 0-.238 1.416 3.5 3.5 0 0 0-1.168-.834 3.5 3.5 0 0 0-1.463-.256 3.5 3.5 0 0 0-2.367 1.02c-1.06 1.058-1.263 2.625-.764 3.83.179.432.47.82.82 1.154a3.5 3.5 0 0 0-1.402.252C.965 9.251 0 10.502 0 12c0 1.497.965 2.749 2.17 3.248.437.181.924.25 1.414.236-.357.338-.65.732-.832 1.17-.499 1.205-.295 2.772.764 3.83 1.058 1.06 2.625 1.263 3.83.764.437-.181.83-.476 1.168-.832-.014.49.057.977.238 1.414C9.251 23.035 10.502 24 12 24c1.497 0 2.749-.965 3.248-2.17a3.45 3.45 0 0 0 .238-1.416c.338.356.73.653 1.168.834 1.205.499 2.772.295 3.83-.764 1.06-1.058 1.263-2.625.764-3.83a3.5 3.5 0 0 0-.834-1.168 3.45 3.45 0 0 0 1.416-.238C23.035 14.749 24 13.498 24 12c0-1.497-.965-2.749-2.17-3.248a3.5 3.5 0 0 0-1.414-.236c.357-.338.65-.732.832-1.17.499-1.205.295-2.772-.764-3.83a3.5 3.5 0 0 0-2.367-1.02 3.5 3.5 0 0 0-1.463.256c-.437.181-.83.475-1.168.832a3.45 3.45 0 0 0-.238-1.414C14.749.965 13.498 0 12 0m-.041 1.613a1.902 1.902 0 0 1 1.387 3.246v3.893L16.098 6A1.902 1.902 0 1 1 18 7.902l-2.752 2.752h3.893a1.902 1.902 0 1 1 0 2.692h-3.893L18 16.098A1.902 1.902 0 1 1 16.098 18l-2.752-2.752v3.893a1.902 1.902 0 1 1-2.692 0v-3.893L7.902 18A1.902 1.902 0 1 1 6 16.098l2.752-2.752H4.859a1.902 1.902 0 1 1 0-2.692h3.893L6 7.902A1.902 1.902 0 1 1 7.902 6l2.752 2.752V4.859a1.902 1.902 0 0 1 1.305-3.246"/></svg>
  
  <span class="md-ellipsis">
    
  
    批量转换svg->png(cairosvg)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/Python-f-string-snippets-%E5%AE%9E%E7%94%A8%E7%94%A8%E5%B0%8F%E7%89%87%E6%AE%B5/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M32 32C14.3 32 0 46.3 0 64v384c0 17.7 14.3 32 32 32s32-14.3 32-32V288h160c17.7 0 32-14.3 32-32s-14.3-32-32-32H64V96h224c17.7 0 32-14.3 32-32s-14.3-32-32-32z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Python f-string 小片段
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/Samila%E9%A1%B9%E7%9B%AE%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.23 16.615h5.54c.51 0 .922.412.922.923v5.539a.92.92 0 0 1-.923.923H9.231a.92.92 0 0 1-.923-.923v-5.539a.92.92 0 0 1 .923-.923zM0 17.538c0-.51.413-.923.923-.923h5.539c.51 0 .923.413.923.923v5.539c0 .51-.414.923-.923.923H2.769A2.77 2.77 0 0 1 0 21.23zm.923-9.23h5.539a.92.92 0 0 1 .923.922v5.539a.92.92 0 0 1-.923.923H.923A.92.92 0 0 1 0 14.769V9.23c0-.511.412-.923.923-.923zM2.77 0A2.77 2.77 0 0 0 0 2.769V6.46c0 .51.413.923.923.923h5.539c1.02 0 1.846.827 1.846 1.846v5.539c0 .51.413.923.923.923h5.538c1.02 0 1.847.826 1.847 1.846v5.539c0 .51.413.923.923.923h3.692A2.77 2.77 0 0 0 24 21.23V2.77A2.77 2.77 0 0 0 21.23 0zm18 1.846a1.385 1.385 0 1 1 0 2.769 1.385 1.385 0 0 1 0-2.77z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Samila项目说明
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/%E7%94%9F%E6%88%90%E8%89%BA%E6%9C%AFGenerative-art-with-samila/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.23 16.615h5.54c.51 0 .922.412.922.923v5.539a.92.92 0 0 1-.923.923H9.231a.92.92 0 0 1-.923-.923v-5.539a.92.92 0 0 1 .923-.923zM0 17.538c0-.51.413-.923.923-.923h5.539c.51 0 .923.413.923.923v5.539c0 .51-.414.923-.923.923H2.769A2.77 2.77 0 0 1 0 21.23zm.923-9.23h5.539a.92.92 0 0 1 .923.922v5.539a.92.92 0 0 1-.923.923H.923A.92.92 0 0 1 0 14.769V9.23c0-.511.412-.923.923-.923zM2.77 0A2.77 2.77 0 0 0 0 2.769V6.46c0 .51.413.923.923.923h5.539c1.02 0 1.846.827 1.846 1.846v5.539c0 .51.413.923.923.923h5.538c1.02 0 1.847.826 1.847 1.846v5.539c0 .51.413.923.923.923h3.692A2.77 2.77 0 0 0 24 21.23V2.77A2.77 2.77 0 0 0 21.23 0zm18 1.846a1.385 1.385 0 1 1 0 2.769 1.385 1.385 0 0 1 0-2.77z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Samila生成艺术
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/%E4%BD%BF%E7%94%A8pathlib%E6%9B%BF%E6%8D%A2os-os-path-glob/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-route" viewBox="0 0 24 24"><circle cx="6" cy="19" r="3"/><path d="M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15"/><circle cx="18" cy="5" r="3"/></svg>
  
  <span class="md-ellipsis">
    
  
    使用pathlib替换os.path
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/%E6%A0%88%E7%9A%84%E5%BA%94%E7%94%A8-python%E5%89%8D%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E4%B8%AD%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E5%90%8E%E7%BC%80%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-layers" viewBox="0 0 24 24"><path d="M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"/><path d="M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"/><path d="M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"/></svg>
  
  <span class="md-ellipsis">
    
  
    栈的应用:前缀<-中缀->后缀
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0-Gitee-Pages/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.984 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm6.09 5.333c.328 0 .593.266.592.593v1.482a.594.594 0 0 1-.593.592H9.777c-.982 0-1.778.796-1.778 1.778v5.63c0 .327.266.592.593.592h5.63c.982 0 1.778-.796 1.778-1.778v-.296a.593.593 0 0 0-.592-.593h-4.15a.59.59 0 0 1-.592-.592v-1.482a.593.593 0 0 1 .593-.592h6.815c.327 0 .593.265.593.592v3.408a4 4 0 0 1-4 4H5.926a.593.593 0 0 1-.593-.593V9.778a4.444 4.444 0 0 1 4.445-4.444h8.296Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    自动更新 Gitee Pages
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--deprecated"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blog/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-braces" viewBox="0 0 24 24"><path d="M8 3H7a2 2 0 0 0-2 2v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5c0 1.1.9 2 2 2h1M16 21h1a2 2 0 0 0 2-2v-5c0-1.1.9-2 2-2a2 2 0 0 1-2-2V5a2 2 0 0 0-2-2h-1"/></svg>
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Posts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Posts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/posts/Grasshopper%E4%BB%8E0%E5%BC%80%E5%A7%8B/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-rocket" viewBox="0 0 24 24"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.4 22.4 0 0 1-4 2"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg>
  
  <span class="md-ellipsis">
    
  
    Grasshopper从0开始
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/posts/git%E5%88%9D%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.546 10.93 13.067.452a1.55 1.55 0 0 0-2.188 0L8.708 2.627l2.76 2.76a1.838 1.838 0 0 1 2.327 2.341l2.658 2.66a1.838 1.838 0 0 1 1.9 3.039 1.837 1.837 0 0 1-2.6 0 1.85 1.85 0 0 1-.404-1.996L12.86 8.955v6.525c.176.086.342.203.488.348a1.85 1.85 0 0 1 0 2.6 1.844 1.844 0 0 1-2.609 0 1.834 1.834 0 0 1 0-2.598c.182-.18.387-.316.605-.406V8.835a1.834 1.834 0 0 1-.996-2.41L7.636 3.7.45 10.881c-.6.605-.6 1.584 0 2.189l10.48 10.477a1.545 1.545 0 0 0 2.186 0l10.43-10.43a1.544 1.544 0 0 0 0-2.187"/></svg>
  
  <span class="md-ellipsis">
    
  
    git for Windows 初使用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/posts/Windows-10-%E4%BD%BF%E7%94%A8VIM%E5%86%99python%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AE%BE%E7%BD%AE/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 12V6.75l6-1.32v6.48zm17-9v8.75l-10 .15V5.21zM3 13l6 .09v6.81l-6-1.15zm17 .25V22l-10-1.91V13.1z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Windows 10 使用VIM写python的基本设置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/posts/VSCode-Rhino-%E8%81%94%E5%8A%A8%E5%86%99python%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%BD%AF%E4%BB%B6%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 16.47V7.39l-6 4.54M2.22 9.19a.86.86 0 0 1-.02-1.15l1.2-1.11c.2-.18.69-.26 1.05 0l3.42 2.61 7.93-7.25c.32-.32.87-.45 1.5-.12l4 1.91c.36.21.7.54.7 1.15v13.5c0 .4-.29.83-.6 1l-4.4 2.1c-.32.13-.92.01-1.13-.2l-8.02-7.3-3.4 2.6c-.38.26-.85.19-1.05 0l-1.2-1.1c-.32-.33-.28-.87.05-1.2l3-2.7"/></svg>
  
  <span class="md-ellipsis">
    
  
    VSCode-Rhino 联动写python程序的软件配置
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/posts/math/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-sigma" viewBox="0 0 24 24"><path d="M18 7V5a1 1 0 0 0-1-1H6.5a.5.5 0 0 0-.4.8l4.5 6a2 2 0 0 1 0 2.4l-4.5 6a.5.5 0 0 0 .4.8H17a1 1 0 0 0 1-1v-2"/></svg>
  
  <span class="md-ellipsis">
    
  
    Markdown 数学公式支持 in VSCode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blog/posts/zensical-customize/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 4V3a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V6h1v4H9v11a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-9h8V4z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Zensical自定义
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    About
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../About/about/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 9h2V7h-2m1 13c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m-1 15h2v-6h-2z"/></svg>
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../About/mkdocs_syntax/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.138.034A12 12 0 0 0 2.35 4.873a9.35 9.35 0 0 0 1.351 7.82.014.014 0 1 1-.022.018 8.23 8.23 0 0 1-2.08-6.656c0-.015-.012-.019-.019-.007A11.9 11.9 0 0 0 .362 9.065a8.76 8.76 0 0 0 2.421 5.358.015.015 0 0 1-.018.023 7.17 7.17 0 0 1-2.64-4.044c0-.015-.02-.015-.02 0a12 12 0 0 0-.058 2.656A7.2 7.2 0 0 0 2.24 16.21c.016.015 0 .035-.016.027A6.5 6.5 0 0 1 .27 14.457c-.007-.011-.02-.007-.017.006a11.996 11.996 0 0 0 23.48 0c0-.013-.009-.017-.017-.006a6.5 6.5 0 0 1-1.955 1.78c-.018.01-.032-.011-.016-.026a7.2 7.2 0 0 0 2.196-3.153h.013a12 12 0 0 0-.06-2.656c0-.015-.017-.015-.02 0a7.17 7.17 0 0 1-2.64 4.044.015.015 0 0 1-.018-.023 8.76 8.76 0 0 0 2.42-5.358 11.9 11.9 0 0 0-1.218-3.017c-.008-.012-.022-.008-.018.007a8.23 8.23 0 0 1-2.08 6.656.015.015 0 1 1-.023-.017 9.34 9.34 0 0 0 1.353-7.821A12 12 0 0 0 11.138.034m.044.311a7.721 7.721 0 0 1 6.238 13.173l-.001.002c-2.454 2.387-6.118.862-5.745-2.07.286-2.26 3.057-4.51 5.156-5.732a.016.016 0 0 0 0-.027 18 18 0 0 1-1.214-1.296 2.413 2.413 0 0 0-3.855.067l-6.032.56a.019.019 0 0 0 0 .037l6.466.375c1.147.064 1.521 1.105.416 1.943-4.107 3.113-4.84 6.407-3.919 9.018a.017.017 0 0 1-.031.014 5.3 5.3 0 0 1-.814-1.875A7.721 7.721 0 0 1 11.182.345M9.12 17.335h1.635l-.874 2.281a2.195 2.195 0 0 1-2.339 1.262 5.3 5.3 0 0 1-1.138-.112l.28-.728c.748.087 1.39.021 1.641-.633zm3.866 0h1.463l.328 3.43H13.14l-.025-.677h-1.477l-.543.678H9.743l2.74-3.176a.7.7 0 0 1 .503-.254zm3.545 0h1.636l-1.039 2.704h2.079l-.28.727h-3.71zm-3.47.999-.88 1.096h.92z"/></svg>
  
  <span class="md-ellipsis">
    
  
    遇到百分百的女孩
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        0. GH Python参考、资源
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. GH Python 基础
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. GH Python 基础">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 第1行代码
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-for" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 For循环
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.3 List 列表
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-if" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4 if 条件
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-if-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.5 if 条件（2）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-math" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.6 math库
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.7 随机数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18-2for" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.8 2维嵌套for循环
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#19-andor" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.9 循环里的and/or条件
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#110" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.10 条件和范式
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. GH Python:输入
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. GH Python:输入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 整型/浮点型输入
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 点输入
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 点输入（2）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4 点输入（3）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5 曲线输入：最近均分间的直线
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.6 曲线输入（2）交叉点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.7 曲面输入:镶板
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.8 曲面输入:镶板（2）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#29-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.9 曲面输入:镶板（3）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#210-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.10 曲面输入:镶板（4）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#211-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.11 曲面输入:镶板（5）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-6" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.12 曲面输入:镶板（6）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.13 树形数据输入：迭代所有元素
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.14 树形数据输入（2）：条件迭代
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.15 树形数据输入（3）：连接最近的树元素
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. GH Python: 函数和递归
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. GH Python: 函数和递归">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 简单函数：1个参数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 简单函数：3个参数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 线分支函数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34a" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4a 直线递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34b" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4b 直线递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34c" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4c 直线递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34d" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4d 直线递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35a" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.5a 通过递归分支直线
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35b" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.5b 通过递归分支直线
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.6 矩形平面递归
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37-" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.7 通过递归分支直线-&gt;生成方块
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.8 曲面上的细分方块
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.9 通过递归进行六边形分支
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#310" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.10 通过递归进行网络细分
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. GH Python:烘培和物体属性
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. GH Python:烘培和物体属性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 烘培着色点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 烘培着色曲线
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 烘培简单材质的曲面
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. GH Python:面向对象编程
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. GH Python:面向对象编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 定义带构造函数的类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 添加一个方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 添加一个有返回值的方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.4 添加更多方法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.5 作为几何模块的类
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.6 作为几何模块的类(2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.7 作为几何模块的类(3)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#58-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.8 作为几何模块的类(4)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. GH Python:可连接的模块
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. GH Python:可连接的模块">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 可连接的模块 1:距离关系的连接
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 可连接的模块 2:最大连接数与排序
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 可连接的模块 2:树形输出
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-43" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.4 可连接的模块 4:3点输出
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-connective-module-5-face-points-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.5 Connective Module 5 : Face Points Output
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66-connective-module-6-point-output-for-specific-geometry-component" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.6 Connective Module 6 : Point Output for Specific Geometry Component
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#67-connective-module-7-different-module-types-and-links" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.7. Connective Module 7 : Different Module Types and Links
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-gh-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. GH Python:自定义细分
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. GH Python:自定义细分">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 顶点控制 1：偏移顶点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-vertex-control-2-randomize-vertices" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Vertex Control 2: Randomize Vertices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-vertex-control-3-move-vertices-by-attractors" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3 Vertex Control 3: Move Vertices by Attractors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-subdivision-1-triangle-center-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.4 Subdivision 1: Triangle Center Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-subdivision-2-triangle-subdivision-with-vector-interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.5 Subdivision 2: Triangle Subdivision with Vector Interpolation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-subdivision-3-quad-center-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.6 Subdivision 3: Quad Center Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77-subdivision-4-quad-subdivision-with-vector-interpolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.7 Subdivision 4: Quad Subdivision with Vector Interpolation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78-subdivision-5-1d-fractal-quad-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.8 Subdivision 5: 1D Fractal Quad Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79-subdivision-6-triangular-probabilistic-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.9 Subdivision 6: Triangular Probabilistic Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#710-subdivision-7-frame-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.10 Subdivision 7: Frame Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#712-subdivision-9-quad-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.12 Subdivision 9: Quad Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#718-subdivision-15-quad-probabilistic-subdivision-with-depth-control-by-area" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.18 Subdivision 15: Quad Probabilistic Subdivision with Depth Control by Area
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#721-subdivision-18-tubular-subdivision-with-tab-faces" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.21 Subdivision 18: Tubular Subdivision with Tab Faces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#722-subdivision-19-long-edge-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.22 Subdivision 19: Long Edge Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#727-subdivision-24-vertex-based-subdivision-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.27 Subdivision 24: Vertex-Based Subdivision 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#728-subdivision-25-vertex-based-subdivision-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.28 Subdivision 25: Vertex-Based Subdivision 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#729-subdivision-26-vertex-based-polyhedron-subdivision" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.29 Subdivision 26: Vertex-Based Polyhedron Subdivision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#730-custom-mesh-tool-1-dispatch-faces-randomly" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.30 Custom Mesh Tool 1: Dispatch Faces Randomly
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#731-custom-mesh-tool-2-dispatch-faces-by-attractors" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.31 Custom Mesh Tool 2: Dispatch Faces by Attractors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7323334-custom-subdivision-combination-example-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.32/33/34 Custom Subdivision Combination Example 1
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="导航栏" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Alex The Creator
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Rhino
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  
  
  


  <h1>ATLV Grasshopper Python 学习笔记</h1>

<p>Rhino网站上系统完整的对于Grasshopper的介绍比较离散。通过练习实例，边学边理解内容是比较好的方式。</p>
<p>可以先看<a href="https://modelab.gitbooks.io/grasshopper-primer/content/">Grasshooper Primer Third Edition</a>，一本从0入门的基础教程。</p>
<p>然后找到了以下这个网站。有详细的实例，很好的练习素材。 -&gt;<a href="http://atlv.org/education/ghpython/">来源网站</a> &lt;-
以下例程，一个一个输入进入ghpython运行，在grasshopper里查看生成结果。图片巨多不一一生成。可在原文访问所有的图片。</p>
<p>[toc]</p>
<h2 id="0-gh-python">0. GH Python参考、资源</h2>
<ul>
<li><a href="http://www.rhino3d.com/download/IronPython/5.0/RhinoPython101">RhinoPython 101 Primer</a><ul>
<li>本站也有101关键章节的学习翻译笔记</li>
</ul>
</li>
<li><a href="http://4.rhino3d.com/5/ironpython/">RhinoPython Reference</a><ul>
<li>(在犀牛程序)  工具 &gt; Python脚本 &gt; 编辑</li>
<li>(在Rhino Python编辑器) 帮助 &gt; 帮助主题</li>
</ul>
</li>
<li><a href="http://4.rhino3d.com/5/rhinocommon/">RhinoCommon 参考</a></li>
</ul>
<h2 id="1-gh-python">1. GH Python 基础</h2>
<h4 id="11-1">1.1 第1行代码</h4>
<p><div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;hello world&quot;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nb">print</span> <span class="n">text</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">a</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></div>
<img alt="" src="https://gitee.com/al666ex/RhinoPython101/raw/master/images/ghp/1.1.png" />
能写下第一行代码，说明已经配置好ghpython的环境了。导入需要用的模块，定义一个变量，添加一个点。
  - 在ghpython里，print的输出会在ghpython电池的out端输出，并不会像editypythonscript一样在Rhino主界面命令行输出。
  - 如果不对变量a进行赋值，单纯使用<code>rs.AddPoint(0,0,0)</code>,并不会在Rhino主界面产生输出点的预览，bake不会产生任何结果。
  - 通过<em>File path</em> - <em>Read file</em> - ghpython的code输入端，直接在VSCode编辑程序，比较方便。</p>
<!--more-->
<h4 id="12-for">1.2 For循环</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></code></pre></div>
- 简单的For循环，产生的效果是在out端生成一序列，Rhino界面并未有任何反应，纯数据处理环节</p>
<h4 id="13-list">1.3 List 列表</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># set an empty list</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 展示列表操作，最后输出10个点的列表至a</p>
<h4 id="14-if">1.4 if 条件</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 输出a接入<code>Polyline</code>的输入，生成的点连成线</p>
<h4 id="15-if-2">1.5 if 条件（2）</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="k">elif</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">):</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 主要示范elif的用法，生成结果可自行想象</p>
<h4 id="16-math">1.6 math库</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.1</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.08</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">):</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.05</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        <span class="n">z</span> <span class="o">=</span> <span class="mi">20</span><span class="o">-</span><span class="n">i</span><span class="o">*</span><span class="mf">0.05</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 导数math库可以使用库的定义好的数学函数</p>
<h4 id="17">1.7 随机数</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.1</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.08</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">200</span><span class="p">):</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>        <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">200</span><span class="p">)</span><span class="o">*</span> <span class="mf">0.02</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 生成的点输入<code>Delaunay Mesh</code>产生一个风格面</p>
<h4 id="18-2for">1.8 2维嵌套for循环</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">%</span><span class="mi">20</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>            <span class="n">z</span> <span class="o">*=</span> <span class="p">(</span><span class="n">j</span><span class="o">%</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="p">;</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>            <span class="n">z</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">20</span> <span class="o">-</span> <span class="n">j</span><span class="o">%</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="p">;</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 嵌套两个循环以形成XY矩阵</p>
<h4 id="19-andor">1.9 循环里的and/or条件</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>        <span class="k">if</span><span class="p">(</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">20</span> <span class="p">):</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>            <span class="n">z</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>        <span class="k">elif</span><span class="p">(</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">20</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">40</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&gt;=</span><span class="mi">60</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">80</span><span class="p">):</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>            <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>        <span class="k">elif</span><span class="p">(</span> <span class="n">i</span><span class="o">==</span><span class="mi">50</span> <span class="ow">or</span> <span class="n">j</span><span class="o">==</span><span class="mi">50</span><span class="p">):</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>            <span class="n">z</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>        <span class="k">elif</span><span class="p">(</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">60</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&gt;=</span><span class="mi">20</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">80</span><span class="p">):</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>        <span class="k">elif</span><span class="p">(</span> <span class="ow">not</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">60</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&gt;=</span><span class="mi">25</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">35</span><span class="p">):</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>            <span class="n">z</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.1</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>        <span class="k">elif</span><span class="p">(</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">90</span> <span class="ow">and</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">90</span><span class="p">)</span> <span class="p">):</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>             <span class="n">z</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 考虑多种条件的应用，生成奇怪地形。</p>
<h4 id="110">1.10  条件和范式</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>        <span class="k">if</span><span class="p">(</span> <span class="n">i</span><span class="o">%</span><span class="mi">20</span><span class="o">&lt;</span><span class="mi">4</span> <span class="ow">or</span> <span class="n">j</span><span class="o">%</span><span class="mi">20</span><span class="o">&lt;</span><span class="mi">4</span> <span class="p">):</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>            <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>        <span class="k">elif</span><span class="p">(</span> <span class="n">i</span><span class="o">%</span><span class="mi">20</span><span class="o">+</span><span class="n">j</span><span class="o">%</span><span class="mi">20</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>            <span class="n">z</span> <span class="o">=</span> <span class="p">((</span><span class="mi">20</span> <span class="o">-</span> <span class="n">i</span><span class="o">%</span><span class="mi">20</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span><span class="o">%</span><span class="mi">20</span><span class="p">))</span><span class="o">*</span><span class="mf">0.03</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>            <span class="n">z</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>        <span class="k">elif</span><span class="p">(</span> <span class="n">i</span><span class="o">%</span><span class="mi">20</span><span class="o">&gt;=</span><span class="mi">5</span> <span class="ow">and</span> <span class="n">j</span><span class="o">%</span><span class="mi">20</span><span class="o">&lt;</span><span class="mi">10</span> <span class="p">):</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>            <span class="n">z</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span><span class="o">%</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">20</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">%</span><span class="mi">20</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">0.3</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>            <span class="n">z</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span><span class="o">%</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">%</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mf">0.3</span><span class="p">)</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 生成了奇怪的图形，这些有什么意义呢，嗯不知道。反正很奇特。</p>
<h2 id="2-gh-python">2. GH Python:输入</h2>
<h4 id="21">2.1 整型/浮点型输入</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">#building a point grid out of input parameters</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c1">#input type - x : int, y : int, z : float, u : float</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></code></pre></div>
- 需要按原示例，右键设置x,y的Type hint -&gt; int,否则程序会报错。
- VSCode里会显示变量未定义，忽略。放大电池点<code>+</code>号添加两个输入，确认变量名与程序里使用的一致。</p>
<h4 id="22">2.2 点输入</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># separate input points into 3 output groups</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="c1"># input type - x : Point3d (ListAccess)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="k">if</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">X</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">):</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="k">elif</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">%</span><span class="mf">0.5</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">):</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span></code></pre></div>
<img alt="" src="https://gitee.com/al666ex/RhinoPython101/raw/master/images/ghp/2.2.png" />
- 查看结果的GH文件里有显示最终结果而附加的电池
- 使用Populate 2D电池生成1000个随机点</p>
<h4 id="23-2">2.3 点输入（2）</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># This separates points and creates attractor controlled circles or rectangles </span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="c1"># input type - pts : Point3d (List Access), attr : Point3d (Item Access)</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>       <span class="c1"># Geometry library</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="k">if</span><span class="p">(</span> <span class="n">pt</span><span class="o">.</span><span class="n">Y</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pt</span><span class="o">.</span><span class="n">Y</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>        <span class="n">rect</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddRectangle</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="o">.</span><span class="n">WorldXY</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>        <span class="n">rs</span><span class="o">.</span><span class="n">MoveObject</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>        <span class="n">rs</span><span class="o">.</span><span class="n">MoveObject</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="o">-</span><span class="mf">0.75</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>        <span class="n">circle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mf">0.02</span><span class="o">*</span><span class="n">dist</span><span class="p">)</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
</span></code></pre></div>
- if条件筛选出Y值在整10+2范围的点赋予一个固定大小矩形
- else根据点与attractor的距离成反比赋予不同半径的圆</p>
<h4 id="24-3">2.4 点输入（3）</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># This connects points within the input distance only if number of connection is more than a certain number</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c1"># input type - pts : Point3d (List Access), threshold : float</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="n">closePts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="k">for</span> <span class="n">pt2</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        <span class="k">if</span><span class="p">(</span><span class="n">dist</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># exclude itself by &gt; 0</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>            <span class="n">closePts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">closePts</span><span class="p">)</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    <span class="k">if</span><span class="p">(</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        <span class="k">for</span> <span class="n">cpt</span> <span class="ow">in</span> <span class="n">closePts</span><span class="p">:</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>            <span class="n">zpt</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">count</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>            <span class="n">line</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddLine</span><span class="p">(</span><span class="n">zpt</span><span class="p">,</span> <span class="n">cpt</span><span class="p">)</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></code></pre></div>
- 每个点生成一个closePts列表，包含存在阀值内其他点的点。
- 对于closePts内每个元素，如果在阀值内点数量大于等于3，提升此点Z轴并连线到每个阀值内的点
- 很好</p>
<h4 id="25">2.5 曲线输入：最近均分间的直线</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># draw lines between closest points on the input curves</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1"># input type - curves : Curve (List Access), div : int</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="k">for</span> <span class="n">crv1</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">:</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">div</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>        <span class="n">pt1</span> <span class="o">=</span> <span class="n">crv1</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">div</span><span class="p">)</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt1</span><span class="p">)</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        <span class="n">minDist</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">#initialize</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>        <span class="k">for</span> <span class="n">crv2</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">:</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>            <span class="k">if</span><span class="p">(</span><span class="n">crv1</span> <span class="o">!=</span> <span class="n">crv2</span><span class="p">):</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">div</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>                    <span class="n">pt2</span> <span class="o">=</span> <span class="n">crv2</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">j</span><span class="o">/</span><span class="n">div</span><span class="p">)</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>                    <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>                    <span class="k">if</span><span class="p">(</span><span class="n">minDist</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span> <span class="c1"># first time to check</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>                        <span class="n">closest</span> <span class="o">=</span> <span class="n">pt2</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>                        <span class="n">minDist</span> <span class="o">=</span> <span class="n">dist</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>                    <span class="k">elif</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="n">minDist</span><span class="p">):</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>                        <span class="n">closest</span> <span class="o">=</span> <span class="n">pt2</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>                        <span class="n">minDist</span> <span class="o">=</span> <span class="n">dist</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>        <span class="n">line</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddLine</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">closest</span><span class="p">)</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></code></pre></div>
- 咱也看不出这有啥实际的意义，可能还是学得太少</p>
<h4 id="26-2">2.6 曲线输入（2）交叉点</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># this takes intersection of all curves and build geometry around the intersection</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="c1"># input type - curves : Curve (List Access)</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="k">for</span> <span class="n">curve1</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">:</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="k">for</span> <span class="n">curve2</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">:</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>        <span class="k">if</span><span class="p">(</span> <span class="n">curve1</span> <span class="o">!=</span> <span class="n">curve2</span><span class="p">):</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>            <span class="n">itxn</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Intersect</span><span class="o">.</span><span class="n">Intersection</span><span class="o">.</span><span class="n">CurveCurve</span><span class="p">(</span><span class="n">curve1</span><span class="p">,</span> <span class="n">curve2</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">)</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itxn</span><span class="o">.</span><span class="n">Item</span><span class="p">:</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>                <span class="c1"># intersection point</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>                <span class="n">ipt</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">PointA</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ipt</span><span class="p">)</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>                <span class="c1"># build geometry at intersection</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>                <span class="p">[</span><span class="n">success</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve1</span><span class="o">.</span><span class="n">ClosestPoint</span><span class="p">(</span><span class="n">ipt</span><span class="p">)</span> <span class="c1"># get t parameter</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>                <span class="k">if</span><span class="p">(</span><span class="n">success</span><span class="p">):</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>                    <span class="n">tan</span> <span class="o">=</span> <span class="n">curve1</span><span class="o">.</span><span class="n">TangentAt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="c1"># get tangent vector</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>                    <span class="n">tan</span> <span class="o">*=</span> <span class="mi">2</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>                    <span class="n">pt1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">ipt</span><span class="p">)</span> <span class="c1"># copy a new point</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>                    <span class="n">pt1</span> <span class="o">+=</span> <span class="n">tan</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>                    <span class="n">pt2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">ipt</span><span class="p">)</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>                    <span class="n">pt2</span> <span class="o">-=</span> <span class="n">tan</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>                    <span class="n">pt3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">ipt</span><span class="p">)</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>                    <span class="n">pt3</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>                    <span class="n">surf</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddSrfPt</span><span class="p">([</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">])</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>                    <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
</span></code></pre></div>
- 使用了Rhino.Geometry，对于Rhinocommon在官方网站的示例，都是VB和C#的，在这里要理解这个需要抽象能力，感觉python的Rhinocommon接口比C#的更抽象，抽象是个好东西。</p>
<h4 id="27">2.7 曲面输入:镶板</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># This makes surface panels by 4 points on an input surface</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="c1"># input type - surf : Surface, unum : int, vnum : int</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">panels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unum</span><span class="p">):</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>        <span class="n">pt11</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        <span class="n">pt12</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>        <span class="n">pt21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>        <span class="n">pt22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>        <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt11</span><span class="p">,</span> <span class="n">pt12</span><span class="p">,</span> <span class="n">pt22</span><span class="p">,</span> <span class="n">pt21</span><span class="p">)</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>        <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span></code></pre></div>
- 以u、v数量切分曲面，然后生成平面，相当于把曲面平面近似化，很有意思
- 注意输出是一个曲面</p>
<h4 id="28-2">2.8 曲面输入:镶板（2）</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># This makes surface panels by 3 points on an input surface</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1"># input type - surf : Surface, unum : int, vnum : int</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">panels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unum</span><span class="p">):</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>        <span class="n">pt1</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>        <span class="n">pt2</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.9</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>        <span class="n">pt3</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">1.2</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>        <span class="n">pt4</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.3</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>        <span class="n">pt5</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.6</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.3</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>        <span class="n">n1</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        <span class="n">n2</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.9</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>        <span class="n">n3</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">1.2</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>        <span class="n">n4</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.3</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>        <span class="n">n5</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.6</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.3</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>        <span class="n">pt1</span> <span class="o">+=</span> <span class="n">n1</span><span class="o">*</span><span class="mf">0.2</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>        <span class="n">pt2</span> <span class="o">+=</span> <span class="n">n2</span><span class="o">*</span><span class="mf">0.2</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>        <span class="n">pt3</span> <span class="o">+=</span> <span class="n">n3</span><span class="o">*-</span><span class="mf">0.1</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>        <span class="n">pt4</span> <span class="o">+=</span> <span class="n">n4</span><span class="o">*</span><span class="mf">1.3</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>        <span class="n">pt5</span> <span class="o">+=</span> <span class="n">n5</span><span class="o">*</span><span class="mf">1.5</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>        <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt5</span><span class="p">)</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>        <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>        <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">,</span> <span class="n">pt5</span><span class="p">)</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>        <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>        <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt4</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt5</span><span class="p">)</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>        <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span></code></pre></div>
- 以不同的方式同样生成平面，有趣</p>
<h4 id="29-3">2.9 曲面输入:镶板（3）</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># This makes surface panels by lofting on an input surface</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="c1"># input type - surf : Surface, unum : int, vnum : int, panelWdith : float, panelDepth : float</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="n">panels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unum</span><span class="p">):</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>        <span class="n">pt11</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>        <span class="n">pt12</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="n">panelWidth</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>        <span class="n">pt21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.75</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>        <span class="n">pt22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">panelWidth</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.75</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>        <span class="n">pt31</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">1.5</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>        <span class="n">pt32</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">panelWidth</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">1.5</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>        <span class="n">n21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.25</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>        <span class="n">n22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.25</span><span class="o">+</span><span class="n">panelWidth</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        <span class="n">pt21</span> <span class="o">+=</span> <span class="n">n21</span><span class="o">*</span><span class="n">panelDepth</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>        <span class="n">pt22</span> <span class="o">+=</span> <span class="n">n22</span><span class="o">*</span><span class="n">panelDepth</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>        <span class="n">line1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">LineCurve</span><span class="p">(</span><span class="n">pt11</span><span class="p">,</span> <span class="n">pt12</span><span class="p">)</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>        <span class="n">line2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">LineCurve</span><span class="p">(</span><span class="n">pt21</span><span class="p">,</span> <span class="n">pt22</span><span class="p">)</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>        <span class="n">line3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">LineCurve</span><span class="p">(</span><span class="n">pt31</span><span class="p">,</span> <span class="n">pt32</span><span class="p">)</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>        <span class="n">panelSurf</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Brep</span><span class="o">.</span><span class="n">CreateFromLoft</span><span class="p">([</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">,</span> <span class="n">line3</span><span class="p">],</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="o">.</span><span class="n">Unset</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="o">.</span><span class="n">Unset</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">LoftType</span><span class="o">.</span><span class="n">Straight</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>        <span class="n">panels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">panelSurf</span><span class="p">)</span>
</span></code></pre></div>
- 通过放样生成平面
- 注意rg的使用方法，想象一下直接在Rhino里对应的操作是什么，熟悉Rhino API 在ghpython里的调用方法</p>
<h4 id="210-4">2.10 曲面输入:镶板（4）</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># This makes surface panels by 6 points on an input surface</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="c1"># input type: surf - Surface, unum - int, vnum - int, panelDepth - float</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="n">panels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unum</span><span class="p">):</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>        <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>            <span class="n">pt11</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>            <span class="n">pt21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">1.5</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>            <span class="n">pt31</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>            <span class="n">pt12</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>            <span class="n">pt22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>            <span class="n">pt32</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>            <span class="n">n21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">1.5</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>            <span class="n">n22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>            <span class="n">pt21</span> <span class="o">+=</span> <span class="n">n21</span><span class="o">*</span><span class="n">panelDepth</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>            <span class="n">pt22</span> <span class="o">+=</span> <span class="n">n22</span><span class="o">*</span><span class="n">panelDepth</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>            <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt11</span><span class="p">,</span><span class="n">pt21</span><span class="p">,</span><span class="n">pt22</span><span class="p">,</span><span class="n">pt12</span><span class="p">)</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>            <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>            <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt21</span><span class="p">,</span><span class="n">pt31</span><span class="p">,</span><span class="n">pt32</span><span class="p">,</span><span class="n">pt22</span><span class="p">)</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>            <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>            <span class="n">pt11</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>            <span class="n">pt21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>            <span class="n">pt31</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>            <span class="n">pt12</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>            <span class="n">pt22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">1.5</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>            <span class="n">pt32</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>            <span class="n">n21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>            <span class="n">n22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">1.5</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>            <span class="n">pt21</span> <span class="o">+=</span> <span class="n">n21</span><span class="o">*</span><span class="n">panelDepth</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>            <span class="n">pt22</span> <span class="o">+=</span> <span class="n">n22</span><span class="o">*</span><span class="n">panelDepth</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>            <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt11</span><span class="p">,</span><span class="n">pt21</span><span class="p">,</span><span class="n">pt22</span><span class="p">,</span><span class="n">pt12</span><span class="p">)</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>            <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a>            <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt21</span><span class="p">,</span><span class="n">pt31</span><span class="p">,</span><span class="n">pt32</span><span class="p">,</span><span class="n">pt22</span><span class="p">)</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a>            <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span></code></pre></div>
- 继续镶板，开始有点理解这些花样镶板的作用了，好像是给建筑做表皮用的。</p>
<h4 id="211-5">2.11 曲面输入:镶板（5）</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># This makes surface panels by 6 points on an input surface</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c1"># input type: surf - Surface, unum - int, vnum - int, panelDepth - float</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="n">panels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unum</span><span class="p">):</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="o">%</span><span class="mi">6</span> <span class="o">/</span> <span class="mi">6</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        <span class="n">pt11</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>        <span class="n">pt21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>        <span class="n">pt12</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>        <span class="n">pt22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">ratio</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>        <span class="n">pt13</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>        <span class="n">pt23</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>        <span class="n">n22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>        <span class="n">pt22</span> <span class="o">+=</span> <span class="n">n22</span><span class="o">*</span> <span class="n">panelDepth</span> <span class="o">*</span> <span class="n">ratio</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>        <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt11</span><span class="p">,</span><span class="n">pt21</span><span class="p">,</span><span class="n">pt22</span><span class="p">,</span><span class="n">pt12</span><span class="p">)</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>        <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>        <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt12</span><span class="p">,</span><span class="n">pt22</span><span class="p">,</span><span class="n">pt23</span><span class="p">,</span><span class="n">pt13</span><span class="p">)</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>        <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span></code></pre></div>
- 继续生成各种镶板</p>
<h4 id="212-6">2.12 曲面输入:镶板（6）</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># This makes surface panels by lofting on an input surface</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1"># input type: surf - Surface, unum - int, vnum - int, panelDepth - float</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="n">panels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unum</span><span class="p">):</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>        <span class="n">pt1</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>        <span class="n">pt2</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>        <span class="n">pt3</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>        <span class="n">pt4</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>            <span class="n">n1</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>            <span class="n">n2</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>            <span class="n">n3</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>            <span class="n">n4</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>            <span class="n">uvRatio</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.3</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>            <span class="n">depthRatio</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>            <span class="n">pt5</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="o">-</span><span class="n">uvRatio</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="o">-</span><span class="n">uvRatio</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>            <span class="n">pt6</span> <span class="o">=</span> <span class="n">pt2</span> 
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>            <span class="n">pt7</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">uvRatio</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">uvRatio</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>            <span class="n">pt8</span> <span class="o">=</span> <span class="n">pt4</span> 
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>            <span class="n">pt5</span> <span class="o">+=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">panelDepth</span> <span class="o">*</span> <span class="n">depthRatio</span> 
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>            <span class="n">pt6</span> <span class="o">+=</span> <span class="n">n2</span> <span class="o">*</span> <span class="n">panelDepth</span> <span class="o">*</span> <span class="n">depthRatio</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>            <span class="n">pt7</span> <span class="o">+=</span> <span class="n">n3</span> <span class="o">*</span> <span class="n">panelDepth</span> <span class="o">*</span> <span class="n">depthRatio</span> 
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>            <span class="n">pt8</span> <span class="o">+=</span> <span class="n">n4</span> <span class="o">*</span> <span class="n">panelDepth</span> <span class="o">*</span> <span class="n">depthRatio</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>            <span class="n">polyline1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">PolylineCurve</span><span class="p">([</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt2</span><span class="p">,</span><span class="n">pt3</span><span class="p">,</span><span class="n">pt4</span><span class="p">,</span><span class="n">pt1</span><span class="p">])</span>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>            <span class="n">polyline2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">PolylineCurve</span><span class="p">([</span><span class="n">pt5</span><span class="p">,</span><span class="n">pt6</span><span class="p">,</span><span class="n">pt7</span><span class="p">,</span><span class="n">pt8</span><span class="p">,</span><span class="n">pt5</span><span class="p">])</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>            <span class="n">panelSurf</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Brep</span><span class="o">.</span><span class="n">CreateFromLoft</span><span class="p">([</span><span class="n">polyline1</span><span class="p">,</span> <span class="n">polyline2</span><span class="p">],</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="o">.</span><span class="n">Unset</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="o">.</span><span class="n">Unset</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">LoftType</span><span class="o">.</span><span class="n">Straight</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>            <span class="n">panels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">panelSurf</span><span class="p">)</span>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>            <span class="n">panel</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>            <span class="n">panels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
</span></code></pre></div>
- 加入随机元素继续镶板</p>
<h4 id="213">2.13 树形数据输入：迭代所有元素</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># this iterates a tree of points and put circles</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="c1"># input type - ptTree : Point3d (Tree Access)</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="k">for</span> <span class="n">ptList</span> <span class="ow">in</span> <span class="n">ptTree</span><span class="o">.</span><span class="n">Branches</span><span class="p">:</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">ptList</span><span class="p">:</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>        <span class="n">circle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
</span></code></pre></div>
<img alt="看一下树的结构" src="https://gitee.com/al666ex/RhinoPython101/raw/master/images/ghp/2.13.png" />
- 对于树形数据的理解，应该是嵌套列表</p>
<h4 id="214-2">2.14 树形数据输入（2）：条件迭代</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># this iterates a tree of points and put circles</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="c1"># input type - ptTree : Point3d (Tree Access)</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ptTree</span><span class="o">.</span><span class="n">BranchCount</span><span class="p">):</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>    <span class="n">ptList</span> <span class="o">=</span> <span class="n">ptTree</span><span class="o">.</span><span class="n">Branch</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    <span class="n">ptNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ptList</span><span class="p">)</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ptNum</span><span class="p">):</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="k">if</span><span class="p">(</span> <span class="n">i</span><span class="o">==</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">23</span> <span class="ow">or</span> <span class="n">i</span><span class="o">==</span><span class="mi">20</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">i</span><span class="o">==</span><span class="mi">32</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">18</span><span class="p">):</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>            <span class="n">circle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">ptList</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>            <span class="n">circle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">ptList</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mf">0.2</span><span class="p">)</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
</span></code></pre></div>
- 根据条件对树形数据内部进行迭代处理</p>
<h4 id="215-3">2.15 树形数据输入（3）：连接最近的树元素</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># this connects closest points between branches in a tree</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="c1"># input type - ptTree : Curve (Tree Access)</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="k">for</span> <span class="n">ptList</span> <span class="ow">in</span> <span class="n">ptTree</span><span class="o">.</span><span class="n">Branches</span><span class="p">:</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">ptList</span><span class="p">:</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>        <span class="n">minDist</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># initialize</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>        <span class="k">for</span> <span class="n">ptList2</span> <span class="ow">in</span> <span class="n">ptTree</span><span class="o">.</span><span class="n">Branches</span><span class="p">:</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>            <span class="k">if</span><span class="p">(</span><span class="n">ptList</span><span class="o">!=</span><span class="n">ptList2</span><span class="p">):</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>                <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">ptList2</span><span class="p">)</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>                <span class="k">for</span> <span class="n">pt2</span> <span class="ow">in</span> <span class="n">ptList2</span><span class="p">:</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>                    <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>                    <span class="k">if</span><span class="p">(</span><span class="n">minDist</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span> <span class="c1"># first time</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>                        <span class="n">minDist</span> <span class="o">=</span> <span class="n">dist</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>                        <span class="n">closest</span> <span class="o">=</span> <span class="n">pt2</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>                    <span class="k">elif</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="n">minDist</span><span class="p">):</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>                        <span class="n">minDist</span> <span class="o">=</span> <span class="n">dist</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>                        <span class="n">closest</span> <span class="o">=</span> <span class="n">pt2</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>        <span class="n">line</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddLine</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">closest</span><span class="p">)</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></code></pre></div>
- 树形数据数据处理</p>
<h2 id="3-gh-python">3. GH Python: 函数和递归</h2>
<h4 id="31-1">3.1 简单函数：1个参数</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># This draws a line pattern at each input point</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="c1"># input type - pts : Point3d (List Access)</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="c1"># function definition</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">drawWhorl</span><span class="p">(</span><span class="n">pt</span><span class="p">):</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>    <span class="n">r1</span> <span class="o">=</span> <span class="mf">0.3</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="n">r2</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="n">num</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>        <span class="n">vec1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>        <span class="n">vec1</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">num</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>        <span class="n">vec2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>        <span class="n">vec2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">num</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>        <span class="n">vec1</span> <span class="o">+=</span> <span class="n">pt</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>        <span class="n">vec2</span> <span class="o">+=</span> <span class="n">pt</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>        <span class="n">line</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddLine</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    <span class="k">return</span> <span class="n">lines</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="c1"># main</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>    <span class="n">lines</span> <span class="o">=</span> <span class="n">drawWhorl</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>    <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="c1"># add all lines</span>
</span></code></pre></div>
- 定义一个函数，并在程序内调用。和正常的用法并无二致。</p>
<h4 id="32-3">3.2 简单函数：3个参数</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># this adds tubular surface on an input surface by a function</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="c1"># input type - surf : Surface (Item Access)</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">addTube</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    <span class="n">circle1</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="n">radius</span><span class="p">)</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">*</span> <span class="mf">0.1</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>    <span class="n">circle2</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>    <span class="n">pt3</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    <span class="n">circle3</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>    <span class="n">loftResult</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddLoftSrf</span><span class="p">([</span><span class="n">circle1</span><span class="p">,</span> <span class="n">circle2</span><span class="p">,</span> <span class="n">circle3</span><span class="p">])</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>    <span class="k">return</span> <span class="n">loftResult</span> <span class="c1"># loftResult is a list</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="n">vshift</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">udiv</span><span class="p">):</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>    <span class="n">vshift</span> <span class="o">+=</span> <span class="mf">0.01</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vdiv</span><span class="p">):</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">i</span><span class="o">/</span><span class="n">udiv</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">j</span><span class="o">/</span><span class="n">vdiv</span> <span class="o">+</span> <span class="n">vshift</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>        <span class="k">if</span><span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">):</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">%</span><span class="mf">1.0</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>        <span class="n">pt</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>        <span class="n">nml</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">addTube</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">nml</span><span class="p">,</span> <span class="mf">0.6</span><span class="o">-</span><span class="n">u</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>        <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="c1"># result is a list</span>
</span></code></pre></div>
- 记得输出的曲面要选择Reparameterize,要不然大概率生成的管子会挤到一堆</p>
<h4 id="33">3.3 线分支函数</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># This adds curves on the input curve rotated from tis tangent direction</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="c1"># input type - curve : Curve (Item Access), count : int (Item Access), axis : Vector3d (Item Access), angle : float (Item Access), length : float (Item Access), frequency : float (Item Access)</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">curveOnCurve</span><span class="p">(</span><span class="n">crv</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">rollAngle</span><span class="p">):</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="n">pt</span> <span class="o">=</span> <span class="n">crv</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    <span class="n">tan</span> <span class="o">=</span> <span class="n">crv</span><span class="o">.</span><span class="n">TangentAt</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>    <span class="n">ax</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">rollAngle</span><span class="p">,</span> <span class="n">tan</span><span class="p">)</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>    <span class="n">tan</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>    <span class="n">tan</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">+</span> <span class="n">tan</span> <span class="o">*</span> <span class="n">length</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    <span class="n">tan</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>    <span class="n">pt3</span> <span class="o">=</span> <span class="n">pt2</span> <span class="o">+</span> <span class="n">tan</span> <span class="o">*</span> <span class="n">length</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>    <span class="k">return</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsCurve</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">])</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>    <span class="n">u</span> <span class="o">=</span> <span class="n">i</span><span class="o">/</span><span class="n">count</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>    <span class="n">ang</span> <span class="o">=</span> <span class="n">angle</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">frequency</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>    <span class="nb">len</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">frequency</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>    <span class="n">crv</span> <span class="o">=</span> <span class="n">curveOnCurve</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">u</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">crv</span><span class="p">)</span>
</span></code></pre></div>
- 尝试理解 </p>
<h4 id="34a">3.4a 直线递归</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># this creates fractal lines by recursive function</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="c1"># input type - line : Line (Item Access)</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>    <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.15</span><span class="p">)</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>    <span class="n">pt3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.65</span><span class="p">)</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>    <span class="n">pt4</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.65</span><span class="p">)</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>    <span class="n">pt5</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>    <span class="nb">dir</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pt5</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">pt1</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pt5</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">pt1</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">pt5</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="n">pt5</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>    <span class="nb">dir</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>    <span class="n">pt3</span> <span class="o">+=</span> <span class="nb">dir</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>    <span class="n">line1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>    <span class="n">line2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>    <span class="n">line3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>    <span class="n">line4</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt4</span><span class="p">,</span> <span class="n">pt5</span><span class="p">)</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line4</span><span class="p">)</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>    <span class="k">if</span><span class="p">(</span><span class="n">depth</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span> <span class="c1"># recursion</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span> <span class="c1"># recursion</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line3</span><span class="p">)</span>
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="c1"># main</span>
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="n">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div>
- 调用自身的函数叫递归函数，注意递归的终止条件
- 可以把9输入为一个变量，在grasshopper里从0拉到9，可以看到递归的过程</p>
<h4 id="34b">3.4b 直线递归</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># this creates fractal lines by recursive function</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="c1"># input type - line : Line (Item Access), div : int (Item Access)</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>    <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.27</span><span class="p">)</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    <span class="n">pt3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>    <span class="n">pt4</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>    <span class="n">pt5</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>    <span class="nb">dir</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pt5</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">pt1</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pt5</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">pt1</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">pt5</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">pt1</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> 
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>    <span class="nb">dir</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>    <span class="n">pt3</span> <span class="o">+=</span> <span class="nb">dir</span> <span class="o">*</span> <span class="mf">0.27</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>    <span class="n">line1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>    <span class="n">line2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>    <span class="n">line3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>    <span class="n">line4</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt4</span><span class="p">,</span> <span class="n">pt5</span><span class="p">)</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line4</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line3</span><span class="p">)</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line4</span><span class="p">)</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a>
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a><span class="n">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div>
- 同上，另一种递归尝试</p>
<h4 id="34c">3.4c 直线递归</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># this creates fractal lines by recursive function</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c1"># input type - line : Line (Item Access), div : int (Item Access)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>    <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>    <span class="n">pt3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>    <span class="n">pt4</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>    <span class="n">pt5</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>    <span class="n">pt6</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>    <span class="nb">dir</span> <span class="o">=</span> <span class="n">pt6</span> <span class="o">-</span> <span class="n">pt1</span> 
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>    <span class="n">dir2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>    <span class="n">dir2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>    <span class="n">dir2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>    <span class="n">pt3</span> <span class="o">+=</span> <span class="n">dir2</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>    <span class="n">pt4</span> <span class="o">+=</span> <span class="n">dir2</span> <span class="o">*</span> <span class="mf">0.5</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>    <span class="n">line1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>    <span class="n">line2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>    <span class="n">line3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>    <span class="n">line4</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt4</span><span class="p">,</span> <span class="n">pt5</span><span class="p">)</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>    <span class="n">line5</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt5</span><span class="p">,</span> <span class="n">pt6</span><span class="p">)</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>        <span class="n">axis</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line4</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line5</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line3</span><span class="p">)</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line4</span><span class="p">)</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line5</span><span class="p">)</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a><span class="n">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div>
- 继续递归，这次是在3维方向上的扩展</p>
<h4 id="34d">3.4d 直线递归</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># this creates fractal lines and surfaces by recursive function</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="c1"># input type - line : Line (Item Access), div : int (Item Access)</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>    <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>    <span class="n">pt3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>    <span class="n">pt4</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>    <span class="n">pt5</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>    <span class="nb">dir</span> <span class="o">=</span> <span class="n">pt5</span> <span class="o">-</span> <span class="n">pt1</span> 
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>    <span class="n">dir2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span> <span class="c1"># copy</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>    <span class="n">dir2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>    <span class="n">dir2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.25</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>    <span class="n">pt3</span> <span class="o">+=</span> <span class="n">dir2</span> <span class="o">*</span> <span class="mf">0.45</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>    <span class="n">line1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>    <span class="n">line2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>    <span class="n">line3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>    <span class="n">line4</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt4</span><span class="p">,</span> <span class="n">pt5</span><span class="p">)</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>    <span class="n">srf</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span><span class="n">pt3</span><span class="p">,</span><span class="n">pt4</span><span class="p">)</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">srf</span><span class="p">)</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>        <span class="n">axis</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>        <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line4</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line3</span><span class="p">)</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line4</span><span class="p">)</span>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a><span class="n">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div>
- 继续递归，这次会新生成面，直线取5点，用点来生成线、面。</p>
<h4 id="35a">3.5a 通过递归分支直线</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># this creates random branching lines with recursion</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="c1"># input type - line : Line (Item Access)</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>    <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>    <span class="n">dir1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pt2</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">pt1</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pt2</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">pt1</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">pt2</span><span class="o">.</span><span class="n">Z</span><span class="o">-</span><span class="n">pt1</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>    <span class="n">dir2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">dir1</span><span class="p">)</span> <span class="c1"># copy</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>    <span class="n">dir1</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.4</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span> <span class="c1"># random angle</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>    <span class="n">dir2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*-</span><span class="mf">0.4</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>    <span class="n">dir1</span> <span class="o">*=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.8</span><span class="p">;</span> <span class="c1"># random scale</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>    <span class="n">dir2</span> <span class="o">*=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.8</span><span class="p">;</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>    <span class="n">line1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">dir1</span><span class="p">)</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>    <span class="n">line2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>    <span class="k">if</span><span class="p">(</span><span class="n">depth</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>        <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.9</span><span class="p">):</span> <span class="c1"># random omission</span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>            <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>        <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.8</span><span class="p">):</span> <span class="c1"># random omission</span>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>            <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="c1"># main</span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="n">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div>
- 生成树形结构，注意两个矢量的旋转与绽放</p>
<h4 id="35b">3.5b 通过递归分支直线</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># this creates random branching lines with recursion</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="c1"># input type: line - Line (Item Access), div - int (Item Access)</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>    <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>    <span class="n">dir1</span> <span class="o">=</span> <span class="n">pt2</span> <span class="o">-</span> <span class="n">pt1</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>    <span class="n">dir2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">dir1</span><span class="p">)</span> <span class="c1"># copy</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>    <span class="n">dir1</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span> <span class="c1"># random angle</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>    <span class="n">dir2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>    <span class="n">dir1</span> <span class="o">*=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">;</span> <span class="c1"># random scale</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>    <span class="n">dir2</span> <span class="o">*=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">;</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>    <span class="n">line1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">dir1</span><span class="p">)</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>    <span class="n">line2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a>    <span class="k">if</span><span class="p">(</span><span class="n">depth</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>        <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.9</span><span class="p">):</span> <span class="c1"># random omission</span>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a>            <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a>        <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.8</span><span class="p">):</span> <span class="c1"># random omission</span>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a>            <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="n">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div>
- 请递归理解 </p>
<h4 id="36">3.6  矩形平面递归</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Rectangular surface recursion</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1"># input type - surf : Surface (Item Access), offset : float (Item Access), scale : float (Item Access), percent : float (Item Access), recursion : int (Item Access)</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveSurf</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">offs</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>                <span class="n">pt1</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>                <span class="n">pt2</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>                <span class="n">pt3</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>                <span class="n">pt4</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>                <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt1</span><span class="o">+</span><span class="n">pt2</span><span class="o">+</span><span class="n">pt3</span><span class="o">+</span><span class="n">pt4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>                <span class="n">pt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt1</span><span class="o">-</span><span class="n">center</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">+</span><span class="n">center</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>                <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt2</span><span class="o">-</span><span class="n">center</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">+</span><span class="n">center</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>                <span class="n">pt3</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt3</span><span class="o">-</span><span class="n">center</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">+</span><span class="n">center</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>                <span class="n">pt4</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt4</span><span class="o">-</span><span class="n">center</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">+</span><span class="n">center</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>                <span class="n">n</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>                <span class="n">n</span> <span class="o">*=</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>                <span class="n">pt1</span> <span class="o">+=</span> <span class="n">n</span> 
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>                <span class="n">pt2</span> <span class="o">+=</span> <span class="n">n</span> 
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>                <span class="n">pt3</span> <span class="o">+=</span> <span class="n">n</span> 
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>                <span class="n">pt4</span> <span class="o">+=</span> <span class="n">n</span> 
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt2</span><span class="p">,</span><span class="n">pt3</span><span class="p">,</span><span class="n">pt4</span><span class="p">)</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a>                <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>                    <span class="n">s</span><span class="o">.</span><span class="n">SetDomain</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a>                    <span class="n">s</span><span class="o">.</span><span class="n">SetDomain</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a>                    <span class="n">recursiveSurf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">offs</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="k">if</span> <span class="n">surf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a>    <span class="n">recursiveSurf</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">recursion</span><span class="p">)</span>
</span></code></pre></div>
- ......</p>
<h4 id="37-">3.7 通过递归分支直线-&gt;生成方块</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># this creates random branching lines with recursion</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="c1"># input type: line - Line (Item Access), div - int (Item Access)</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>    <span class="n">pt1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>    <span class="n">dir0</span> <span class="o">=</span> <span class="n">pt2</span> <span class="o">-</span> <span class="n">pt1</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>    <span class="n">dir1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">dir0</span><span class="p">)</span> <span class="c1"># copy</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>    <span class="n">dir2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">dir0</span><span class="p">)</span> <span class="c1"># copy</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>    <span class="n">dir1</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>    <span class="n">dir1</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dir0</span><span class="p">)</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>    <span class="n">dir2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>    <span class="n">dir2</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">dir0</span><span class="p">)</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>    <span class="n">dir1</span> <span class="o">*=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">;</span> <span class="c1"># random scale</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>    <span class="n">dir2</span> <span class="o">*=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">;</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>    <span class="n">line1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">dir1</span><span class="p">)</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a>    <span class="n">line2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Line</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>    <span class="n">axis</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">dir0</span><span class="p">,</span><span class="n">dir1</span><span class="p">)</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a>    <span class="n">axis</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a>    <span class="n">box</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="o">.</span><span class="n">WorldXY</span><span class="p">,</span> <span class="p">[</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">dir1</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">dir2</span><span class="p">,</span> <span class="n">pt2</span><span class="o">+</span><span class="n">axis</span><span class="o">*</span><span class="n">dir1</span><span class="o">.</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a>    <span class="k">if</span><span class="p">(</span><span class="n">depth</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a>        <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.9</span><span class="p">):</span> <span class="c1"># random omission</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a>            <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a>        <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.8</span><span class="p">):</span> <span class="c1"># random omission</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a>            <span class="c1">#axis = rg.Vector3d.CrossProduct(dir0,dir2)</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a>            <span class="n">recursiveLine</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a><span class="n">recursiveLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div>
- 通过一条直线的起点pt1和终点pt2，生成向量dir0(Vector3d)
- 两次旋转dir0得到dir1/dir2
- 通过这3个向量，移动pt2得到总共5个点[pt1, pt2, pt2+dir1, pt2+dir2, pt2+axis*dir1.Length/2]，生成包含这5个点的最小box
- 调用自身递归</p>
<h4 id="38">3.8 曲面上的细分方块</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># this generates subdivided boxes on a surface recursively</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="c1"># input type - surf : Surface (Item Access), unum : int (Item Access), vnum : int (Item Access), offset : float (Item Access), recursion : float (Item Access), percent : float (Item Access)</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolate</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">ratio</span><span class="p">):</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>    <span class="k">return</span> <span class="n">pt1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="n">pt2</span><span class="o">*</span><span class="n">ratio</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>    <span class="n">upt11</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">)</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>    <span class="n">upt21</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">)</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>    <span class="n">upt12</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">u</span><span class="p">)</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>    <span class="n">upt22</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">u</span><span class="p">)</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>    <span class="n">vpt1</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">upt21</span><span class="p">,</span><span class="n">upt11</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>    <span class="n">vpt2</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">upt22</span><span class="p">,</span><span class="n">upt12</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>    <span class="k">return</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">vpt2</span><span class="p">,</span><span class="n">vpt1</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">divideBox</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>    <span class="n">pts2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a>                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a>                    <span class="n">p111</span> <span class="o">=</span> <span class="n">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a>                    <span class="n">p112</span> <span class="o">=</span> <span class="n">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a>                    <span class="n">p121</span> <span class="o">=</span> <span class="n">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a>                    <span class="n">p122</span> <span class="o">=</span> <span class="n">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-28"><a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a>                    <span class="n">p211</span> <span class="o">=</span> <span class="n">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-29"><a id="__codelineno-36-29" name="__codelineno-36-29" href="#__codelineno-36-29"></a>                    <span class="n">p212</span> <span class="o">=</span> <span class="n">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-30"><a id="__codelineno-36-30" name="__codelineno-36-30" href="#__codelineno-36-30"></a>                    <span class="n">p221</span> <span class="o">=</span> <span class="n">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-31"><a id="__codelineno-36-31" name="__codelineno-36-31" href="#__codelineno-36-31"></a>                    <span class="n">p222</span> <span class="o">=</span> <span class="n">boxPt</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-36-32"><a id="__codelineno-36-32" name="__codelineno-36-32" href="#__codelineno-36-32"></a>                    <span class="n">bpts</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">p111</span><span class="p">,</span><span class="n">p112</span><span class="p">],[</span><span class="n">p121</span><span class="p">,</span><span class="n">p122</span><span class="p">]],[[</span><span class="n">p211</span><span class="p">,</span><span class="n">p212</span><span class="p">],[</span><span class="n">p221</span><span class="p">,</span><span class="n">p222</span><span class="p">]]]</span>
</span><span id="__span-36-33"><a id="__codelineno-36-33" name="__codelineno-36-33" href="#__codelineno-36-33"></a>                    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="__span-36-34"><a id="__codelineno-36-34" name="__codelineno-36-34" href="#__codelineno-36-34"></a>                        <span class="n">bpts2</span> <span class="o">=</span> <span class="n">divideBox</span><span class="p">(</span><span class="n">bpts</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-36-35"><a id="__codelineno-36-35" name="__codelineno-36-35" href="#__codelineno-36-35"></a>                        <span class="n">pts2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bpts2</span><span class="p">)</span>
</span><span id="__span-36-36"><a id="__codelineno-36-36" name="__codelineno-36-36" href="#__codelineno-36-36"></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-36-37"><a id="__codelineno-36-37" name="__codelineno-36-37" href="#__codelineno-36-37"></a>                        <span class="n">pts2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bpts</span><span class="p">)</span>
</span><span id="__span-36-38"><a id="__codelineno-36-38" name="__codelineno-36-38" href="#__codelineno-36-38"></a>    <span class="k">return</span> <span class="n">pts2</span>
</span><span id="__span-36-39"><a id="__codelineno-36-39" name="__codelineno-36-39" href="#__codelineno-36-39"></a>
</span><span id="__span-36-40"><a id="__codelineno-36-40" name="__codelineno-36-40" href="#__codelineno-36-40"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-36-41"><a id="__codelineno-36-41" name="__codelineno-36-41" href="#__codelineno-36-41"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unum</span><span class="p">):</span>
</span><span id="__span-36-42"><a id="__codelineno-36-42" name="__codelineno-36-42" href="#__codelineno-36-42"></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-36-43"><a id="__codelineno-36-43" name="__codelineno-36-43" href="#__codelineno-36-43"></a>        <span class="n">p11</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-36-44"><a id="__codelineno-36-44" name="__codelineno-36-44" href="#__codelineno-36-44"></a>        <span class="n">p12</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-36-45"><a id="__codelineno-36-45" name="__codelineno-36-45" href="#__codelineno-36-45"></a>        <span class="n">p21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-36-46"><a id="__codelineno-36-46" name="__codelineno-36-46" href="#__codelineno-36-46"></a>        <span class="n">p22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">PointAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-36-47"><a id="__codelineno-36-47" name="__codelineno-36-47" href="#__codelineno-36-47"></a>
</span><span id="__span-36-48"><a id="__codelineno-36-48" name="__codelineno-36-48" href="#__codelineno-36-48"></a>        <span class="n">n11</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-36-49"><a id="__codelineno-36-49" name="__codelineno-36-49" href="#__codelineno-36-49"></a>        <span class="n">n12</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-36-50"><a id="__codelineno-36-50" name="__codelineno-36-50" href="#__codelineno-36-50"></a>        <span class="n">n21</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-36-51"><a id="__codelineno-36-51" name="__codelineno-36-51" href="#__codelineno-36-51"></a>        <span class="n">n22</span> <span class="o">=</span> <span class="n">surf</span><span class="o">.</span><span class="n">NormalAt</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">unum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">vnum</span><span class="p">)</span>
</span><span id="__span-36-52"><a id="__codelineno-36-52" name="__codelineno-36-52" href="#__codelineno-36-52"></a>
</span><span id="__span-36-53"><a id="__codelineno-36-53" name="__codelineno-36-53" href="#__codelineno-36-53"></a>        <span class="n">n11</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-36-54"><a id="__codelineno-36-54" name="__codelineno-36-54" href="#__codelineno-36-54"></a>        <span class="n">n12</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-36-55"><a id="__codelineno-36-55" name="__codelineno-36-55" href="#__codelineno-36-55"></a>        <span class="n">n21</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-36-56"><a id="__codelineno-36-56" name="__codelineno-36-56" href="#__codelineno-36-56"></a>        <span class="n">n22</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-36-57"><a id="__codelineno-36-57" name="__codelineno-36-57" href="#__codelineno-36-57"></a>        <span class="n">q11</span> <span class="o">=</span> <span class="n">p11</span> <span class="o">+</span> <span class="n">n11</span><span class="o">*</span><span class="n">offset</span>
</span><span id="__span-36-58"><a id="__codelineno-36-58" name="__codelineno-36-58" href="#__codelineno-36-58"></a>        <span class="n">q12</span> <span class="o">=</span> <span class="n">p12</span> <span class="o">+</span> <span class="n">n12</span><span class="o">*</span><span class="n">offset</span>
</span><span id="__span-36-59"><a id="__codelineno-36-59" name="__codelineno-36-59" href="#__codelineno-36-59"></a>        <span class="n">q21</span> <span class="o">=</span> <span class="n">p21</span> <span class="o">+</span> <span class="n">n21</span><span class="o">*</span><span class="n">offset</span>
</span><span id="__span-36-60"><a id="__codelineno-36-60" name="__codelineno-36-60" href="#__codelineno-36-60"></a>        <span class="n">q22</span> <span class="o">=</span> <span class="n">p22</span> <span class="o">+</span> <span class="n">n22</span><span class="o">*</span><span class="n">offset</span>
</span><span id="__span-36-61"><a id="__codelineno-36-61" name="__codelineno-36-61" href="#__codelineno-36-61"></a>
</span><span id="__span-36-62"><a id="__codelineno-36-62" name="__codelineno-36-62" href="#__codelineno-36-62"></a>        <span class="n">boxPts</span> <span class="o">=</span> <span class="n">divideBox</span><span class="p">([[[</span><span class="n">p11</span><span class="p">,</span><span class="n">q11</span><span class="p">],[</span><span class="n">p12</span><span class="p">,</span><span class="n">q12</span><span class="p">]],[[</span><span class="n">p21</span><span class="p">,</span><span class="n">q21</span><span class="p">],[</span><span class="n">p22</span><span class="p">,</span><span class="n">q22</span><span class="p">]]],</span> <span class="n">recursion</span><span class="p">)</span>
</span><span id="__span-36-63"><a id="__codelineno-36-63" name="__codelineno-36-63" href="#__codelineno-36-63"></a>
</span><span id="__span-36-64"><a id="__codelineno-36-64" name="__codelineno-36-64" href="#__codelineno-36-64"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">boxPts</span><span class="p">:</span>
</span><span id="__span-36-65"><a id="__codelineno-36-65" name="__codelineno-36-65" href="#__codelineno-36-65"></a>            <span class="n">box</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Brep</span><span class="o">.</span><span class="n">CreateFromBox</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="__span-36-66"><a id="__codelineno-36-66" name="__codelineno-36-66" href="#__codelineno-36-66"></a>            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</span></code></pre></div>
- 处理盒子的8个端点</p>
<h4 id="39">3.9 通过递归进行六边形分支</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># Hexagonal recursive branches</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="c1"># input type - hexPolyline : Polyline (Item Access), length : float (Item Access), scale : float (Item Access), shift : float (Item Access), percent : float (Item Access), recursion : int (Item Access)</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">calcCenter</span><span class="p">(</span><span class="n">pts</span><span class="p">):</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>    <span class="n">cnt</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>        <span class="n">cnt</span> <span class="o">+=</span> <span class="n">p</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>    <span class="k">return</span> <span class="n">cnt</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">createHex</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">hpt1</span><span class="p">,</span> <span class="n">hpt2</span><span class="p">,</span> <span class="n">hpt3</span><span class="p">,</span> <span class="n">normal</span><span class="p">):</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>    <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">hpt1</span> <span class="o">+</span> <span class="n">hpt2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">hpt2</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>    <span class="n">p3</span> <span class="o">=</span> <span class="p">(</span><span class="n">hpt2</span><span class="o">+</span><span class="n">hpt3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>    <span class="n">p4</span> <span class="o">=</span> <span class="p">(</span><span class="n">hpt3</span> <span class="o">+</span> <span class="n">center</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>    <span class="n">p5</span> <span class="o">=</span> <span class="n">center</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a>    <span class="n">p6</span> <span class="o">=</span> <span class="p">(</span><span class="n">hpt1</span> <span class="o">+</span> <span class="n">center</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a>    <span class="n">shiftvec</span> <span class="o">=</span> <span class="p">(</span><span class="n">p2</span> <span class="o">-</span> <span class="n">p5</span><span class="p">)</span> <span class="o">*</span> <span class="n">shift</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a>    <span class="n">q1</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">+</span> <span class="n">shiftvec</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a>    <span class="n">q2</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">+</span> <span class="n">shiftvec</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a>    <span class="n">q3</span> <span class="o">=</span> <span class="n">p3</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">+</span> <span class="n">shiftvec</span>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a>    <span class="n">q4</span> <span class="o">=</span> <span class="n">p4</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">+</span> <span class="n">shiftvec</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a>    <span class="n">q5</span> <span class="o">=</span> <span class="n">p5</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">+</span> <span class="n">shiftvec</span>
</span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a>    <span class="n">q6</span> <span class="o">=</span> <span class="n">p6</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">+</span> <span class="n">shiftvec</span>
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a>    <span class="n">cnt</span> <span class="o">=</span> <span class="n">calcCenter</span><span class="p">([</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">q3</span><span class="p">,</span><span class="n">q4</span><span class="p">,</span><span class="n">q5</span><span class="p">,</span><span class="n">q6</span><span class="p">])</span>
</span><span id="__span-37-28"><a id="__codelineno-37-28" name="__codelineno-37-28" href="#__codelineno-37-28"></a>    <span class="n">q1</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="n">cnt</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">cnt</span>
</span><span id="__span-37-29"><a id="__codelineno-37-29" name="__codelineno-37-29" href="#__codelineno-37-29"></a>    <span class="n">q2</span> <span class="o">=</span> <span class="p">(</span><span class="n">q2</span><span class="o">-</span><span class="n">cnt</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">cnt</span>
</span><span id="__span-37-30"><a id="__codelineno-37-30" name="__codelineno-37-30" href="#__codelineno-37-30"></a>    <span class="n">q3</span> <span class="o">=</span> <span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">cnt</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">cnt</span>
</span><span id="__span-37-31"><a id="__codelineno-37-31" name="__codelineno-37-31" href="#__codelineno-37-31"></a>    <span class="n">q4</span> <span class="o">=</span> <span class="p">(</span><span class="n">q4</span><span class="o">-</span><span class="n">cnt</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">cnt</span>
</span><span id="__span-37-32"><a id="__codelineno-37-32" name="__codelineno-37-32" href="#__codelineno-37-32"></a>    <span class="n">q5</span> <span class="o">=</span> <span class="p">(</span><span class="n">q5</span><span class="o">-</span><span class="n">cnt</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">cnt</span>
</span><span id="__span-37-33"><a id="__codelineno-37-33" name="__codelineno-37-33" href="#__codelineno-37-33"></a>    <span class="n">q6</span> <span class="o">=</span> <span class="p">(</span><span class="n">q6</span><span class="o">-</span><span class="n">cnt</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">cnt</span>
</span><span id="__span-37-34"><a id="__codelineno-37-34" name="__codelineno-37-34" href="#__codelineno-37-34"></a>
</span><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35" href="#__codelineno-37-35"></a>    <span class="n">cap1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">)</span>
</span><span id="__span-37-36"><a id="__codelineno-37-36" name="__codelineno-37-36" href="#__codelineno-37-36"></a>    <span class="n">cap2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">q4</span><span class="p">,</span> <span class="n">q5</span><span class="p">)</span>
</span><span id="__span-37-37"><a id="__codelineno-37-37" name="__codelineno-37-37" href="#__codelineno-37-37"></a>    <span class="n">cap3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">q5</span><span class="p">,</span> <span class="n">q6</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>
</span><span id="__span-37-38"><a id="__codelineno-37-38" name="__codelineno-37-38" href="#__codelineno-37-38"></a>    <span class="n">capsurf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cap1</span><span class="p">)</span>
</span><span id="__span-37-39"><a id="__codelineno-37-39" name="__codelineno-37-39" href="#__codelineno-37-39"></a>    <span class="n">capsurf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cap2</span><span class="p">)</span>
</span><span id="__span-37-40"><a id="__codelineno-37-40" name="__codelineno-37-40" href="#__codelineno-37-40"></a>    <span class="n">capsurf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cap3</span><span class="p">)</span>
</span><span id="__span-37-41"><a id="__codelineno-37-41" name="__codelineno-37-41" href="#__codelineno-37-41"></a>
</span><span id="__span-37-42"><a id="__codelineno-37-42" name="__codelineno-37-42" href="#__codelineno-37-42"></a>    <span class="n">side</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromPoints</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">p4</span><span class="p">,</span><span class="n">p5</span><span class="p">,</span><span class="n">p6</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">q3</span><span class="p">,</span><span class="n">q4</span><span class="p">,</span><span class="n">q5</span><span class="p">,</span><span class="n">q6</span><span class="p">,</span><span class="n">q1</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-37-43"><a id="__codelineno-37-43" name="__codelineno-37-43" href="#__codelineno-37-43"></a>    <span class="n">sidesurf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
</span><span id="__span-37-44"><a id="__codelineno-37-44" name="__codelineno-37-44" href="#__codelineno-37-44"></a>    <span class="k">return</span> <span class="n">rg</span><span class="o">.</span><span class="n">Polyline</span><span class="p">([</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">q3</span><span class="p">,</span><span class="n">q4</span><span class="p">,</span><span class="n">q5</span><span class="p">,</span><span class="n">q6</span><span class="p">,</span><span class="n">q1</span><span class="p">])</span>
</span><span id="__span-37-45"><a id="__codelineno-37-45" name="__codelineno-37-45" href="#__codelineno-37-45"></a>
</span><span id="__span-37-46"><a id="__codelineno-37-46" name="__codelineno-37-46" href="#__codelineno-37-46"></a><span class="k">def</span><span class="w"> </span><span class="nf">recursiveHex</span><span class="p">(</span><span class="nb">hex</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
</span><span id="__span-37-47"><a id="__codelineno-37-47" name="__codelineno-37-47" href="#__codelineno-37-47"></a>    <span class="n">center</span> <span class="o">=</span> <span class="n">calcCenter</span><span class="p">([</span><span class="nb">hex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">hex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">hex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nb">hex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="nb">hex</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="nb">hex</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
</span><span id="__span-37-48"><a id="__codelineno-37-48" name="__codelineno-37-48" href="#__codelineno-37-48"></a>    <span class="n">nml</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="nb">hex</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="nb">hex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">hex</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="nb">hex</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-37-49"><a id="__codelineno-37-49" name="__codelineno-37-49" href="#__codelineno-37-49"></a>    <span class="n">nml</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-37-50"><a id="__codelineno-37-50" name="__codelineno-37-50" href="#__codelineno-37-50"></a>    <span class="n">nml</span> <span class="o">*=</span> <span class="n">offset</span>
</span><span id="__span-37-51"><a id="__codelineno-37-51" name="__codelineno-37-51" href="#__codelineno-37-51"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="__span-37-52"><a id="__codelineno-37-52" name="__codelineno-37-52" href="#__codelineno-37-52"></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="__span-37-53"><a id="__codelineno-37-53" name="__codelineno-37-53" href="#__codelineno-37-53"></a>            <span class="n">hpt1</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-37-54"><a id="__codelineno-37-54" name="__codelineno-37-54" href="#__codelineno-37-54"></a>            <span class="n">hpt2</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">[(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">6</span><span class="p">]</span>
</span><span id="__span-37-55"><a id="__codelineno-37-55" name="__codelineno-37-55" href="#__codelineno-37-55"></a>            <span class="n">hpt3</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">[(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">6</span><span class="p">]</span>
</span><span id="__span-37-56"><a id="__codelineno-37-56" name="__codelineno-37-56" href="#__codelineno-37-56"></a>            <span class="n">hex2</span> <span class="o">=</span> <span class="n">createHex</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">hpt1</span><span class="p">,</span> <span class="n">hpt2</span><span class="p">,</span> <span class="n">hpt3</span><span class="p">,</span> <span class="n">nml</span><span class="p">)</span>
</span><span id="__span-37-57"><a id="__codelineno-37-57" name="__codelineno-37-57" href="#__codelineno-37-57"></a>            <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-37-58"><a id="__codelineno-37-58" name="__codelineno-37-58" href="#__codelineno-37-58"></a>                <span class="n">recursiveHex</span><span class="p">(</span><span class="n">hex2</span><span class="p">,</span> <span class="n">offset</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-37-59"><a id="__codelineno-37-59" name="__codelineno-37-59" href="#__codelineno-37-59"></a>
</span><span id="__span-37-60"><a id="__codelineno-37-60" name="__codelineno-37-60" href="#__codelineno-37-60"></a><span class="n">sidesurf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-37-61"><a id="__codelineno-37-61" name="__codelineno-37-61" href="#__codelineno-37-61"></a><span class="n">capsurf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-37-62"><a id="__codelineno-37-62" name="__codelineno-37-62" href="#__codelineno-37-62"></a><span class="k">if</span> <span class="n">hexPolyline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">hexPolyline</span><span class="o">.</span><span class="n">Count</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="__span-37-63"><a id="__codelineno-37-63" name="__codelineno-37-63" href="#__codelineno-37-63"></a>    <span class="n">recursiveHex</span><span class="p">(</span><span class="n">hexPolyline</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">recursion</span><span class="p">)</span>
</span></code></pre></div>
- ...</p>
<h4 id="310">3.10 通过递归进行网络细分</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># this subdivided mesh faces by recursive function</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="c1"># input type - Mesh (Item Access)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>    <span class="k">if</span><span class="p">(</span><span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">):</span> <span class="c1"># random omission</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>        <span class="n">v1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3f</span><span class="p">(</span><span class="n">pt1</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pt1</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">pt1</span><span class="o">.</span><span class="n">Z</span><span class="p">);</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>        <span class="n">v2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3f</span><span class="p">(</span><span class="n">pt2</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pt2</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">pt2</span><span class="o">.</span><span class="n">Z</span><span class="p">);</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>        <span class="n">v3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3f</span><span class="p">(</span><span class="n">pt3</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pt3</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">pt3</span><span class="o">.</span><span class="n">Z</span><span class="p">);</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">])</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>        <span class="n">npt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt1</span><span class="o">+</span><span class="n">pt2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>        <span class="n">npt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt2</span><span class="o">+</span><span class="n">pt3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>        <span class="n">npt3</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt3</span><span class="o">+</span><span class="n">pt1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>        <span class="n">npt4</span> <span class="o">=</span> <span class="p">(</span><span class="n">npt1</span><span class="o">+</span><span class="n">npt2</span><span class="o">+</span><span class="n">npt3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>        <span class="n">normal</span> <span class="o">=</span> <span class="n">normalVector</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt2</span><span class="p">,</span><span class="n">pt3</span><span class="p">)</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>        <span class="n">npt4</span> <span class="o">+=</span> <span class="n">normal</span><span class="o">*</span><span class="mf">0.06</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>        <span class="n">subdivide</span><span class="p">(</span><span class="n">npt1</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">npt3</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>        <span class="n">subdivide</span><span class="p">(</span><span class="n">npt2</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">npt1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>        <span class="n">subdivide</span><span class="p">(</span><span class="n">npt3</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">npt2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>        <span class="n">subdivide</span><span class="p">(</span><span class="n">npt1</span><span class="p">,</span> <span class="n">npt2</span><span class="p">,</span> <span class="n">npt4</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a>        <span class="n">subdivide</span><span class="p">(</span><span class="n">npt2</span><span class="p">,</span> <span class="n">npt3</span><span class="p">,</span> <span class="n">npt4</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a>        <span class="n">subdivide</span><span class="p">(</span><span class="n">npt3</span><span class="p">,</span> <span class="n">npt1</span><span class="p">,</span> <span class="n">npt4</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a>
</span><span id="__span-38-28"><a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalVector</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
</span><span id="__span-38-29"><a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a>    <span class="n">vec1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">Subtract</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pt2</span><span class="p">),</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pt1</span><span class="p">))</span>
</span><span id="__span-38-30"><a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a>    <span class="n">vec2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">Subtract</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pt3</span><span class="p">),</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">pt1</span><span class="p">))</span>
</span><span id="__span-38-31"><a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a>    <span class="k">return</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span>
</span><span id="__span-38-32"><a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a>
</span><span id="__span-38-33"><a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a><span class="c1"># main</span>
</span><span id="__span-38-34"><a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-38-35"><a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a><span class="n">vertices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-38-36"><a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a><span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">:</span>
</span><span id="__span-38-37"><a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a>    <span class="n">pt1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">A</span><span class="p">])</span>
</span><span id="__span-38-38"><a id="__codelineno-38-38" name="__codelineno-38-38" href="#__codelineno-38-38"></a>    <span class="n">pt2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">B</span><span class="p">])</span>
</span><span id="__span-38-39"><a id="__codelineno-38-39" name="__codelineno-38-39" href="#__codelineno-38-39"></a>    <span class="n">pt3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">C</span><span class="p">])</span>
</span><span id="__span-38-40"><a id="__codelineno-38-40" name="__codelineno-38-40" href="#__codelineno-38-40"></a>    <span class="n">subdivide</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">vertices</span><span class="p">)</span>
</span><span id="__span-38-41"><a id="__codelineno-38-41" name="__codelineno-38-41" href="#__codelineno-38-41"></a>    <span class="k">if</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span>
</span><span id="__span-38-42"><a id="__codelineno-38-42" name="__codelineno-38-42" href="#__codelineno-38-42"></a>        <span class="n">pt4</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">D</span><span class="p">])</span>
</span><span id="__span-38-43"><a id="__codelineno-38-43" name="__codelineno-38-43" href="#__codelineno-38-43"></a>        <span class="n">subdivide</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt4</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">vertices</span><span class="p">)</span> <span class="c1"># reverse order</span>
</span><span id="__span-38-44"><a id="__codelineno-38-44" name="__codelineno-38-44" href="#__codelineno-38-44"></a>
</span><span id="__span-38-45"><a id="__codelineno-38-45" name="__codelineno-38-45" href="#__codelineno-38-45"></a><span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-38-46"><a id="__codelineno-38-46" name="__codelineno-38-46" href="#__codelineno-38-46"></a><span class="k">for</span> <span class="n">vtx</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
</span><span id="__span-38-47"><a id="__codelineno-38-47" name="__codelineno-38-47" href="#__codelineno-38-47"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Count</span>
</span><span id="__span-38-48"><a id="__codelineno-38-48" name="__codelineno-38-48" href="#__codelineno-38-48"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-38-49"><a id="__codelineno-38-49" name="__codelineno-38-49" href="#__codelineno-38-49"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-38-50"><a id="__codelineno-38-50" name="__codelineno-38-50" href="#__codelineno-38-50"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-38-51"><a id="__codelineno-38-51" name="__codelineno-38-51" href="#__codelineno-38-51"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-38-52"><a id="__codelineno-38-52" name="__codelineno-38-52" href="#__codelineno-38-52"></a><span class="n">a</span> <span class="o">=</span> <span class="n">mesh2</span>
</span></code></pre></div>
- ......</p>
<h2 id="4-gh-python">4. GH Python:烘培和物体属性</h2>
<h4 id="41">4.1 烘培着色点</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># bake points with colors</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="c1"># input type - bool (Item Access)</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">scriptcontext</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.DocObjects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">System.Drawing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sd</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="n">sc</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Rhino</span><span class="o">.</span><span class="n">RhinoDoc</span><span class="o">.</span><span class="n">ActiveDoc</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="k">if</span> <span class="n">bake</span><span class="p">:</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>    <span class="n">xnum</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>    <span class="n">ynum</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xnum</span><span class="p">):</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ynum</span><span class="p">):</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>            <span class="n">pt</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>            <span class="n">attr</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">ObjectAttributes</span><span class="p">()</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a>            <span class="n">attr</span><span class="o">.</span><span class="n">ColorSource</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">ObjectColorSource</span><span class="o">.</span><span class="n">ColorFromObject</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>            <span class="n">attr</span><span class="o">.</span><span class="n">ObjectColor</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">FromArgb</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">xnum</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">ynum</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>            <span class="n">sc</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">Objects</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span></code></pre></div>
- 注意调用sc\rd\sd的用法，很繁复</p>
<h4 id="42">4.2 烘培着色曲线</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># bake curves with colors</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="c1"># input type - bool (Item Access)</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">scriptcontext</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">System.Drawing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sd</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.DocObjects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="n">sc</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Rhino</span><span class="o">.</span><span class="n">RhinoDoc</span><span class="o">.</span><span class="n">ActiveDoc</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="k">if</span> <span class="n">bake</span><span class="p">:</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>    <span class="n">num</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>        <span class="n">pt1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>        <span class="n">pt2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>        <span class="n">pt3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mf">0.1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a>        <span class="n">curve</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsCurve</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">])</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a>        <span class="n">attr</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">ObjectAttributes</span><span class="p">()</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a>        <span class="n">attr</span><span class="o">.</span><span class="n">ColorSource</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">ObjectColorSource</span><span class="o">.</span><span class="n">ColorFromObject</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a>        <span class="n">attr</span><span class="o">.</span><span class="n">ObjectColor</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">FromArgb</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">num</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">num</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a>        <span class="n">sc</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">Objects</span><span class="o">.</span><span class="n">AddCurve</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span></code></pre></div>
- 一样的用法，点换成了曲线</p>
<h4 id="43">4.3 烘培简单材质的曲面</h4>
<div class="language-PY highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># bake surfaces with simple materials</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="c1"># input type - bool (Item Access)</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">scriptcontext</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">System.Drawing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sd</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.DocObjects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="n">sc</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">Rhino</span><span class="o">.</span><span class="n">RhinoDoc</span><span class="o">.</span><span class="n">ActiveDoc</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="k">if</span> <span class="n">bake</span><span class="p">:</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>    <span class="n">xnum</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>    <span class="n">ynum</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xnum</span><span class="p">):</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ynum</span><span class="p">):</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a>            <span class="n">pt1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>            <span class="n">pt2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>            <span class="n">pt3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a>            <span class="n">pt4</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a>            <span class="n">surface</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">NurbsSurface</span><span class="o">.</span><span class="n">CreateFromCorners</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt2</span><span class="p">,</span><span class="n">pt3</span><span class="p">,</span><span class="n">pt4</span><span class="p">)</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a>            <span class="n">materialIndex</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">Materials</span><span class="o">.</span><span class="n">Add</span><span class="p">()</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>            <span class="n">material</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">Materials</span><span class="p">[</span><span class="n">materialIndex</span><span class="p">]</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a>            <span class="n">material</span><span class="o">.</span><span class="n">DiffuseColor</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">FromArgb</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">xnum</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="n">ynum</span><span class="o">*</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a>            <span class="n">material</span><span class="o">.</span><span class="n">CommitChanges</span><span class="p">()</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a>            <span class="n">attr</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">ObjectAttributes</span><span class="p">()</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a>            <span class="n">attr</span><span class="o">.</span><span class="n">MaterialSource</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">ObjectMaterialSource</span><span class="o">.</span><span class="n">MaterialFromObject</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a>            <span class="n">attr</span><span class="o">.</span><span class="n">MaterialIndex</span> <span class="o">=</span> <span class="n">materialIndex</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a>            <span class="n">sc</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">Objects</span><span class="o">.</span><span class="n">AddSurface</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="5-gh-python">5. GH Python:面向对象编程</h2>
<h4 id="51">5.1 定义带构造函数的类</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># defining a custom class</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="c1"># input type - Point3d (List Access)</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="p">:</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>    <span class="c1"># __init__ is a special method to initialize a class instance (constructor)</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">Class1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span></code></pre></div>
- dd</p>
<h4 id="52">5.2 添加一个方法</h4>
<p><div class="language-py highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># defining a custom class</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="c1"># input type - Point3d (List Access)</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="p">:</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getCircle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>        <span class="n">circle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">Class1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a>    <span class="n">obj</span><span class="o">.</span><span class="n">getCircle</span><span class="p">()</span>
</span></code></pre></div>
- rs.Addcircle()方法有时会会直接生成目标物体(不知道如何复现这个BUG)，可以改成rg.Circle()也行
- 感谢作者。</p>
<h4 id="53">5.3 添加一个有返回值的方法</h4>
<p><div class="language-py highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># defining a custom class</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="c1"># input type - Point3d (List Access)</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="p">:</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getCircle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>        <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="c1"># returns a circle</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">Class1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">obj</span><span class="o">.</span><span class="n">getCircle</span><span class="p">()</span> <span class="p">)</span>
</span></code></pre></div>
- 类方法返回一个值，直接添加到a输出列表</p>
<h4 id="54">5.4 添加更多方法</h4>
<p><div class="language-py highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1"># defining a custom class</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="c1"># input type - Point3d (List Access)</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="p">:</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getCircle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>        <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getSquare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>        <span class="n">plane</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a>        <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddRectangle</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">Class1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">obj</span><span class="o">.</span><span class="n">getCircle</span><span class="p">()</span> <span class="p">)</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">obj</span><span class="o">.</span><span class="n">getSquare</span><span class="p">()</span> <span class="p">)</span>
</span></code></pre></div>
- 一样，可以改用rg方法来实现以避免直接在文件里添加物体
- 如何用rg需要用两个和半径同长度的向量来移动圆心作为矩形的两个角</p>
<h4 id="55">5.5  作为几何模块的类</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1"># defining a custom class</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="c1"># input type - Point3d (List Access)</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">CircleSequence</span><span class="p">:</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="nb">dir</span><span class="p">):</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="nb">dir</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.2</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>            <span class="n">circle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*=</span> <span class="mf">0.8</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a>            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">CircleSequence</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a>    <span class="n">obj</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- 类是什么东西，类是一个对象</p>
<h4 id="56-2">5.6  作为几何模块的类(2)</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1"># defining a custom class</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="c1"># input type - Point3d (List Access)</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">CircleSequence</span><span class="p">:</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="nb">dir</span><span class="p">):</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="nb">dir</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.2</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a>            <span class="n">circle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddCircle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*=</span> <span class="mf">0.8</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a>            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="k">class</span><span class="w"> </span><span class="nc">SpiralCircles</span><span class="p">:</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a>        <span class="nb">dir</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-47-27"><a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-47-28"><a id="__codelineno-47-28" name="__codelineno-47-28" href="#__codelineno-47-28"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span id="__span-47-29"><a id="__codelineno-47-29" name="__codelineno-47-29" href="#__codelineno-47-29"></a>            <span class="n">arm</span> <span class="o">=</span> <span class="n">CircleSequence</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="nb">dir</span><span class="p">))</span>
</span><span id="__span-47-30"><a id="__codelineno-47-30" name="__codelineno-47-30" href="#__codelineno-47-30"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
</span><span id="__span-47-31"><a id="__codelineno-47-31" name="__codelineno-47-31" href="#__codelineno-47-31"></a>            <span class="nb">dir</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="n">count</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-47-32"><a id="__codelineno-47-32" name="__codelineno-47-32" href="#__codelineno-47-32"></a>
</span><span id="__span-47-33"><a id="__codelineno-47-33" name="__codelineno-47-33" href="#__codelineno-47-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-47-34"><a id="__codelineno-47-34" name="__codelineno-47-34" href="#__codelineno-47-34"></a>        <span class="k">for</span> <span class="n">arm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">:</span>
</span><span id="__span-47-35"><a id="__codelineno-47-35" name="__codelineno-47-35" href="#__codelineno-47-35"></a>            <span class="n">arm</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span> 
</span><span id="__span-47-36"><a id="__codelineno-47-36" name="__codelineno-47-36" href="#__codelineno-47-36"></a>
</span><span id="__span-47-37"><a id="__codelineno-47-37" name="__codelineno-47-37" href="#__codelineno-47-37"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-47-38"><a id="__codelineno-47-38" name="__codelineno-47-38" href="#__codelineno-47-38"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-47-39"><a id="__codelineno-47-39" name="__codelineno-47-39" href="#__codelineno-47-39"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">0.3</span> <span class="o">+</span> <span class="mf">0.1</span>
</span><span id="__span-47-40"><a id="__codelineno-47-40" name="__codelineno-47-40" href="#__codelineno-47-40"></a>    <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span>
</span><span id="__span-47-41"><a id="__codelineno-47-41" name="__codelineno-47-41" href="#__codelineno-47-41"></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">SpiralCircles</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="__span-47-42"><a id="__codelineno-47-42" name="__codelineno-47-42" href="#__codelineno-47-42"></a>    <span class="n">obj</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- 类的运用</p>
<h4 id="57-3">5.7  作为几何模块的类(3)</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1"># defining a custom class</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="c1"># input type - Point3d (List Access)</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">HierarchyBoxes</span><span class="p">:</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">child</span> <span class="o">=</span> <span class="n">CornerBoxes</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>        <span class="n">box</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="o">.</span><span class="n">WorldXY</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span><span class="o">+</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">CornerBoxes</span><span class="p">:</span>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">size1</span><span class="p">,</span> <span class="n">size2</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">size1</span> <span class="o">=</span> <span class="n">size1</span>
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">size2</span> <span class="o">=</span> <span class="n">size2</span>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a>        <span class="k">if</span><span class="p">(</span><span class="n">level</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a>            <span class="n">child1</span> <span class="o">=</span> <span class="n">CornerBoxes</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span><span class="o">+</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="o">-</span><span class="n">size2</span><span class="p">,</span><span class="o">-</span><span class="n">size2</span><span class="p">,</span><span class="o">-</span><span class="n">size2</span><span class="p">),</span> <span class="n">size2</span><span class="p">,</span> <span class="n">size2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a>            <span class="n">child2</span> <span class="o">=</span> <span class="n">CornerBoxes</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span><span class="o">+</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">size1</span><span class="p">,</span><span class="o">-</span><span class="n">size2</span><span class="p">,</span><span class="o">-</span><span class="n">size2</span><span class="p">),</span>  <span class="n">size2</span><span class="p">,</span> <span class="n">size2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a>            <span class="n">child3</span> <span class="o">=</span> <span class="n">CornerBoxes</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span><span class="o">+</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="o">-</span><span class="n">size2</span><span class="p">,</span><span class="n">size1</span><span class="p">,</span><span class="o">-</span><span class="n">size2</span><span class="p">),</span>  <span class="n">size2</span><span class="p">,</span> <span class="n">size2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child1</span><span class="p">)</span>
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child2</span><span class="p">)</span>
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child3</span><span class="p">)</span>
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a>
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">makeBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corner</span><span class="p">):</span>
</span><span id="__span-48-32"><a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a>        <span class="n">box</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="o">.</span><span class="n">WorldXY</span><span class="p">,</span> <span class="p">[</span><span class="n">corner</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">corner</span><span class="p">)</span><span class="o">+</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size2</span><span class="p">,</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size2</span><span class="p">,</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size2</span><span class="p">)])</span>
</span><span id="__span-48-33"><a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</span><span id="__span-48-34"><a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a>
</span><span id="__span-48-35"><a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-48-36"><a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">makeBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-48-37"><a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">makeBox</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">size2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-48-38"><a id="__codelineno-48-38" name="__codelineno-48-38" href="#__codelineno-48-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">makeBox</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">size2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-48-39"><a id="__codelineno-48-39" name="__codelineno-48-39" href="#__codelineno-48-39"></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="__span-48-40"><a id="__codelineno-48-40" name="__codelineno-48-40" href="#__codelineno-48-40"></a>            <span class="n">c</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span><span id="__span-48-41"><a id="__codelineno-48-41" name="__codelineno-48-41" href="#__codelineno-48-41"></a>
</span><span id="__span-48-42"><a id="__codelineno-48-42" name="__codelineno-48-42" href="#__codelineno-48-42"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-48-43"><a id="__codelineno-48-43" name="__codelineno-48-43" href="#__codelineno-48-43"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-48-44"><a id="__codelineno-48-44" name="__codelineno-48-44" href="#__codelineno-48-44"></a>    <span class="n">level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="__span-48-45"><a id="__codelineno-48-45" name="__codelineno-48-45" href="#__codelineno-48-45"></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">HierarchyBoxes</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
</span><span id="__span-48-46"><a id="__codelineno-48-46" name="__codelineno-48-46" href="#__codelineno-48-46"></a>    <span class="n">obj</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- 生成各种几何体实验</p>
<h4 id="58-4">5.8  作为几何模块的类(4)</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># defining a custom class</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="c1"># input type - Point3d (List Access)</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">AngleSequence</span><span class="p">:</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="nb">dir</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>        <span class="n">ndir</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>        <span class="n">wdir</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">ndir</span><span class="p">)</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>        <span class="n">wdir</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>        <span class="n">wdir</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>        <span class="n">pt1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">-</span><span class="n">wdir</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a>        <span class="n">pt2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a>        <span class="n">pt3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">+</span><span class="n">wdir</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a>        <span class="n">plines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a>            <span class="n">pline</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">PolylineCurve</span><span class="p">([</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt2</span><span class="p">,</span><span class="n">pt3</span><span class="p">])</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a>            <span class="n">plines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pline</span><span class="p">)</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a>            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pline</span><span class="p">)</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a>            <span class="n">pt1</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a>            <span class="n">pt2</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">*</span><span class="mf">1.5</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a>            <span class="n">pt3</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a>        <span class="k">return</span> <span class="n">plines</span>
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31" href="#__codelineno-49-31"></a>
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32" href="#__codelineno-49-32"></a><span class="k">class</span><span class="w"> </span><span class="nc">TiltedExtrusion</span><span class="p">:</span>
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33" href="#__codelineno-49-33"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="__span-49-34"><a id="__codelineno-49-34" name="__codelineno-49-34" href="#__codelineno-49-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="n">AngleSequence</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span><span class="nb">dir</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">count</span><span class="p">)</span>
</span><span id="__span-49-35"><a id="__codelineno-49-35" name="__codelineno-49-35" href="#__codelineno-49-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
</span><span id="__span-49-36"><a id="__codelineno-49-36" name="__codelineno-49-36" href="#__codelineno-49-36"></a>
</span><span id="__span-49-37"><a id="__codelineno-49-37" name="__codelineno-49-37" href="#__codelineno-49-37"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">loft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pline</span><span class="p">,</span> <span class="nb">dir</span><span class="p">):</span>
</span><span id="__span-49-38"><a id="__codelineno-49-38" name="__codelineno-49-38" href="#__codelineno-49-38"></a>        <span class="n">pline2</span> <span class="o">=</span> <span class="n">pline</span><span class="o">.</span><span class="n">Duplicate</span><span class="p">()</span>
</span><span id="__span-49-39"><a id="__codelineno-49-39" name="__codelineno-49-39" href="#__codelineno-49-39"></a>        <span class="n">pline2</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="nb">dir</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="nb">dir</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="__span-49-40"><a id="__codelineno-49-40" name="__codelineno-49-40" href="#__codelineno-49-40"></a>        <span class="n">brep</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Brep</span><span class="o">.</span><span class="n">CreateFromLoft</span><span class="p">([</span><span class="n">pline</span><span class="p">,</span><span class="n">pline2</span><span class="p">],</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="o">.</span><span class="n">Unset</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="o">.</span><span class="n">Unset</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">LoftType</span><span class="o">.</span><span class="n">Straight</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-49-41"><a id="__codelineno-49-41" name="__codelineno-49-41" href="#__codelineno-49-41"></a>        <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">brep</span><span class="p">)</span>
</span><span id="__span-49-42"><a id="__codelineno-49-42" name="__codelineno-49-42" href="#__codelineno-49-42"></a>
</span><span id="__span-49-43"><a id="__codelineno-49-43" name="__codelineno-49-43" href="#__codelineno-49-43"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-49-44"><a id="__codelineno-49-44" name="__codelineno-49-44" href="#__codelineno-49-44"></a>        <span class="n">plines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span><span id="__span-49-45"><a id="__codelineno-49-45" name="__codelineno-49-45" href="#__codelineno-49-45"></a>        <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">plines</span><span class="p">:</span>
</span><span id="__span-49-46"><a id="__codelineno-49-46" name="__codelineno-49-46" href="#__codelineno-49-46"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">loft</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>
</span><span id="__span-49-47"><a id="__codelineno-49-47" name="__codelineno-49-47" href="#__codelineno-49-47"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-49-48"><a id="__codelineno-49-48" name="__codelineno-49-48" href="#__codelineno-49-48"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">*=</span> <span class="mf">0.95</span>
</span><span id="__span-49-49"><a id="__codelineno-49-49" name="__codelineno-49-49" href="#__codelineno-49-49"></a>
</span><span id="__span-49-50"><a id="__codelineno-49-50" name="__codelineno-49-50" href="#__codelineno-49-50"></a><span class="k">class</span><span class="w"> </span><span class="nc">SpiralAggregation</span><span class="p">:</span>
</span><span id="__span-49-51"><a id="__codelineno-49-51" name="__codelineno-49-51" href="#__codelineno-49-51"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="__span-49-52"><a id="__codelineno-49-52" name="__codelineno-49-52" href="#__codelineno-49-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-49-53"><a id="__codelineno-49-53" name="__codelineno-49-53" href="#__codelineno-49-53"></a>        <span class="nb">dir</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
</span><span id="__span-49-54"><a id="__codelineno-49-54" name="__codelineno-49-54" href="#__codelineno-49-54"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span id="__span-49-55"><a id="__codelineno-49-55" name="__codelineno-49-55" href="#__codelineno-49-55"></a>            <span class="nb">len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span>
</span><span id="__span-49-56"><a id="__codelineno-49-56" name="__codelineno-49-56" href="#__codelineno-49-56"></a>            <span class="n">width</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mf">1.5</span><span class="o">+</span><span class="mf">1.0</span>
</span><span id="__span-49-57"><a id="__codelineno-49-57" name="__codelineno-49-57" href="#__codelineno-49-57"></a>            <span class="n">extrusion</span> <span class="o">=</span> <span class="n">TiltedExtrusion</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">pt</span><span class="p">),</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span><span class="o">+</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.08</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span>
</span><span id="__span-49-58"><a id="__codelineno-49-58" name="__codelineno-49-58" href="#__codelineno-49-58"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extrusion</span><span class="p">)</span>
</span><span id="__span-49-59"><a id="__codelineno-49-59" name="__codelineno-49-59" href="#__codelineno-49-59"></a>            <span class="nb">dir</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span><span class="p">)</span>
</span><span id="__span-49-60"><a id="__codelineno-49-60" name="__codelineno-49-60" href="#__codelineno-49-60"></a>            <span class="n">pt</span> <span class="o">+=</span> <span class="nb">dir</span><span class="o">*</span><span class="nb">len</span>
</span><span id="__span-49-61"><a id="__codelineno-49-61" name="__codelineno-49-61" href="#__codelineno-49-61"></a>
</span><span id="__span-49-62"><a id="__codelineno-49-62" name="__codelineno-49-62" href="#__codelineno-49-62"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-49-63"><a id="__codelineno-49-63" name="__codelineno-49-63" href="#__codelineno-49-63"></a>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="__span-49-64"><a id="__codelineno-49-64" name="__codelineno-49-64" href="#__codelineno-49-64"></a>            <span class="n">c</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span><span id="__span-49-65"><a id="__codelineno-49-65" name="__codelineno-49-65" href="#__codelineno-49-65"></a>
</span><span id="__span-49-66"><a id="__codelineno-49-66" name="__codelineno-49-66" href="#__codelineno-49-66"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-49-67"><a id="__codelineno-49-67" name="__codelineno-49-67" href="#__codelineno-49-67"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
</span><span id="__span-49-68"><a id="__codelineno-49-68" name="__codelineno-49-68" href="#__codelineno-49-68"></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">SpiralAggregation</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="__span-49-69"><a id="__codelineno-49-69" name="__codelineno-49-69" href="#__codelineno-49-69"></a>    <span class="n">obj</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- 生成更复杂的形体</p>
<h2 id="6-gh-python">6. GH Python:可连接的模块</h2>
<h4 id="61-1">6.1 可连接的模块 1:距离关系的连接</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># defining a connective module</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="c1"># input type - pts : Point3d (List Access), threshold : float (Item Access)</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Module1</span><span class="p">:</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a>                <span class="n">dist</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a>                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a>            <span class="n">line</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a>            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="c1"># create modules</span>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span> 
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">Module1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="c1"># connect modules</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a>    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="c1"># generate geometries</span>
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a>    <span class="n">m</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- 嗯，连接，新玩意，有啥用呢，先看看</p>
<h4 id="62-2">6.2 可连接的模块 2:最大连接数与排序</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># defining a connective module</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="c1"># input type - pts : Point3d (List Access), threshold : float (Item Access), maxLink : int (Item Access)</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="c1"># defining a connective module</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Module1</span><span class="p">:</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>        <span class="c1">#sort list by distance</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>        <span class="nb">sorted</span><span class="p">(</span><span class="n">modules</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a>                <span class="k">break</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a>                <span class="n">dist</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a>                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>                    <span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a>            <span class="n">line</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">AddLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a>            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span> 
</span><span id="__span-51-31"><a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">Module1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-51-32"><a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-51-33"><a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-51-34"><a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a>    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-51-35"><a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-51-36"><a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a>    <span class="n">m</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- 对连接进行一些排序比较处理</p>
<h4 id="63-2">6.3 可连接的模块 2:树形输出</h4>
<div class="language-PY highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1"># defining a connective module</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="c1"># input type - pts : Point3d (List Access), threshold : float (Item Access), maxLink : int (Item Access)</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="c1"># importing grasshopper tree classes</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">clr</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="n">clr</span><span class="o">.</span><span class="n">AddReference</span><span class="p">(</span><span class="s2">&quot;Grasshopper&quot;</span><span class="p">)</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper.Kernel.Data</span><span class="w"> </span><span class="kn">import</span> <span class="n">GH_Path</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataTree</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Module1</span><span class="p">:</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a>        <span class="nb">sorted</span><span class="p">(</span><span class="n">modules</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a>                <span class="k">break</span> <span class="c1"># finish loop</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a>                <span class="n">dist</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a>                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a>                    <span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a>
</span><span id="__span-52-26"><a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-52-27"><a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a>        <span class="nb">id</span> <span class="o">=</span> <span class="n">center</span><span class="o">.</span><span class="n">BranchCount</span>
</span><span id="__span-52-28"><a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a>        <span class="n">center</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">GH_Path</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span> <span class="c1"># add one data in a branch</span>
</span><span id="__span-52-29"><a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a>        <span class="n">linkNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
</span><span id="__span-52-30"><a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a>        <span class="n">armPts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-52-31"><a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">linkNum</span><span class="p">):</span>
</span><span id="__span-52-32"><a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a>            <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-52-33"><a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a>            <span class="n">armPts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt2</span><span class="p">)</span>
</span><span id="__span-52-34"><a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a>        <span class="n">arm</span><span class="o">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">armPts</span><span class="p">,</span> <span class="n">GH_Path</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span> <span class="c1"># add multiple data in a branch</span>
</span><span id="__span-52-35"><a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a>
</span><span id="__span-52-36"><a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="c1"># initialize output points in tree structure</span>
</span><span id="__span-52-37"><a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a><span class="n">center</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-52-38"><a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="n">arm</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-52-39"><a id="__codelineno-52-39" name="__codelineno-52-39" href="#__codelineno-52-39"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-52-40"><a id="__codelineno-52-40" name="__codelineno-52-40" href="#__codelineno-52-40"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span> 
</span><span id="__span-52-41"><a id="__codelineno-52-41" name="__codelineno-52-41" href="#__codelineno-52-41"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">Module1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-52-42"><a id="__codelineno-52-42" name="__codelineno-52-42" href="#__codelineno-52-42"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-52-43"><a id="__codelineno-52-43" name="__codelineno-52-43" href="#__codelineno-52-43"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-52-44"><a id="__codelineno-52-44" name="__codelineno-52-44" href="#__codelineno-52-44"></a>    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-52-45"><a id="__codelineno-52-45" name="__codelineno-52-45" href="#__codelineno-52-45"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-52-46"><a id="__codelineno-52-46" name="__codelineno-52-46" href="#__codelineno-52-46"></a>    <span class="n">m</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="64-43">6.4 可连接的模块 4:3点输出</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1"># defining a connective module</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="c1"># input type - pts : Point3d (List Access), threshold : float (Item Access), maxLink : int (Item Access)</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">clr</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="n">clr</span><span class="o">.</span><span class="n">AddReference</span><span class="p">(</span><span class="s2">&quot;Grasshopper&quot;</span><span class="p">)</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper.Kernel.Data</span><span class="w"> </span><span class="kn">import</span> <span class="n">GH_Path</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataTree</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Module1</span><span class="p">:</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>        <span class="nb">sorted</span><span class="p">(</span><span class="n">modules</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>                <span class="k">break</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>                <span class="n">dist</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a>                    <span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a>
</span><span id="__span-53-25"><a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-53-26"><a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a>        <span class="nb">id</span> <span class="o">=</span> <span class="n">center</span><span class="o">.</span><span class="n">BranchCount</span>
</span><span id="__span-53-27"><a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a>        <span class="n">center</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">GH_Path</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
</span><span id="__span-53-28"><a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a>        <span class="n">linkNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
</span><span id="__span-53-29"><a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">linkNum</span><span class="p">):</span>
</span><span id="__span-53-30"><a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a>            <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-53-31"><a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">linkNum</span><span class="p">):</span>
</span><span id="__span-53-32"><a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a>                <span class="n">pt3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-53-33"><a id="__codelineno-53-33" name="__codelineno-53-33" href="#__codelineno-53-33"></a>                <span class="n">arm3Pts</span><span class="o">.</span><span class="n">AddRange</span><span class="p">([</span><span class="n">pt2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">pt3</span><span class="p">],</span> <span class="n">GH_Path</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span> <span class="c1"># add 2 arm and center</span>
</span><span id="__span-53-34"><a id="__codelineno-53-34" name="__codelineno-53-34" href="#__codelineno-53-34"></a>
</span><span id="__span-53-35"><a id="__codelineno-53-35" name="__codelineno-53-35" href="#__codelineno-53-35"></a><span class="n">center</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-53-36"><a id="__codelineno-53-36" name="__codelineno-53-36" href="#__codelineno-53-36"></a><span class="n">arm3Pts</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-53-37"><a id="__codelineno-53-37" name="__codelineno-53-37" href="#__codelineno-53-37"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-53-38"><a id="__codelineno-53-38" name="__codelineno-53-38" href="#__codelineno-53-38"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span> 
</span><span id="__span-53-39"><a id="__codelineno-53-39" name="__codelineno-53-39" href="#__codelineno-53-39"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">Module1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-53-40"><a id="__codelineno-53-40" name="__codelineno-53-40" href="#__codelineno-53-40"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-53-41"><a id="__codelineno-53-41" name="__codelineno-53-41" href="#__codelineno-53-41"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-53-42"><a id="__codelineno-53-42" name="__codelineno-53-42" href="#__codelineno-53-42"></a>    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-53-43"><a id="__codelineno-53-43" name="__codelineno-53-43" href="#__codelineno-53-43"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-53-44"><a id="__codelineno-53-44" name="__codelineno-53-44" href="#__codelineno-53-44"></a>    <span class="n">m</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- 感觉有点难度了，快到放弃的时候了
- 接下来把程序贴完，然后继续从头开始学习</p>
<h4 id="65-connective-module-5-face-points-output">6.5 Connective Module 5 : Face Points Output</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1"># defining a connective module</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="c1"># input type - pts : Point3d (List Access), threshold : float (Item Access), maxLink : int (Item Access)# importing grasshopper tree classes</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">clr</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="n">clr</span><span class="o">.</span><span class="n">AddReference</span><span class="p">(</span><span class="s2">&quot;Grasshopper&quot;</span><span class="p">)</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper.Kernel.Data</span><span class="w"> </span><span class="kn">import</span> <span class="n">GH_Path</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataTree</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Module1</span><span class="p">:</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a>        <span class="c1">#sort list by distance</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a>        <span class="nb">sorted</span><span class="p">(</span><span class="n">modules</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a>                <span class="k">break</span> <span class="c1"># finish loop</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a>                <span class="n">dist</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a>                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a>                    <span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a>
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a>        <span class="nb">id</span> <span class="o">=</span> <span class="n">center</span><span class="o">.</span><span class="n">BranchCount</span>
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a>        <span class="n">center</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">GH_Path</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
</span><span id="__span-54-29"><a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a>        <span class="n">linkNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
</span><span id="__span-54-30"><a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">linkNum</span><span class="p">):</span>
</span><span id="__span-54-31"><a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a>            <span class="n">pt2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-54-32"><a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">linkNum</span><span class="p">):</span>
</span><span id="__span-54-33"><a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a>                <span class="n">pt3</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-54-34"><a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">linkNum</span><span class="p">):</span>
</span><span id="__span-54-35"><a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a>                    <span class="n">pt4</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-54-36"><a id="__codelineno-54-36" name="__codelineno-54-36" href="#__codelineno-54-36"></a>                    <span class="n">armFacePts</span><span class="o">.</span><span class="n">AddRange</span><span class="p">([</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">],</span> <span class="n">GH_Path</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="c1"># add 3 face pts</span>
</span><span id="__span-54-37"><a id="__codelineno-54-37" name="__codelineno-54-37" href="#__codelineno-54-37"></a>
</span><span id="__span-54-38"><a id="__codelineno-54-38" name="__codelineno-54-38" href="#__codelineno-54-38"></a><span class="n">center</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-54-39"><a id="__codelineno-54-39" name="__codelineno-54-39" href="#__codelineno-54-39"></a><span class="n">armFacePts</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-54-40"><a id="__codelineno-54-40" name="__codelineno-54-40" href="#__codelineno-54-40"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-54-41"><a id="__codelineno-54-41" name="__codelineno-54-41" href="#__codelineno-54-41"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span> 
</span><span id="__span-54-42"><a id="__codelineno-54-42" name="__codelineno-54-42" href="#__codelineno-54-42"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">Module1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-54-43"><a id="__codelineno-54-43" name="__codelineno-54-43" href="#__codelineno-54-43"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-54-44"><a id="__codelineno-54-44" name="__codelineno-54-44" href="#__codelineno-54-44"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-54-45"><a id="__codelineno-54-45" name="__codelineno-54-45" href="#__codelineno-54-45"></a>    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-54-46"><a id="__codelineno-54-46" name="__codelineno-54-46" href="#__codelineno-54-46"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-54-47"><a id="__codelineno-54-47" name="__codelineno-54-47" href="#__codelineno-54-47"></a>    <span class="n">m</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- TBD</p>
<h4 id="66-connective-module-6-point-output-for-specific-geometry-component">6.6 Connective Module 6 : Point Output for Specific Geometry Component</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1"># defining a connective module</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="c1"># input type - pts : Point3d (List Access), threshold : float (Item Access), maxLink : int (Item Access), depthRatio : float (Item Access), shrinkRatio : float (Item Access)</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">clr</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="n">clr</span><span class="o">.</span><span class="n">AddReference</span><span class="p">(</span><span class="s2">&quot;Grasshopper&quot;</span><span class="p">)</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper.Kernel.Data</span><span class="w"> </span><span class="kn">import</span> <span class="n">GH_Path</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataTree</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Module1</span><span class="p">:</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a>        <span class="c1">#sort list by distance</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a>        <span class="nb">sorted</span><span class="p">(</span><span class="n">modules</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-55-19"><a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a>                <span class="k">break</span> 
</span><span id="__span-55-20"><a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-55-21"><a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a>                <span class="n">dist</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-55-22"><a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a>                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-55-23"><a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-55-24"><a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a>                    <span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-55-25"><a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a>
</span><span id="__span-55-26"><a id="__codelineno-55-26" name="__codelineno-55-26" href="#__codelineno-55-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-55-27"><a id="__codelineno-55-27" name="__codelineno-55-27" href="#__codelineno-55-27"></a>        <span class="n">linkNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
</span><span id="__span-55-28"><a id="__codelineno-55-28" name="__codelineno-55-28" href="#__codelineno-55-28"></a>        <span class="k">if</span> <span class="n">linkNum</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-55-29"><a id="__codelineno-55-29" name="__codelineno-55-29" href="#__codelineno-55-29"></a>            <span class="k">return</span> <span class="c1"># do nothing if less than 3 links</span>
</span><span id="__span-55-30"><a id="__codelineno-55-30" name="__codelineno-55-30" href="#__codelineno-55-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">armLength</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># total distance to links</span>
</span><span id="__span-55-31"><a id="__codelineno-55-31" name="__codelineno-55-31" href="#__codelineno-55-31"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-55-32"><a id="__codelineno-55-32" name="__codelineno-55-32" href="#__codelineno-55-32"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">armLength</span> <span class="o">+=</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-55-33"><a id="__codelineno-55-33" name="__codelineno-55-33" href="#__codelineno-55-33"></a>        <span class="n">tricenter</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="c1"># center of triangle </span>
</span><span id="__span-55-34"><a id="__codelineno-55-34" name="__codelineno-55-34" href="#__codelineno-55-34"></a>        <span class="n">normal</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span> <span class="c1"># normal vector of triangle </span>
</span><span id="__span-55-35"><a id="__codelineno-55-35" name="__codelineno-55-35" href="#__codelineno-55-35"></a>        <span class="n">normal</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-55-36"><a id="__codelineno-55-36" name="__codelineno-55-36" href="#__codelineno-55-36"></a>        <span class="n">normal</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">armLength</span> <span class="o">*</span> <span class="n">depthRatio</span> <span class="c1"># normal depth is changed by link distance </span>
</span><span id="__span-55-37"><a id="__codelineno-55-37" name="__codelineno-55-37" href="#__codelineno-55-37"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">linkNum</span><span class="p">):</span>
</span><span id="__span-55-38"><a id="__codelineno-55-38" name="__codelineno-55-38" href="#__codelineno-55-38"></a>            <span class="n">spts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-55-39"><a id="__codelineno-55-39" name="__codelineno-55-39" href="#__codelineno-55-39"></a>            <span class="n">spts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1"># mid point</span>
</span><span id="__span-55-40"><a id="__codelineno-55-40" name="__codelineno-55-40" href="#__codelineno-55-40"></a>            <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span> <span class="o">*</span> <span class="mf">0.4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">*</span> <span class="mf">0.6</span>  <span class="c1"># first radial point</span>
</span><span id="__span-55-41"><a id="__codelineno-55-41" name="__codelineno-55-41" href="#__codelineno-55-41"></a>            <span class="n">spts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span id="__span-55-42"><a id="__codelineno-55-42" name="__codelineno-55-42" href="#__codelineno-55-42"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span> <span class="c1"># generating spiral points</span>
</span><span id="__span-55-43"><a id="__codelineno-55-43" name="__codelineno-55-43" href="#__codelineno-55-43"></a>                <span class="n">vec</span> <span class="o">=</span> <span class="n">sp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> 
</span><span id="__span-55-44"><a id="__codelineno-55-44" name="__codelineno-55-44" href="#__codelineno-55-44"></a>                <span class="n">vec</span><span class="o">.</span><span class="n">Rotate</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">normal</span><span class="p">)</span>
</span><span id="__span-55-45"><a id="__codelineno-55-45" name="__codelineno-55-45" href="#__codelineno-55-45"></a>                <span class="n">sp</span> <span class="o">=</span> <span class="n">vec</span><span class="o">*</span><span class="n">shrinkRatio</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="n">normal</span><span class="o">/</span><span class="mi">30</span>
</span><span id="__span-55-46"><a id="__codelineno-55-46" name="__codelineno-55-46" href="#__codelineno-55-46"></a>                <span class="n">spts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</span><span id="__span-55-47"><a id="__codelineno-55-47" name="__codelineno-55-47" href="#__codelineno-55-47"></a>            <span class="n">spiralPts</span><span class="o">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">spts</span><span class="p">,</span> <span class="n">GH_Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="c1"># using id number</span>
</span><span id="__span-55-48"><a id="__codelineno-55-48" name="__codelineno-55-48" href="#__codelineno-55-48"></a>
</span><span id="__span-55-49"><a id="__codelineno-55-49" name="__codelineno-55-49" href="#__codelineno-55-49"></a><span class="n">spiralPts</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-55-50"><a id="__codelineno-55-50" name="__codelineno-55-50" href="#__codelineno-55-50"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-55-51"><a id="__codelineno-55-51" name="__codelineno-55-51" href="#__codelineno-55-51"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span> 
</span><span id="__span-55-52"><a id="__codelineno-55-52" name="__codelineno-55-52" href="#__codelineno-55-52"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">Module1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-55-53"><a id="__codelineno-55-53" name="__codelineno-55-53" href="#__codelineno-55-53"></a>    <span class="n">m</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span> <span class="c1"># setting id number</span>
</span><span id="__span-55-54"><a id="__codelineno-55-54" name="__codelineno-55-54" href="#__codelineno-55-54"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-55-55"><a id="__codelineno-55-55" name="__codelineno-55-55" href="#__codelineno-55-55"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-55-56"><a id="__codelineno-55-56" name="__codelineno-55-56" href="#__codelineno-55-56"></a>    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-55-57"><a id="__codelineno-55-57" name="__codelineno-55-57" href="#__codelineno-55-57"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-55-58"><a id="__codelineno-55-58" name="__codelineno-55-58" href="#__codelineno-55-58"></a>    <span class="n">m</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- TBD</p>
<h4 id="67-connective-module-7-different-module-types-and-links">6.7. Connective Module 7 : Different Module Types and Links</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1"># defining a connective module</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="c1"># input type - pts : Point3d (List Access), threshold : float (Item Access), maxLink : int (Item Access)</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">clr</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="n">clr</span><span class="o">.</span><span class="n">AddReference</span><span class="p">(</span><span class="s2">&quot;Grasshopper&quot;</span><span class="p">)</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper.Kernel.Data</span><span class="w"> </span><span class="kn">import</span> <span class="n">GH_Path</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Grasshopper</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataTree</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Module1</span><span class="p">:</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">:</span>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a>
</span><span id="__span-56-19"><a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">):</span>
</span><span id="__span-56-20"><a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a>        <span class="c1">#sort list by distance</span>
</span><span id="__span-56-21"><a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a>        <span class="nb">sorted</span><span class="p">(</span><span class="n">modules</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">))</span>
</span><span id="__span-56-22"><a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-56-23"><a id="__codelineno-56-23" name="__codelineno-56-23" href="#__codelineno-56-23"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-56-24"><a id="__codelineno-56-24" name="__codelineno-56-24" href="#__codelineno-56-24"></a>                <span class="k">break</span>
</span><span id="__span-56-25"><a id="__codelineno-56-25" name="__codelineno-56-25" href="#__codelineno-56-25"></a>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
</span><span id="__span-56-26"><a id="__codelineno-56-26" name="__codelineno-56-26" href="#__codelineno-56-26"></a>                <span class="n">dist</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-56-27"><a id="__codelineno-56-27" name="__codelineno-56-27" href="#__codelineno-56-27"></a>                <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxLink</span><span class="p">:</span>
</span><span id="__span-56-28"><a id="__codelineno-56-28" name="__codelineno-56-28" href="#__codelineno-56-28"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-56-29"><a id="__codelineno-56-29" name="__codelineno-56-29" href="#__codelineno-56-29"></a>                    <span class="n">m</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="__span-56-30"><a id="__codelineno-56-30" name="__codelineno-56-30" href="#__codelineno-56-30"></a>
</span><span id="__span-56-31"><a id="__codelineno-56-31" name="__codelineno-56-31" href="#__codelineno-56-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-56-32"><a id="__codelineno-56-32" name="__codelineno-56-32" href="#__codelineno-56-32"></a>        <span class="n">linkNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
</span><span id="__span-56-33"><a id="__codelineno-56-33" name="__codelineno-56-33" href="#__codelineno-56-33"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-56-34"><a id="__codelineno-56-34" name="__codelineno-56-34" href="#__codelineno-56-34"></a>            <span class="n">center1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">GH_Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span id="__span-56-35"><a id="__codelineno-56-35" name="__codelineno-56-35" href="#__codelineno-56-35"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-56-36"><a id="__codelineno-56-36" name="__codelineno-56-36" href="#__codelineno-56-36"></a>            <span class="n">center2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span> <span class="n">GH_Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span id="__span-56-37"><a id="__codelineno-56-37" name="__codelineno-56-37" href="#__codelineno-56-37"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">linkNum</span><span class="p">):</span>
</span><span id="__span-56-38"><a id="__codelineno-56-38" name="__codelineno-56-38" href="#__codelineno-56-38"></a>            <span class="n">mpt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-56-39"><a id="__codelineno-56-39" name="__codelineno-56-39" href="#__codelineno-56-39"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># link 1-1</span>
</span><span id="__span-56-40"><a id="__codelineno-56-40" name="__codelineno-56-40" href="#__codelineno-56-40"></a>                <span class="n">arm1_1</span><span class="o">.</span><span class="n">AddRange</span><span class="p">([</span><span class="n">mpt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">],</span> <span class="n">GH_Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="__span-56-41"><a id="__codelineno-56-41" name="__codelineno-56-41" href="#__codelineno-56-41"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1">#link 1-2</span>
</span><span id="__span-56-42"><a id="__codelineno-56-42" name="__codelineno-56-42" href="#__codelineno-56-42"></a>                <span class="n">arm1_2</span><span class="o">.</span><span class="n">AddRange</span><span class="p">([</span><span class="n">mpt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">],</span> <span class="n">GH_Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="__span-56-43"><a id="__codelineno-56-43" name="__codelineno-56-43" href="#__codelineno-56-43"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#link 2-1</span>
</span><span id="__span-56-44"><a id="__codelineno-56-44" name="__codelineno-56-44" href="#__codelineno-56-44"></a>                <span class="n">arm2_1</span><span class="o">.</span><span class="n">AddRange</span><span class="p">([</span><span class="n">mpt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">],</span> <span class="n">GH_Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="__span-56-45"><a id="__codelineno-56-45" name="__codelineno-56-45" href="#__codelineno-56-45"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1">#link 2-2</span>
</span><span id="__span-56-46"><a id="__codelineno-56-46" name="__codelineno-56-46" href="#__codelineno-56-46"></a>                <span class="n">arm2_2</span><span class="o">.</span><span class="n">AddRange</span><span class="p">([</span><span class="n">mpt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">],</span> <span class="n">GH_Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="__span-56-47"><a id="__codelineno-56-47" name="__codelineno-56-47" href="#__codelineno-56-47"></a>
</span><span id="__span-56-48"><a id="__codelineno-56-48" name="__codelineno-56-48" href="#__codelineno-56-48"></a><span class="n">center1</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-56-49"><a id="__codelineno-56-49" name="__codelineno-56-49" href="#__codelineno-56-49"></a><span class="n">center2</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-56-50"><a id="__codelineno-56-50" name="__codelineno-56-50" href="#__codelineno-56-50"></a><span class="n">arm1_1</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-56-51"><a id="__codelineno-56-51" name="__codelineno-56-51" href="#__codelineno-56-51"></a><span class="n">arm1_2</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-56-52"><a id="__codelineno-56-52" name="__codelineno-56-52" href="#__codelineno-56-52"></a><span class="n">arm2_1</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-56-53"><a id="__codelineno-56-53" name="__codelineno-56-53" href="#__codelineno-56-53"></a><span class="n">arm2_2</span> <span class="o">=</span> <span class="n">DataTree</span><span class="p">[</span><span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">]()</span>
</span><span id="__span-56-54"><a id="__codelineno-56-54" name="__codelineno-56-54" href="#__codelineno-56-54"></a>
</span><span id="__span-56-55"><a id="__codelineno-56-55" name="__codelineno-56-55" href="#__codelineno-56-55"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-56-56"><a id="__codelineno-56-56" name="__codelineno-56-56" href="#__codelineno-56-56"></a><span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span> 
</span><span id="__span-56-57"><a id="__codelineno-56-57" name="__codelineno-56-57" href="#__codelineno-56-57"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">Module1</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
</span><span id="__span-56-58"><a id="__codelineno-56-58" name="__codelineno-56-58" href="#__codelineno-56-58"></a>    <span class="n">m</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span> <span class="c1"># setting id number</span>
</span><span id="__span-56-59"><a id="__codelineno-56-59" name="__codelineno-56-59" href="#__codelineno-56-59"></a>    <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="__span-56-60"><a id="__codelineno-56-60" name="__codelineno-56-60" href="#__codelineno-56-60"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-56-61"><a id="__codelineno-56-61" name="__codelineno-56-61" href="#__codelineno-56-61"></a>    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-56-62"><a id="__codelineno-56-62" name="__codelineno-56-62" href="#__codelineno-56-62"></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
</span><span id="__span-56-63"><a id="__codelineno-56-63" name="__codelineno-56-63" href="#__codelineno-56-63"></a>    <span class="n">m</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</span></code></pre></div>
- TBD</p>
<h2 id="7-gh-python">7. GH Python:自定义细分</h2>
<h4 id="71-1">7.1  顶点控制 1：偏移顶点</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1"># offset each vertex randomly and create a new mesh</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), depth : float (Item Access)</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">offsetVertex</span><span class="p">(</span><span class="n">mesh</span><span class="p">):</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span> <span class="c1"># get all vertices in a list</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="c1">#offset randomly</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFaces</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">)</span> <span class="c1"># add all faces at once</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="n">a</span> <span class="o">=</span> <span class="n">offsetVertex</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="n">b</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span></code></pre></div>
- 对一张Mesh网格进行随机波动</p>
<h4 id="72-vertex-control-2-randomize-vertices">7.2 Vertex Control 2: Randomize Vertices</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1"># move each vertex randomly and create a new mesh</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), depth : float (Item Access)</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">randomizeVertex</span><span class="p">(</span><span class="n">mesh</span><span class="p">):</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span> <span class="c1"># get all vertices in a list</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">depth</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">depth</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">depth</span><span class="p">)</span> <span class="c1">#random xyz move</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFaces</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">)</span> <span class="c1"># add all faces at once</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a>
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a><span class="n">a</span> <span class="o">=</span> <span class="n">randomizeVertex</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="73-vertex-control-3-move-vertices-by-attractors">7.3 Vertex Control 3: Move Vertices by Attractors</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), depth : float (Item Access), atractors : Point3d (List Access), threshold : float (Item Access)</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">moveVertexByAttractor</span><span class="p">(</span><span class="n">mesh</span><span class="p">):</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">attractorVector</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">depth</span> <span class="c1">#add attractor vector</span>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a>
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFaces</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">)</span>
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-59-15"><a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-59-16"><a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a>
</span><span id="__span-59-17"><a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">attractorVector</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
</span><span id="__span-59-18"><a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a>    <span class="n">minDist</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-59-19"><a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a>    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attractors</span><span class="p">:</span> <span class="c1"># find closest attractor</span>
</span><span id="__span-59-20"><a id="__codelineno-59-20" name="__codelineno-59-20" href="#__codelineno-59-20"></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span><span id="__span-59-21"><a id="__codelineno-59-21" name="__codelineno-59-21" href="#__codelineno-59-21"></a>        <span class="k">if</span><span class="p">(</span> <span class="n">minDist</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">minDist</span> <span class="p">):</span>
</span><span id="__span-59-22"><a id="__codelineno-59-22" name="__codelineno-59-22" href="#__codelineno-59-22"></a>            <span class="n">minDist</span> <span class="o">=</span> <span class="n">dist</span>
</span><span id="__span-59-23"><a id="__codelineno-59-23" name="__codelineno-59-23" href="#__codelineno-59-23"></a>            <span class="n">closest</span> <span class="o">=</span> <span class="n">attr</span>
</span><span id="__span-59-24"><a id="__codelineno-59-24" name="__codelineno-59-24" href="#__codelineno-59-24"></a>    <span class="k">if</span><span class="p">(</span><span class="n">minDist</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">):</span>
</span><span id="__span-59-25"><a id="__codelineno-59-25" name="__codelineno-59-25" href="#__codelineno-59-25"></a>        <span class="n">vec</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">closest</span>
</span><span id="__span-59-26"><a id="__codelineno-59-26" name="__codelineno-59-26" href="#__codelineno-59-26"></a>        <span class="n">vec</span> <span class="o">*=</span> <span class="p">(</span><span class="n">threshold</span> <span class="o">-</span> <span class="n">minDist</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="c1"># length from 0 to 1</span>
</span><span id="__span-59-27"><a id="__codelineno-59-27" name="__codelineno-59-27" href="#__codelineno-59-27"></a>        <span class="n">vec</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-59-28"><a id="__codelineno-59-28" name="__codelineno-59-28" href="#__codelineno-59-28"></a>        <span class="k">return</span> <span class="n">vec</span>
</span><span id="__span-59-29"><a id="__codelineno-59-29" name="__codelineno-59-29" href="#__codelineno-59-29"></a>    <span class="k">return</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># return zero vector if out of threshold</span>
</span><span id="__span-59-30"><a id="__codelineno-59-30" name="__codelineno-59-30" href="#__codelineno-59-30"></a>
</span><span id="__span-59-31"><a id="__codelineno-59-31" name="__codelineno-59-31" href="#__codelineno-59-31"></a><span class="n">a</span> <span class="o">=</span> <span class="n">moveVertexByAttractor</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="74-subdivision-1-triangle-center-subdivision">7.4 Subdivision 1: Triangle Center Subdivision</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recureionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1">#create new mesh</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1">#offset vertex</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1">#quad mesh</span>
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1">#put original face</span>
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1">#triangular mesh</span>
</span><span id="__span-60-17"><a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-60-18"><a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-60-19"><a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-60-20"><a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a>
</span><span id="__span-60-21"><a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-60-22"><a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-60-23"><a id="__codelineno-60-23" name="__codelineno-60-23" href="#__codelineno-60-23"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-60-24"><a id="__codelineno-60-24" name="__codelineno-60-24" href="#__codelineno-60-24"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="c1">#center point</span>
</span><span id="__span-60-25"><a id="__codelineno-60-25" name="__codelineno-60-25" href="#__codelineno-60-25"></a>            <span class="n">v4</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="c1">#offset new vertex</span>
</span><span id="__span-60-26"><a id="__codelineno-60-26" name="__codelineno-60-26" href="#__codelineno-60-26"></a>
</span><span id="__span-60-27"><a id="__codelineno-60-27" name="__codelineno-60-27" href="#__codelineno-60-27"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span> <span class="c1">#add new vertex and get index number</span>
</span><span id="__span-60-28"><a id="__codelineno-60-28" name="__codelineno-60-28" href="#__codelineno-60-28"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-60-29"><a id="__codelineno-60-29" name="__codelineno-60-29" href="#__codelineno-60-29"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-60-30"><a id="__codelineno-60-30" name="__codelineno-60-30" href="#__codelineno-60-30"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-60-31"><a id="__codelineno-60-31" name="__codelineno-60-31" href="#__codelineno-60-31"></a>
</span><span id="__span-60-32"><a id="__codelineno-60-32" name="__codelineno-60-32" href="#__codelineno-60-32"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-60-33"><a id="__codelineno-60-33" name="__codelineno-60-33" href="#__codelineno-60-33"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-60-34"><a id="__codelineno-60-34" name="__codelineno-60-34" href="#__codelineno-60-34"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-60-35"><a id="__codelineno-60-35" name="__codelineno-60-35" href="#__codelineno-60-35"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-60-36"><a id="__codelineno-60-36" name="__codelineno-60-36" href="#__codelineno-60-36"></a>
</span><span id="__span-60-37"><a id="__codelineno-60-37" name="__codelineno-60-37" href="#__codelineno-60-37"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="n">recursionLevel</span><span class="p">,</span><span class="n">offsetDepth1</span><span class="p">,</span><span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="75-subdivision-2-triangle-subdivision-with-vector-interpolation">7.5 Subdivision 2: Triangle Subdivision with Vector Interpolation</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1">#create new mesh</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1">#offset vertex</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1">#quad mesh</span>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1">#put original face</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1">#triangular mesh</span>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a>
</span><span id="__span-61-21"><a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-61-22"><a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-61-23"><a id="__codelineno-61-23" name="__codelineno-61-23" href="#__codelineno-61-23"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-61-24"><a id="__codelineno-61-24" name="__codelineno-61-24" href="#__codelineno-61-24"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># point inside triangle</span>
</span><span id="__span-61-25"><a id="__codelineno-61-25" name="__codelineno-61-25" href="#__codelineno-61-25"></a>            <span class="n">v4</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="c1">#offset new vertex</span>
</span><span id="__span-61-26"><a id="__codelineno-61-26" name="__codelineno-61-26" href="#__codelineno-61-26"></a>
</span><span id="__span-61-27"><a id="__codelineno-61-27" name="__codelineno-61-27" href="#__codelineno-61-27"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span> <span class="c1">#add new vertex and get index number</span>
</span><span id="__span-61-28"><a id="__codelineno-61-28" name="__codelineno-61-28" href="#__codelineno-61-28"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-61-29"><a id="__codelineno-61-29" name="__codelineno-61-29" href="#__codelineno-61-29"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-61-30"><a id="__codelineno-61-30" name="__codelineno-61-30" href="#__codelineno-61-30"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-61-31"><a id="__codelineno-61-31" name="__codelineno-61-31" href="#__codelineno-61-31"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-61-32"><a id="__codelineno-61-32" name="__codelineno-61-32" href="#__codelineno-61-32"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-61-33"><a id="__codelineno-61-33" name="__codelineno-61-33" href="#__codelineno-61-33"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-61-34"><a id="__codelineno-61-34" name="__codelineno-61-34" href="#__codelineno-61-34"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-61-35"><a id="__codelineno-61-35" name="__codelineno-61-35" href="#__codelineno-61-35"></a>
</span><span id="__span-61-36"><a id="__codelineno-61-36" name="__codelineno-61-36" href="#__codelineno-61-36"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># ratio1 &gt; 0, ratio2 &gt; 0, ratio1+ratio2 &lt; 1 to be inside triangle</span>
</span><span id="__span-61-37"><a id="__codelineno-61-37" name="__codelineno-61-37" href="#__codelineno-61-37"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio1</span><span class="o">+</span><span class="p">(</span><span class="n">v3</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span><span class="o">+</span><span class="n">v1</span>
</span><span id="__span-61-38"><a id="__codelineno-61-38" name="__codelineno-61-38" href="#__codelineno-61-38"></a>
</span><span id="__span-61-39"><a id="__codelineno-61-39" name="__codelineno-61-39" href="#__codelineno-61-39"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="n">recursionLevel</span><span class="p">,</span><span class="n">offsetDepth1</span><span class="p">,</span><span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="76-subdivision-3-quad-center-subdivision">7.6 Subdivision 3: Quad Center Subdivision</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1">#offset vertex</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-62-19"><a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a>
</span><span id="__span-62-20"><a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-62-21"><a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-62-22"><a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-62-23"><a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-62-24"><a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a>            <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span> <span class="o">+</span> <span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
</span><span id="__span-62-25"><a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a>            <span class="n">v5</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="c1">#offset new vertex</span>
</span><span id="__span-62-26"><a id="__codelineno-62-26" name="__codelineno-62-26" href="#__codelineno-62-26"></a>
</span><span id="__span-62-27"><a id="__codelineno-62-27" name="__codelineno-62-27" href="#__codelineno-62-27"></a>            <span class="n">vidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span> <span class="c1">#add new vertex and get index number</span>
</span><span id="__span-62-28"><a id="__codelineno-62-28" name="__codelineno-62-28" href="#__codelineno-62-28"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span> <span class="c1">#subdivided triangle</span>
</span><span id="__span-62-29"><a id="__codelineno-62-29" name="__codelineno-62-29" href="#__codelineno-62-29"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span> <span class="c1">#subdivided triangle</span>
</span><span id="__span-62-30"><a id="__codelineno-62-30" name="__codelineno-62-30" href="#__codelineno-62-30"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span> <span class="c1">#subdivided triangle</span>
</span><span id="__span-62-31"><a id="__codelineno-62-31" name="__codelineno-62-31" href="#__codelineno-62-31"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span> <span class="c1">#subdivided triangle</span>
</span><span id="__span-62-32"><a id="__codelineno-62-32" name="__codelineno-62-32" href="#__codelineno-62-32"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-62-33"><a id="__codelineno-62-33" name="__codelineno-62-33" href="#__codelineno-62-33"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1">#put original face</span>
</span><span id="__span-62-34"><a id="__codelineno-62-34" name="__codelineno-62-34" href="#__codelineno-62-34"></a>
</span><span id="__span-62-35"><a id="__codelineno-62-35" name="__codelineno-62-35" href="#__codelineno-62-35"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-62-36"><a id="__codelineno-62-36" name="__codelineno-62-36" href="#__codelineno-62-36"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-62-37"><a id="__codelineno-62-37" name="__codelineno-62-37" href="#__codelineno-62-37"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-62-38"><a id="__codelineno-62-38" name="__codelineno-62-38" href="#__codelineno-62-38"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-62-39"><a id="__codelineno-62-39" name="__codelineno-62-39" href="#__codelineno-62-39"></a>
</span><span id="__span-62-40"><a id="__codelineno-62-40" name="__codelineno-62-40" href="#__codelineno-62-40"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="77-subdivision-4-quad-subdivision-with-vector-interpolation">7.7 Subdivision 4: Quad Subdivision with Vector Interpolation</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), recursionProbability : float (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1">#offset vertex</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-63-17"><a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-63-18"><a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-63-19"><a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a>
</span><span id="__span-63-20"><a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-63-21"><a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-63-22"><a id="__codelineno-63-22" name="__codelineno-63-22" href="#__codelineno-63-22"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-63-23"><a id="__codelineno-63-23" name="__codelineno-63-23" href="#__codelineno-63-23"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-63-24"><a id="__codelineno-63-24" name="__codelineno-63-24" href="#__codelineno-63-24"></a>            <span class="n">v5</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.9</span><span class="p">)</span> <span class="c1"># point inside quad</span>
</span><span id="__span-63-25"><a id="__codelineno-63-25" name="__codelineno-63-25" href="#__codelineno-63-25"></a>            <span class="n">v5</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="c1">#offset new vertex</span>
</span><span id="__span-63-26"><a id="__codelineno-63-26" name="__codelineno-63-26" href="#__codelineno-63-26"></a>
</span><span id="__span-63-27"><a id="__codelineno-63-27" name="__codelineno-63-27" href="#__codelineno-63-27"></a>            <span class="n">vidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span> <span class="c1">#add new vertex and get index number</span>
</span><span id="__span-63-28"><a id="__codelineno-63-28" name="__codelineno-63-28" href="#__codelineno-63-28"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span> <span class="c1">#subdivided triangle</span>
</span><span id="__span-63-29"><a id="__codelineno-63-29" name="__codelineno-63-29" href="#__codelineno-63-29"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span> <span class="c1">#subdivided triangle</span>
</span><span id="__span-63-30"><a id="__codelineno-63-30" name="__codelineno-63-30" href="#__codelineno-63-30"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span> <span class="c1">#subdivided triangle</span>
</span><span id="__span-63-31"><a id="__codelineno-63-31" name="__codelineno-63-31" href="#__codelineno-63-31"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span> <span class="c1">#subdivided triangle</span>
</span><span id="__span-63-32"><a id="__codelineno-63-32" name="__codelineno-63-32" href="#__codelineno-63-32"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-63-33"><a id="__codelineno-63-33" name="__codelineno-63-33" href="#__codelineno-63-33"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># put original face</span>
</span><span id="__span-63-34"><a id="__codelineno-63-34" name="__codelineno-63-34" href="#__codelineno-63-34"></a>
</span><span id="__span-63-35"><a id="__codelineno-63-35" name="__codelineno-63-35" href="#__codelineno-63-35"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-63-36"><a id="__codelineno-63-36" name="__codelineno-63-36" href="#__codelineno-63-36"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-63-37"><a id="__codelineno-63-37" name="__codelineno-63-37" href="#__codelineno-63-37"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-63-38"><a id="__codelineno-63-38" name="__codelineno-63-38" href="#__codelineno-63-38"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-63-39"><a id="__codelineno-63-39" name="__codelineno-63-39" href="#__codelineno-63-39"></a>
</span><span id="__span-63-40"><a id="__codelineno-63-40" name="__codelineno-63-40" href="#__codelineno-63-40"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># 0 &lt; ratio1 &lt; 1, 0 &lt; ratio2 &lt; 1 to be inside quad</span>
</span><span id="__span-63-41"><a id="__codelineno-63-41" name="__codelineno-63-41" href="#__codelineno-63-41"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v4</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span>
</span><span id="__span-63-42"><a id="__codelineno-63-42" name="__codelineno-63-42" href="#__codelineno-63-42"></a>
</span><span id="__span-63-43"><a id="__codelineno-63-43" name="__codelineno-63-43" href="#__codelineno-63-43"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="78-subdivision-5-1d-fractal-quad-subdivision">7.8  Subdivision 5: 1D Fractal Quad Subdivision</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span> <span class="p">:</span> <span class="c1"># quad face</span>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-64-20"><a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-64-21"><a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-64-22"><a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span>
</span><span id="__span-64-23"><a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a>
</span><span id="__span-64-24"><a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># interpolation on edge</span>
</span><span id="__span-64-25"><a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># interpolate on edge and offset</span>
</span><span id="__span-64-26"><a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># interpolate on edge and offset</span>
</span><span id="__span-64-27"><a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a>            <span class="n">w4</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># interpolation on edge</span>
</span><span id="__span-64-28"><a id="__codelineno-64-28" name="__codelineno-64-28" href="#__codelineno-64-28"></a>            <span class="n">w5</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span> <span class="c1"># interpolation on edge</span>
</span><span id="__span-64-29"><a id="__codelineno-64-29" name="__codelineno-64-29" href="#__codelineno-64-29"></a>            <span class="n">w6</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># interpolate on edge and offset</span>
</span><span id="__span-64-30"><a id="__codelineno-64-30" name="__codelineno-64-30" href="#__codelineno-64-30"></a>            <span class="n">w7</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># interpolate on edge and offset</span>
</span><span id="__span-64-31"><a id="__codelineno-64-31" name="__codelineno-64-31" href="#__codelineno-64-31"></a>            <span class="n">w8</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># interpolation on edge</span>
</span><span id="__span-64-32"><a id="__codelineno-64-32" name="__codelineno-64-32" href="#__codelineno-64-32"></a>
</span><span id="__span-64-33"><a id="__codelineno-64-33" name="__codelineno-64-33" href="#__codelineno-64-33"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-64-34"><a id="__codelineno-64-34" name="__codelineno-64-34" href="#__codelineno-64-34"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-64-35"><a id="__codelineno-64-35" name="__codelineno-64-35" href="#__codelineno-64-35"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-64-36"><a id="__codelineno-64-36" name="__codelineno-64-36" href="#__codelineno-64-36"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span>
</span><span id="__span-64-37"><a id="__codelineno-64-37" name="__codelineno-64-37" href="#__codelineno-64-37"></a>            <span class="n">widx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w5</span><span class="p">)</span>
</span><span id="__span-64-38"><a id="__codelineno-64-38" name="__codelineno-64-38" href="#__codelineno-64-38"></a>            <span class="n">widx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w6</span><span class="p">)</span>
</span><span id="__span-64-39"><a id="__codelineno-64-39" name="__codelineno-64-39" href="#__codelineno-64-39"></a>            <span class="n">widx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w7</span><span class="p">)</span>
</span><span id="__span-64-40"><a id="__codelineno-64-40" name="__codelineno-64-40" href="#__codelineno-64-40"></a>            <span class="n">widx8</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w8</span><span class="p">)</span>
</span><span id="__span-64-41"><a id="__codelineno-64-41" name="__codelineno-64-41" href="#__codelineno-64-41"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-64-42"><a id="__codelineno-64-42" name="__codelineno-64-42" href="#__codelineno-64-42"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx6</span><span class="p">,</span><span class="n">widx5</span><span class="p">)</span>
</span><span id="__span-64-43"><a id="__codelineno-64-43" name="__codelineno-64-43" href="#__codelineno-64-43"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx7</span><span class="p">,</span><span class="n">widx6</span><span class="p">)</span>
</span><span id="__span-64-44"><a id="__codelineno-64-44" name="__codelineno-64-44" href="#__codelineno-64-44"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx8</span><span class="p">,</span><span class="n">widx7</span><span class="p">)</span>
</span><span id="__span-64-45"><a id="__codelineno-64-45" name="__codelineno-64-45" href="#__codelineno-64-45"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx4</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx8</span><span class="p">)</span>
</span><span id="__span-64-46"><a id="__codelineno-64-46" name="__codelineno-64-46" href="#__codelineno-64-46"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-64-47"><a id="__codelineno-64-47" name="__codelineno-64-47" href="#__codelineno-64-47"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-64-48"><a id="__codelineno-64-48" name="__codelineno-64-48" href="#__codelineno-64-48"></a>
</span><span id="__span-64-49"><a id="__codelineno-64-49" name="__codelineno-64-49" href="#__codelineno-64-49"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-64-50"><a id="__codelineno-64-50" name="__codelineno-64-50" href="#__codelineno-64-50"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
</span><span id="__span-64-51"><a id="__codelineno-64-51" name="__codelineno-64-51" href="#__codelineno-64-51"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-64-52"><a id="__codelineno-64-52" name="__codelineno-64-52" href="#__codelineno-64-52"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-64-53"><a id="__codelineno-64-53" name="__codelineno-64-53" href="#__codelineno-64-53"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-64-54"><a id="__codelineno-64-54" name="__codelineno-64-54" href="#__codelineno-64-54"></a>
</span><span id="__span-64-55"><a id="__codelineno-64-55" name="__codelineno-64-55" href="#__codelineno-64-55"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">ratio</span><span class="p">):</span> <span class="c1"># 0 &lt; ratio &lt; 1</span>
</span><span id="__span-64-56"><a id="__codelineno-64-56" name="__codelineno-64-56" href="#__codelineno-64-56"></a>    <span class="k">return</span> <span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="n">ratio</span>
</span><span id="__span-64-57"><a id="__codelineno-64-57" name="__codelineno-64-57" href="#__codelineno-64-57"></a>
</span><span id="__span-64-58"><a id="__codelineno-64-58" name="__codelineno-64-58" href="#__codelineno-64-58"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="79-subdivision-6-triangular-probabilistic-subdivision">7.9 Subdivision 6: Triangular Probabilistic Subdivision</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), recursionProbability : float (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1">#create new mesh</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1">#offset vertex</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1">#quad mesh</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1">#put original face</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1">#triangular mesh</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span><span class="p">:</span> <span class="c1"># subdivided probabilistically</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a>                <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a>                <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a>                <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="c1">#center point</span>
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a>                <span class="n">v4</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="c1">#offset new vertex</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a>
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a>                <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span> <span class="c1">#add new vertex and get index number</span>
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1">#subdivided trianle</span>
</span><span id="__span-65-33"><a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a>            <span class="k">else</span><span class="p">:</span> 
</span><span id="__span-65-34"><a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1">#put original face</span>
</span><span id="__span-65-35"><a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a>
</span><span id="__span-65-36"><a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-65-37"><a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-65-38"><a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-65-39"><a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-65-40"><a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a>
</span><span id="__span-65-41"><a id="__codelineno-65-41" name="__codelineno-65-41" href="#__codelineno-65-41"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="n">recursionLevel</span><span class="p">,</span><span class="n">offsetDepth1</span><span class="p">,</span><span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="710-subdivision-7-frame-subdivision">7.10 Subdivision 7: Frame Subdivision</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1">#offset vertex</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a>        <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a>        <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a>        <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a>        <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a>        <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a>        <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="c1">#random normal vector</span>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a>
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsTriangle</span><span class="p">):</span> <span class="c1"># triangle face</span>
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.6</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v3</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-66-24"><a id="__codelineno-66-24" name="__codelineno-66-24" href="#__codelineno-66-24"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="mf">0.6</span> <span class="o">+</span> <span class="n">v3</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-66-25"><a id="__codelineno-66-25" name="__codelineno-66-25" href="#__codelineno-66-25"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v3</span><span class="o">*</span><span class="mf">0.6</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-66-26"><a id="__codelineno-66-26" name="__codelineno-66-26" href="#__codelineno-66-26"></a>
</span><span id="__span-66-27"><a id="__codelineno-66-27" name="__codelineno-66-27" href="#__codelineno-66-27"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-66-28"><a id="__codelineno-66-28" name="__codelineno-66-28" href="#__codelineno-66-28"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-66-29"><a id="__codelineno-66-29" name="__codelineno-66-29" href="#__codelineno-66-29"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-66-30"><a id="__codelineno-66-30" name="__codelineno-66-30" href="#__codelineno-66-30"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1">#subdivided face</span>
</span><span id="__span-66-31"><a id="__codelineno-66-31" name="__codelineno-66-31" href="#__codelineno-66-31"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1">#subdivided face</span>
</span><span id="__span-66-32"><a id="__codelineno-66-32" name="__codelineno-66-32" href="#__codelineno-66-32"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1">#subdivided face</span>
</span><span id="__span-66-33"><a id="__codelineno-66-33" name="__codelineno-66-33" href="#__codelineno-66-33"></a>
</span><span id="__span-66-34"><a id="__codelineno-66-34" name="__codelineno-66-34" href="#__codelineno-66-34"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># quad face</span>
</span><span id="__span-66-35"><a id="__codelineno-66-35" name="__codelineno-66-35" href="#__codelineno-66-35"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-66-36"><a id="__codelineno-66-36" name="__codelineno-66-36" href="#__codelineno-66-36"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-66-37"><a id="__codelineno-66-37" name="__codelineno-66-37" href="#__codelineno-66-37"></a>
</span><span id="__span-66-38"><a id="__codelineno-66-38" name="__codelineno-66-38" href="#__codelineno-66-38"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.4</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v3</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v4</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-66-39"><a id="__codelineno-66-39" name="__codelineno-66-39" href="#__codelineno-66-39"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="mf">0.4</span> <span class="o">+</span> <span class="n">v3</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v4</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-66-40"><a id="__codelineno-66-40" name="__codelineno-66-40" href="#__codelineno-66-40"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v3</span><span class="o">*</span><span class="mf">0.4</span> <span class="o">+</span> <span class="n">v4</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-66-41"><a id="__codelineno-66-41" name="__codelineno-66-41" href="#__codelineno-66-41"></a>            <span class="n">w4</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v3</span><span class="o">*</span><span class="mf">0.2</span> <span class="o">+</span> <span class="n">v4</span><span class="o">*</span><span class="mf">0.4</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-66-42"><a id="__codelineno-66-42" name="__codelineno-66-42" href="#__codelineno-66-42"></a>
</span><span id="__span-66-43"><a id="__codelineno-66-43" name="__codelineno-66-43" href="#__codelineno-66-43"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-66-44"><a id="__codelineno-66-44" name="__codelineno-66-44" href="#__codelineno-66-44"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-66-45"><a id="__codelineno-66-45" name="__codelineno-66-45" href="#__codelineno-66-45"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-66-46"><a id="__codelineno-66-46" name="__codelineno-66-46" href="#__codelineno-66-46"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-66-47"><a id="__codelineno-66-47" name="__codelineno-66-47" href="#__codelineno-66-47"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1">#subdivided face</span>
</span><span id="__span-66-48"><a id="__codelineno-66-48" name="__codelineno-66-48" href="#__codelineno-66-48"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1">#subdivided face</span>
</span><span id="__span-66-49"><a id="__codelineno-66-49" name="__codelineno-66-49" href="#__codelineno-66-49"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1">#subdivided face</span>
</span><span id="__span-66-50"><a id="__codelineno-66-50" name="__codelineno-66-50" href="#__codelineno-66-50"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span> <span class="c1">#subdivided face</span>
</span><span id="__span-66-51"><a id="__codelineno-66-51" name="__codelineno-66-51" href="#__codelineno-66-51"></a>
</span><span id="__span-66-52"><a id="__codelineno-66-52" name="__codelineno-66-52" href="#__codelineno-66-52"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-66-53"><a id="__codelineno-66-53" name="__codelineno-66-53" href="#__codelineno-66-53"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-66-54"><a id="__codelineno-66-54" name="__codelineno-66-54" href="#__codelineno-66-54"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-66-55"><a id="__codelineno-66-55" name="__codelineno-66-55" href="#__codelineno-66-55"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-66-56"><a id="__codelineno-66-56" name="__codelineno-66-56" href="#__codelineno-66-56"></a>
</span><span id="__span-66-57"><a id="__codelineno-66-57" name="__codelineno-66-57" href="#__codelineno-66-57"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.11 Subdivision 8: Frame Probabilistic Subdivision
<div class="language-PY highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), recursionProbability : float (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access), holeRatio : float (Item Access)</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1"># offset vertex</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a>        <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a>        <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a>        <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a>        <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a>        <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a>        <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="c1"># random normal vector</span>
</span><span id="__span-67-21"><a id="__codelineno-67-21" name="__codelineno-67-21" href="#__codelineno-67-21"></a>
</span><span id="__span-67-22"><a id="__codelineno-67-22" name="__codelineno-67-22" href="#__codelineno-67-22"></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span> <span class="p">:</span>
</span><span id="__span-67-23"><a id="__codelineno-67-23" name="__codelineno-67-23" href="#__codelineno-67-23"></a>            <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsTriangle</span><span class="p">:</span> <span class="c1"># triangle face</span>
</span><span id="__span-67-24"><a id="__codelineno-67-24" name="__codelineno-67-24" href="#__codelineno-67-24"></a>                <span class="n">w1</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-67-25"><a id="__codelineno-67-25" name="__codelineno-67-25" href="#__codelineno-67-25"></a>                <span class="n">w2</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-67-26"><a id="__codelineno-67-26" name="__codelineno-67-26" href="#__codelineno-67-26"></a>                <span class="n">w3</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-67-27"><a id="__codelineno-67-27" name="__codelineno-67-27" href="#__codelineno-67-27"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-67-28"><a id="__codelineno-67-28" name="__codelineno-67-28" href="#__codelineno-67-28"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-67-29"><a id="__codelineno-67-29" name="__codelineno-67-29" href="#__codelineno-67-29"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-67-30"><a id="__codelineno-67-30" name="__codelineno-67-30" href="#__codelineno-67-30"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-67-31"><a id="__codelineno-67-31" name="__codelineno-67-31" href="#__codelineno-67-31"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-67-32"><a id="__codelineno-67-32" name="__codelineno-67-32" href="#__codelineno-67-32"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-67-33"><a id="__codelineno-67-33" name="__codelineno-67-33" href="#__codelineno-67-33"></a>            <span class="k">else</span><span class="p">:</span> <span class="c1"># quad face</span>
</span><span id="__span-67-34"><a id="__codelineno-67-34" name="__codelineno-67-34" href="#__codelineno-67-34"></a>                <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-67-35"><a id="__codelineno-67-35" name="__codelineno-67-35" href="#__codelineno-67-35"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-67-36"><a id="__codelineno-67-36" name="__codelineno-67-36" href="#__codelineno-67-36"></a>
</span><span id="__span-67-37"><a id="__codelineno-67-37" name="__codelineno-67-37" href="#__codelineno-67-37"></a>                <span class="n">w1</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-67-38"><a id="__codelineno-67-38" name="__codelineno-67-38" href="#__codelineno-67-38"></a>                <span class="n">w2</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-67-39"><a id="__codelineno-67-39" name="__codelineno-67-39" href="#__codelineno-67-39"></a>                <span class="n">w3</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-67-40"><a id="__codelineno-67-40" name="__codelineno-67-40" href="#__codelineno-67-40"></a>                <span class="n">w4</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-67-41"><a id="__codelineno-67-41" name="__codelineno-67-41" href="#__codelineno-67-41"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-67-42"><a id="__codelineno-67-42" name="__codelineno-67-42" href="#__codelineno-67-42"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-67-43"><a id="__codelineno-67-43" name="__codelineno-67-43" href="#__codelineno-67-43"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-67-44"><a id="__codelineno-67-44" name="__codelineno-67-44" href="#__codelineno-67-44"></a>                <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-67-45"><a id="__codelineno-67-45" name="__codelineno-67-45" href="#__codelineno-67-45"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-67-46"><a id="__codelineno-67-46" name="__codelineno-67-46" href="#__codelineno-67-46"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-67-47"><a id="__codelineno-67-47" name="__codelineno-67-47" href="#__codelineno-67-47"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-67-48"><a id="__codelineno-67-48" name="__codelineno-67-48" href="#__codelineno-67-48"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-67-49"><a id="__codelineno-67-49" name="__codelineno-67-49" href="#__codelineno-67-49"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-67-50"><a id="__codelineno-67-50" name="__codelineno-67-50" href="#__codelineno-67-50"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-67-51"><a id="__codelineno-67-51" name="__codelineno-67-51" href="#__codelineno-67-51"></a>
</span><span id="__span-67-52"><a id="__codelineno-67-52" name="__codelineno-67-52" href="#__codelineno-67-52"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-67-53"><a id="__codelineno-67-53" name="__codelineno-67-53" href="#__codelineno-67-53"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-67-54"><a id="__codelineno-67-54" name="__codelineno-67-54" href="#__codelineno-67-54"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-67-55"><a id="__codelineno-67-55" name="__codelineno-67-55" href="#__codelineno-67-55"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-67-56"><a id="__codelineno-67-56" name="__codelineno-67-56" href="#__codelineno-67-56"></a>
</span><span id="__span-67-57"><a id="__codelineno-67-57" name="__codelineno-67-57" href="#__codelineno-67-57"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># 0 &lt; ratio1 &lt; 1, 0 &lt; ratio2 &lt; 1 to be inside quad</span>
</span><span id="__span-67-58"><a id="__codelineno-67-58" name="__codelineno-67-58" href="#__codelineno-67-58"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v4</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span>
</span><span id="__span-67-59"><a id="__codelineno-67-59" name="__codelineno-67-59" href="#__codelineno-67-59"></a>
</span><span id="__span-67-60"><a id="__codelineno-67-60" name="__codelineno-67-60" href="#__codelineno-67-60"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># ratio1 &gt; 0, ratio2 &gt; 0, ratio1+ratio2 &lt; 1 to be inside triangle</span>
</span><span id="__span-67-61"><a id="__codelineno-67-61" name="__codelineno-67-61" href="#__codelineno-67-61"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio1</span><span class="o">+</span><span class="p">(</span><span class="n">v3</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span><span class="o">+</span><span class="n">v1</span>
</span><span id="__span-67-62"><a id="__codelineno-67-62" name="__codelineno-67-62" href="#__codelineno-67-62"></a>
</span><span id="__span-67-63"><a id="__codelineno-67-63" name="__codelineno-67-63" href="#__codelineno-67-63"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="712-subdivision-9-quad-subdivision">7.12 Subdivision 9: Quad Subdivision</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1"># offset vertex</span>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a>
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-68-18"><a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-68-19"><a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-68-20"><a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-68-21"><a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-68-22"><a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-68-23"><a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a>
</span><span id="__span-68-24"><a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-68-25"><a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-68-26"><a id="__codelineno-68-26" name="__codelineno-68-26" href="#__codelineno-68-26"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-68-27"><a id="__codelineno-68-27" name="__codelineno-68-27" href="#__codelineno-68-27"></a>            <span class="n">w4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-68-28"><a id="__codelineno-68-28" name="__codelineno-68-28" href="#__codelineno-68-28"></a>            <span class="n">w5</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="c1"># center point</span>
</span><span id="__span-68-29"><a id="__codelineno-68-29" name="__codelineno-68-29" href="#__codelineno-68-29"></a>            <span class="n">w5</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="c1">#offset new vertex</span>
</span><span id="__span-68-30"><a id="__codelineno-68-30" name="__codelineno-68-30" href="#__codelineno-68-30"></a>
</span><span id="__span-68-31"><a id="__codelineno-68-31" name="__codelineno-68-31" href="#__codelineno-68-31"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-68-32"><a id="__codelineno-68-32" name="__codelineno-68-32" href="#__codelineno-68-32"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-68-33"><a id="__codelineno-68-33" name="__codelineno-68-33" href="#__codelineno-68-33"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-68-34"><a id="__codelineno-68-34" name="__codelineno-68-34" href="#__codelineno-68-34"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-68-35"><a id="__codelineno-68-35" name="__codelineno-68-35" href="#__codelineno-68-35"></a>            <span class="n">widx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w5</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-68-36"><a id="__codelineno-68-36" name="__codelineno-68-36" href="#__codelineno-68-36"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-68-37"><a id="__codelineno-68-37" name="__codelineno-68-37" href="#__codelineno-68-37"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-68-38"><a id="__codelineno-68-38" name="__codelineno-68-38" href="#__codelineno-68-38"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-68-39"><a id="__codelineno-68-39" name="__codelineno-68-39" href="#__codelineno-68-39"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-68-40"><a id="__codelineno-68-40" name="__codelineno-68-40" href="#__codelineno-68-40"></a>
</span><span id="__span-68-41"><a id="__codelineno-68-41" name="__codelineno-68-41" href="#__codelineno-68-41"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-68-42"><a id="__codelineno-68-42" name="__codelineno-68-42" href="#__codelineno-68-42"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># put original face</span>
</span><span id="__span-68-43"><a id="__codelineno-68-43" name="__codelineno-68-43" href="#__codelineno-68-43"></a>
</span><span id="__span-68-44"><a id="__codelineno-68-44" name="__codelineno-68-44" href="#__codelineno-68-44"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-68-45"><a id="__codelineno-68-45" name="__codelineno-68-45" href="#__codelineno-68-45"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="c1">#weld vertices</span>
</span><span id="__span-68-46"><a id="__codelineno-68-46" name="__codelineno-68-46" href="#__codelineno-68-46"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-68-47"><a id="__codelineno-68-47" name="__codelineno-68-47" href="#__codelineno-68-47"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-68-48"><a id="__codelineno-68-48" name="__codelineno-68-48" href="#__codelineno-68-48"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-68-49"><a id="__codelineno-68-49" name="__codelineno-68-49" href="#__codelineno-68-49"></a>
</span><span id="__span-68-50"><a id="__codelineno-68-50" name="__codelineno-68-50" href="#__codelineno-68-50"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.13 Subdivision 10: Triangular Subdivision
<div class="language-PY highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1">#offset vertex</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span> <span class="c1"># triangular face</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsTriangle</span><span class="p">):</span>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19" href="#__codelineno-69-19"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20" href="#__codelineno-69-20"></a>
</span><span id="__span-69-21"><a id="__codelineno-69-21" name="__codelineno-69-21" href="#__codelineno-69-21"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-69-22"><a id="__codelineno-69-22" name="__codelineno-69-22" href="#__codelineno-69-22"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-69-23"><a id="__codelineno-69-23" name="__codelineno-69-23" href="#__codelineno-69-23"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-69-24"><a id="__codelineno-69-24" name="__codelineno-69-24" href="#__codelineno-69-24"></a>            <span class="n">w4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="c1"># center point</span>
</span><span id="__span-69-25"><a id="__codelineno-69-25" name="__codelineno-69-25" href="#__codelineno-69-25"></a>            <span class="n">w4</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="c1"># offset new vertex</span>
</span><span id="__span-69-26"><a id="__codelineno-69-26" name="__codelineno-69-26" href="#__codelineno-69-26"></a>
</span><span id="__span-69-27"><a id="__codelineno-69-27" name="__codelineno-69-27" href="#__codelineno-69-27"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-69-28"><a id="__codelineno-69-28" name="__codelineno-69-28" href="#__codelineno-69-28"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-69-29"><a id="__codelineno-69-29" name="__codelineno-69-29" href="#__codelineno-69-29"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-69-30"><a id="__codelineno-69-30" name="__codelineno-69-30" href="#__codelineno-69-30"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-69-31"><a id="__codelineno-69-31" name="__codelineno-69-31" href="#__codelineno-69-31"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-69-32"><a id="__codelineno-69-32" name="__codelineno-69-32" href="#__codelineno-69-32"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-69-33"><a id="__codelineno-69-33" name="__codelineno-69-33" href="#__codelineno-69-33"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-69-34"><a id="__codelineno-69-34" name="__codelineno-69-34" href="#__codelineno-69-34"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># quad face</span>
</span><span id="__span-69-35"><a id="__codelineno-69-35" name="__codelineno-69-35" href="#__codelineno-69-35"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># put original face</span>
</span><span id="__span-69-36"><a id="__codelineno-69-36" name="__codelineno-69-36" href="#__codelineno-69-36"></a>
</span><span id="__span-69-37"><a id="__codelineno-69-37" name="__codelineno-69-37" href="#__codelineno-69-37"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># weld vertices</span>
</span><span id="__span-69-38"><a id="__codelineno-69-38" name="__codelineno-69-38" href="#__codelineno-69-38"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-69-39"><a id="__codelineno-69-39" name="__codelineno-69-39" href="#__codelineno-69-39"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-69-40"><a id="__codelineno-69-40" name="__codelineno-69-40" href="#__codelineno-69-40"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-69-41"><a id="__codelineno-69-41" name="__codelineno-69-41" href="#__codelineno-69-41"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-69-42"><a id="__codelineno-69-42" name="__codelineno-69-42" href="#__codelineno-69-42"></a>
</span><span id="__span-69-43"><a id="__codelineno-69-43" name="__codelineno-69-43" href="#__codelineno-69-43"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.14 Subdivision 11: Quad Subdivision with Randomness
<div class="language-PY highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="c1"># offset randomly</span>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-70-15"><a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-70-16"><a id="__codelineno-70-16" name="__codelineno-70-16" href="#__codelineno-70-16"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-70-17"><a id="__codelineno-70-17" name="__codelineno-70-17" href="#__codelineno-70-17"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-70-18"><a id="__codelineno-70-18" name="__codelineno-70-18" href="#__codelineno-70-18"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-70-19"><a id="__codelineno-70-19" name="__codelineno-70-19" href="#__codelineno-70-19"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-70-20"><a id="__codelineno-70-20" name="__codelineno-70-20" href="#__codelineno-70-20"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-70-21"><a id="__codelineno-70-21" name="__codelineno-70-21" href="#__codelineno-70-21"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-70-22"><a id="__codelineno-70-22" name="__codelineno-70-22" href="#__codelineno-70-22"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-70-23"><a id="__codelineno-70-23" name="__codelineno-70-23" href="#__codelineno-70-23"></a>
</span><span id="__span-70-24"><a id="__codelineno-70-24" name="__codelineno-70-24" href="#__codelineno-70-24"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-70-25"><a id="__codelineno-70-25" name="__codelineno-70-25" href="#__codelineno-70-25"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-70-26"><a id="__codelineno-70-26" name="__codelineno-70-26" href="#__codelineno-70-26"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-70-27"><a id="__codelineno-70-27" name="__codelineno-70-27" href="#__codelineno-70-27"></a>            <span class="n">w4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-70-28"><a id="__codelineno-70-28" name="__codelineno-70-28" href="#__codelineno-70-28"></a>
</span><span id="__span-70-29"><a id="__codelineno-70-29" name="__codelineno-70-29" href="#__codelineno-70-29"></a>            <span class="n">r1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">uvMove</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.5</span><span class="o">+</span><span class="n">uvMove</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># random u ratio</span>
</span><span id="__span-70-30"><a id="__codelineno-70-30" name="__codelineno-70-30" href="#__codelineno-70-30"></a>            <span class="n">r2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">uvMove</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.5</span><span class="o">+</span><span class="n">uvMove</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># random v ratio</span>
</span><span id="__span-70-31"><a id="__codelineno-70-31" name="__codelineno-70-31" href="#__codelineno-70-31"></a>            <span class="n">w5</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="n">r1</span><span class="o">*</span><span class="n">r2</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r1</span><span class="p">)</span><span class="o">*</span><span class="n">r2</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r2</span><span class="p">)</span><span class="o">+</span><span class="n">v4</span><span class="o">*</span><span class="n">r1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r2</span><span class="p">)</span> <span class="c1"># new point in quad</span>
</span><span id="__span-70-32"><a id="__codelineno-70-32" name="__codelineno-70-32" href="#__codelineno-70-32"></a>            <span class="n">w5</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="c1"># offset randomly</span>
</span><span id="__span-70-33"><a id="__codelineno-70-33" name="__codelineno-70-33" href="#__codelineno-70-33"></a>
</span><span id="__span-70-34"><a id="__codelineno-70-34" name="__codelineno-70-34" href="#__codelineno-70-34"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-70-35"><a id="__codelineno-70-35" name="__codelineno-70-35" href="#__codelineno-70-35"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-70-36"><a id="__codelineno-70-36" name="__codelineno-70-36" href="#__codelineno-70-36"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-70-37"><a id="__codelineno-70-37" name="__codelineno-70-37" href="#__codelineno-70-37"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span>
</span><span id="__span-70-38"><a id="__codelineno-70-38" name="__codelineno-70-38" href="#__codelineno-70-38"></a>            <span class="n">widx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w5</span><span class="p">)</span>
</span><span id="__span-70-39"><a id="__codelineno-70-39" name="__codelineno-70-39" href="#__codelineno-70-39"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-70-40"><a id="__codelineno-70-40" name="__codelineno-70-40" href="#__codelineno-70-40"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-70-41"><a id="__codelineno-70-41" name="__codelineno-70-41" href="#__codelineno-70-41"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-70-42"><a id="__codelineno-70-42" name="__codelineno-70-42" href="#__codelineno-70-42"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-70-43"><a id="__codelineno-70-43" name="__codelineno-70-43" href="#__codelineno-70-43"></a>
</span><span id="__span-70-44"><a id="__codelineno-70-44" name="__codelineno-70-44" href="#__codelineno-70-44"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-70-45"><a id="__codelineno-70-45" name="__codelineno-70-45" href="#__codelineno-70-45"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="c1"># put original face</span>
</span><span id="__span-70-46"><a id="__codelineno-70-46" name="__codelineno-70-46" href="#__codelineno-70-46"></a>
</span><span id="__span-70-47"><a id="__codelineno-70-47" name="__codelineno-70-47" href="#__codelineno-70-47"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-70-48"><a id="__codelineno-70-48" name="__codelineno-70-48" href="#__codelineno-70-48"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># weld vertices</span>
</span><span id="__span-70-49"><a id="__codelineno-70-49" name="__codelineno-70-49" href="#__codelineno-70-49"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-70-50"><a id="__codelineno-70-50" name="__codelineno-70-50" href="#__codelineno-70-50"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-70-51"><a id="__codelineno-70-51" name="__codelineno-70-51" href="#__codelineno-70-51"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-70-52"><a id="__codelineno-70-52" name="__codelineno-70-52" href="#__codelineno-70-52"></a>
</span><span id="__span-70-53"><a id="__codelineno-70-53" name="__codelineno-70-53" href="#__codelineno-70-53"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.15 Subdivision 12: Quad Subdivision with Attractors 
<div class="language-PY highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access), attractors : Point3d (List Access), attractorRange: float (ItemAccess)</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="o">*</span> <span class="n">attractorValue</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># offset vertex</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-71-19"><a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-71-20"><a id="__codelineno-71-20" name="__codelineno-71-20" href="#__codelineno-71-20"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-71-21"><a id="__codelineno-71-21" name="__codelineno-71-21" href="#__codelineno-71-21"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-71-22"><a id="__codelineno-71-22" name="__codelineno-71-22" href="#__codelineno-71-22"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-71-23"><a id="__codelineno-71-23" name="__codelineno-71-23" href="#__codelineno-71-23"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-71-24"><a id="__codelineno-71-24" name="__codelineno-71-24" href="#__codelineno-71-24"></a>
</span><span id="__span-71-25"><a id="__codelineno-71-25" name="__codelineno-71-25" href="#__codelineno-71-25"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-71-26"><a id="__codelineno-71-26" name="__codelineno-71-26" href="#__codelineno-71-26"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-71-27"><a id="__codelineno-71-27" name="__codelineno-71-27" href="#__codelineno-71-27"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-71-28"><a id="__codelineno-71-28" name="__codelineno-71-28" href="#__codelineno-71-28"></a>            <span class="n">w4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-71-29"><a id="__codelineno-71-29" name="__codelineno-71-29" href="#__codelineno-71-29"></a>            <span class="n">w5</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="c1"># center point</span>
</span><span id="__span-71-30"><a id="__codelineno-71-30" name="__codelineno-71-30" href="#__codelineno-71-30"></a>            <span class="n">w5</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="o">*</span> <span class="n">attractorValue</span><span class="p">(</span><span class="n">w5</span><span class="p">)</span> <span class="c1"># offset new vertex</span>
</span><span id="__span-71-31"><a id="__codelineno-71-31" name="__codelineno-71-31" href="#__codelineno-71-31"></a>
</span><span id="__span-71-32"><a id="__codelineno-71-32" name="__codelineno-71-32" href="#__codelineno-71-32"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-71-33"><a id="__codelineno-71-33" name="__codelineno-71-33" href="#__codelineno-71-33"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-71-34"><a id="__codelineno-71-34" name="__codelineno-71-34" href="#__codelineno-71-34"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-71-35"><a id="__codelineno-71-35" name="__codelineno-71-35" href="#__codelineno-71-35"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span>
</span><span id="__span-71-36"><a id="__codelineno-71-36" name="__codelineno-71-36" href="#__codelineno-71-36"></a>            <span class="n">widx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w5</span><span class="p">)</span>
</span><span id="__span-71-37"><a id="__codelineno-71-37" name="__codelineno-71-37" href="#__codelineno-71-37"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-71-38"><a id="__codelineno-71-38" name="__codelineno-71-38" href="#__codelineno-71-38"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-71-39"><a id="__codelineno-71-39" name="__codelineno-71-39" href="#__codelineno-71-39"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-71-40"><a id="__codelineno-71-40" name="__codelineno-71-40" href="#__codelineno-71-40"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-71-41"><a id="__codelineno-71-41" name="__codelineno-71-41" href="#__codelineno-71-41"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-71-42"><a id="__codelineno-71-42" name="__codelineno-71-42" href="#__codelineno-71-42"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># put original face</span>
</span><span id="__span-71-43"><a id="__codelineno-71-43" name="__codelineno-71-43" href="#__codelineno-71-43"></a>
</span><span id="__span-71-44"><a id="__codelineno-71-44" name="__codelineno-71-44" href="#__codelineno-71-44"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-71-45"><a id="__codelineno-71-45" name="__codelineno-71-45" href="#__codelineno-71-45"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># weld vertices</span>
</span><span id="__span-71-46"><a id="__codelineno-71-46" name="__codelineno-71-46" href="#__codelineno-71-46"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-71-47"><a id="__codelineno-71-47" name="__codelineno-71-47" href="#__codelineno-71-47"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-71-48"><a id="__codelineno-71-48" name="__codelineno-71-48" href="#__codelineno-71-48"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-71-49"><a id="__codelineno-71-49" name="__codelineno-71-49" href="#__codelineno-71-49"></a>
</span><span id="__span-71-50"><a id="__codelineno-71-50" name="__codelineno-71-50" href="#__codelineno-71-50"></a><span class="k">def</span><span class="w"> </span><span class="nf">attractorValue</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span> <span class="c1"># calculate value of 0-1 by attractors</span>
</span><span id="__span-71-51"><a id="__codelineno-71-51" name="__codelineno-71-51" href="#__codelineno-71-51"></a>    <span class="n">minDist</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-71-52"><a id="__codelineno-71-52" name="__codelineno-71-52" href="#__codelineno-71-52"></a>    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attractors</span><span class="p">:</span> <span class="c1"># find closest attractor</span>
</span><span id="__span-71-53"><a id="__codelineno-71-53" name="__codelineno-71-53" href="#__codelineno-71-53"></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span><span id="__span-71-54"><a id="__codelineno-71-54" name="__codelineno-71-54" href="#__codelineno-71-54"></a>        <span class="k">if</span><span class="p">(</span> <span class="n">minDist</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">minDist</span> <span class="p">):</span>
</span><span id="__span-71-55"><a id="__codelineno-71-55" name="__codelineno-71-55" href="#__codelineno-71-55"></a>            <span class="n">minDist</span> <span class="o">=</span> <span class="n">dist</span>
</span><span id="__span-71-56"><a id="__codelineno-71-56" name="__codelineno-71-56" href="#__codelineno-71-56"></a>    <span class="k">if</span><span class="p">(</span><span class="n">minDist</span> <span class="o">&lt;</span> <span class="n">attractorRange</span><span class="p">):</span> <span class="c1"># check range and scale value to 0 - 1</span>
</span><span id="__span-71-57"><a id="__codelineno-71-57" name="__codelineno-71-57" href="#__codelineno-71-57"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">attractorRange</span> <span class="o">-</span> <span class="n">minDist</span><span class="p">)</span><span class="o">/</span><span class="n">attractorRange</span> <span class="c1"># value from 0 to 1</span>
</span><span id="__span-71-58"><a id="__codelineno-71-58" name="__codelineno-71-58" href="#__codelineno-71-58"></a>    <span class="k">return</span> <span class="mi">0</span> <span class="c1"># when out of range</span>
</span><span id="__span-71-59"><a id="__codelineno-71-59" name="__codelineno-71-59" href="#__codelineno-71-59"></a>
</span><span id="__span-71-60"><a id="__codelineno-71-60" name="__codelineno-71-60" href="#__codelineno-71-60"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.16 Subdivision 13: Quad Subdivision with Depth Control by Bitmap
<div class="language-PY highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="c1"># subdivide quad mes. offset depth is controlled by bitmap pixel values</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access), imageProjectionSurface : Surface (Item Access), imagePixelValue : float (Tree Access)</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="o">*</span> <span class="n">pixelValue</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># offset vertex</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-72-20"><a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a>
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a>            <span class="n">w4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-72-28"><a id="__codelineno-72-28" name="__codelineno-72-28" href="#__codelineno-72-28"></a>            <span class="n">w5</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="c1"># center point</span>
</span><span id="__span-72-29"><a id="__codelineno-72-29" name="__codelineno-72-29" href="#__codelineno-72-29"></a>            <span class="n">w5</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="o">*</span> <span class="n">pixelValue</span><span class="p">(</span><span class="n">w5</span><span class="p">)</span> <span class="c1"># offset new vertex</span>
</span><span id="__span-72-30"><a id="__codelineno-72-30" name="__codelineno-72-30" href="#__codelineno-72-30"></a>
</span><span id="__span-72-31"><a id="__codelineno-72-31" name="__codelineno-72-31" href="#__codelineno-72-31"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-72-32"><a id="__codelineno-72-32" name="__codelineno-72-32" href="#__codelineno-72-32"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-72-33"><a id="__codelineno-72-33" name="__codelineno-72-33" href="#__codelineno-72-33"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-72-34"><a id="__codelineno-72-34" name="__codelineno-72-34" href="#__codelineno-72-34"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span>
</span><span id="__span-72-35"><a id="__codelineno-72-35" name="__codelineno-72-35" href="#__codelineno-72-35"></a>            <span class="n">widx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w5</span><span class="p">)</span>
</span><span id="__span-72-36"><a id="__codelineno-72-36" name="__codelineno-72-36" href="#__codelineno-72-36"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-72-37"><a id="__codelineno-72-37" name="__codelineno-72-37" href="#__codelineno-72-37"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-72-38"><a id="__codelineno-72-38" name="__codelineno-72-38" href="#__codelineno-72-38"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-72-39"><a id="__codelineno-72-39" name="__codelineno-72-39" href="#__codelineno-72-39"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-72-40"><a id="__codelineno-72-40" name="__codelineno-72-40" href="#__codelineno-72-40"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-72-41"><a id="__codelineno-72-41" name="__codelineno-72-41" href="#__codelineno-72-41"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-72-42"><a id="__codelineno-72-42" name="__codelineno-72-42" href="#__codelineno-72-42"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-72-43"><a id="__codelineno-72-43" name="__codelineno-72-43" href="#__codelineno-72-43"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-72-44"><a id="__codelineno-72-44" name="__codelineno-72-44" href="#__codelineno-72-44"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-72-45"><a id="__codelineno-72-45" name="__codelineno-72-45" href="#__codelineno-72-45"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-72-46"><a id="__codelineno-72-46" name="__codelineno-72-46" href="#__codelineno-72-46"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-72-47"><a id="__codelineno-72-47" name="__codelineno-72-47" href="#__codelineno-72-47"></a>
</span><span id="__span-72-48"><a id="__codelineno-72-48" name="__codelineno-72-48" href="#__codelineno-72-48"></a>            <span class="n">w1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-72-49"><a id="__codelineno-72-49" name="__codelineno-72-49" href="#__codelineno-72-49"></a>            <span class="n">w2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-72-50"><a id="__codelineno-72-50" name="__codelineno-72-50" href="#__codelineno-72-50"></a>            <span class="n">w3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mid point</span>
</span><span id="__span-72-51"><a id="__codelineno-72-51" name="__codelineno-72-51" href="#__codelineno-72-51"></a>            <span class="n">w4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="c1"># center point</span>
</span><span id="__span-72-52"><a id="__codelineno-72-52" name="__codelineno-72-52" href="#__codelineno-72-52"></a>            <span class="n">w4</span> <span class="o">+=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="o">*</span> <span class="n">pixelValue</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span> <span class="c1"># offset new vertex</span>
</span><span id="__span-72-53"><a id="__codelineno-72-53" name="__codelineno-72-53" href="#__codelineno-72-53"></a>
</span><span id="__span-72-54"><a id="__codelineno-72-54" name="__codelineno-72-54" href="#__codelineno-72-54"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-72-55"><a id="__codelineno-72-55" name="__codelineno-72-55" href="#__codelineno-72-55"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-72-56"><a id="__codelineno-72-56" name="__codelineno-72-56" href="#__codelineno-72-56"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-72-57"><a id="__codelineno-72-57" name="__codelineno-72-57" href="#__codelineno-72-57"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span>
</span><span id="__span-72-58"><a id="__codelineno-72-58" name="__codelineno-72-58" href="#__codelineno-72-58"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-72-59"><a id="__codelineno-72-59" name="__codelineno-72-59" href="#__codelineno-72-59"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-72-60"><a id="__codelineno-72-60" name="__codelineno-72-60" href="#__codelineno-72-60"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-72-61"><a id="__codelineno-72-61" name="__codelineno-72-61" href="#__codelineno-72-61"></a>
</span><span id="__span-72-62"><a id="__codelineno-72-62" name="__codelineno-72-62" href="#__codelineno-72-62"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-72-63"><a id="__codelineno-72-63" name="__codelineno-72-63" href="#__codelineno-72-63"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># weld vertices</span>
</span><span id="__span-72-64"><a id="__codelineno-72-64" name="__codelineno-72-64" href="#__codelineno-72-64"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-72-65"><a id="__codelineno-72-65" name="__codelineno-72-65" href="#__codelineno-72-65"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-72-66"><a id="__codelineno-72-66" name="__codelineno-72-66" href="#__codelineno-72-66"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-72-67"><a id="__codelineno-72-67" name="__codelineno-72-67" href="#__codelineno-72-67"></a>
</span><span id="__span-72-68"><a id="__codelineno-72-68" name="__codelineno-72-68" href="#__codelineno-72-68"></a><span class="k">def</span><span class="w"> </span><span class="nf">pixelValue</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
</span><span id="__span-72-69"><a id="__codelineno-72-69" name="__codelineno-72-69" href="#__codelineno-72-69"></a>    <span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">imageProjectionSurface</span><span class="o">.</span><span class="n">ClosestPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="c1"># find closest point on surface</span>
</span><span id="__span-72-70"><a id="__codelineno-72-70" name="__codelineno-72-70" href="#__codelineno-72-70"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span> <span class="p">:</span> <span class="c1"># if it fails, return 0</span>
</span><span id="__span-72-71"><a id="__codelineno-72-71" name="__codelineno-72-71" href="#__codelineno-72-71"></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-72-72"><a id="__codelineno-72-72" name="__codelineno-72-72" href="#__codelineno-72-72"></a>    <span class="c1"># pick a pixel value on the tree branch matrix</span>
</span><span id="__span-72-73"><a id="__codelineno-72-73" name="__codelineno-72-73" href="#__codelineno-72-73"></a>    <span class="n">branch</span> <span class="o">=</span> <span class="n">imagePixelValue</span><span class="o">.</span><span class="n">Branches</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">imagePixelValue</span><span class="o">.</span><span class="n">BranchCount</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">)]</span> 
</span><span id="__span-72-74"><a id="__codelineno-72-74" name="__codelineno-72-74" href="#__codelineno-72-74"></a>    <span class="k">return</span> <span class="n">branch</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="p">)]</span>
</span><span id="__span-72-75"><a id="__codelineno-72-75" name="__codelineno-72-75" href="#__codelineno-72-75"></a>
</span><span id="__span-72-76"><a id="__codelineno-72-76" name="__codelineno-72-76" href="#__codelineno-72-76"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.17 Subdivision 14: Frame Subdivision with Recursion Control by Bitmap
<div class="language-PY highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="c1"># subdivide quad mes. offset depth is controlled by bitmap pixel values</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access), holeRatio : float (Item Access), imageProjectionSurface : Surface (Item Access), imagePixelValue : float (Tree Access)</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span> <span class="c1">#offset vertex</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a>
</span><span id="__span-73-13"><a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-73-14"><a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a>        <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-73-15"><a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a>        <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-73-16"><a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a>        <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-73-17"><a id="__codelineno-73-17" name="__codelineno-73-17" href="#__codelineno-73-17"></a>        <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-73-18"><a id="__codelineno-73-18" name="__codelineno-73-18" href="#__codelineno-73-18"></a>        <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-73-19"><a id="__codelineno-73-19" name="__codelineno-73-19" href="#__codelineno-73-19"></a>        <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-73-20"><a id="__codelineno-73-20" name="__codelineno-73-20" href="#__codelineno-73-20"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="c1">#random normal vector</span>
</span><span id="__span-73-21"><a id="__codelineno-73-21" name="__codelineno-73-21" href="#__codelineno-73-21"></a>
</span><span id="__span-73-22"><a id="__codelineno-73-22" name="__codelineno-73-22" href="#__codelineno-73-22"></a>        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsTriangle</span><span class="p">:</span> <span class="c1"># triangle face</span>
</span><span id="__span-73-23"><a id="__codelineno-73-23" name="__codelineno-73-23" href="#__codelineno-73-23"></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">pixelValue</span><span class="p">((</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="p">:</span>
</span><span id="__span-73-24"><a id="__codelineno-73-24" name="__codelineno-73-24" href="#__codelineno-73-24"></a>                <span class="n">w1</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-73-25"><a id="__codelineno-73-25" name="__codelineno-73-25" href="#__codelineno-73-25"></a>                <span class="n">w2</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-73-26"><a id="__codelineno-73-26" name="__codelineno-73-26" href="#__codelineno-73-26"></a>                <span class="n">w3</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#new vertex</span>
</span><span id="__span-73-27"><a id="__codelineno-73-27" name="__codelineno-73-27" href="#__codelineno-73-27"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-73-28"><a id="__codelineno-73-28" name="__codelineno-73-28" href="#__codelineno-73-28"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-73-29"><a id="__codelineno-73-29" name="__codelineno-73-29" href="#__codelineno-73-29"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span> <span class="c1">#add new vertex and get index</span>
</span><span id="__span-73-30"><a id="__codelineno-73-30" name="__codelineno-73-30" href="#__codelineno-73-30"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-73-31"><a id="__codelineno-73-31" name="__codelineno-73-31" href="#__codelineno-73-31"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-73-32"><a id="__codelineno-73-32" name="__codelineno-73-32" href="#__codelineno-73-32"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-73-33"><a id="__codelineno-73-33" name="__codelineno-73-33" href="#__codelineno-73-33"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-73-34"><a id="__codelineno-73-34" name="__codelineno-73-34" href="#__codelineno-73-34"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-73-35"><a id="__codelineno-73-35" name="__codelineno-73-35" href="#__codelineno-73-35"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># quad face</span>
</span><span id="__span-73-36"><a id="__codelineno-73-36" name="__codelineno-73-36" href="#__codelineno-73-36"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-73-37"><a id="__codelineno-73-37" name="__codelineno-73-37" href="#__codelineno-73-37"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-73-38"><a id="__codelineno-73-38" name="__codelineno-73-38" href="#__codelineno-73-38"></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">pixelValue</span><span class="p">((</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="p">:</span>
</span><span id="__span-73-39"><a id="__codelineno-73-39" name="__codelineno-73-39" href="#__codelineno-73-39"></a>                <span class="n">w1</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-73-40"><a id="__codelineno-73-40" name="__codelineno-73-40" href="#__codelineno-73-40"></a>                <span class="n">w2</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-73-41"><a id="__codelineno-73-41" name="__codelineno-73-41" href="#__codelineno-73-41"></a>                <span class="n">w3</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-73-42"><a id="__codelineno-73-42" name="__codelineno-73-42" href="#__codelineno-73-42"></a>                <span class="n">w4</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="c1"># new vertex</span>
</span><span id="__span-73-43"><a id="__codelineno-73-43" name="__codelineno-73-43" href="#__codelineno-73-43"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-73-44"><a id="__codelineno-73-44" name="__codelineno-73-44" href="#__codelineno-73-44"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-73-45"><a id="__codelineno-73-45" name="__codelineno-73-45" href="#__codelineno-73-45"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-73-46"><a id="__codelineno-73-46" name="__codelineno-73-46" href="#__codelineno-73-46"></a>                <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span> <span class="c1"># add new vertex and get index</span>
</span><span id="__span-73-47"><a id="__codelineno-73-47" name="__codelineno-73-47" href="#__codelineno-73-47"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-73-48"><a id="__codelineno-73-48" name="__codelineno-73-48" href="#__codelineno-73-48"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-73-49"><a id="__codelineno-73-49" name="__codelineno-73-49" href="#__codelineno-73-49"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-73-50"><a id="__codelineno-73-50" name="__codelineno-73-50" href="#__codelineno-73-50"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span> <span class="c1"># subdivided face</span>
</span><span id="__span-73-51"><a id="__codelineno-73-51" name="__codelineno-73-51" href="#__codelineno-73-51"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-73-52"><a id="__codelineno-73-52" name="__codelineno-73-52" href="#__codelineno-73-52"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-73-53"><a id="__codelineno-73-53" name="__codelineno-73-53" href="#__codelineno-73-53"></a>
</span><span id="__span-73-54"><a id="__codelineno-73-54" name="__codelineno-73-54" href="#__codelineno-73-54"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-73-55"><a id="__codelineno-73-55" name="__codelineno-73-55" href="#__codelineno-73-55"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-73-56"><a id="__codelineno-73-56" name="__codelineno-73-56" href="#__codelineno-73-56"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-73-57"><a id="__codelineno-73-57" name="__codelineno-73-57" href="#__codelineno-73-57"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-73-58"><a id="__codelineno-73-58" name="__codelineno-73-58" href="#__codelineno-73-58"></a>
</span><span id="__span-73-59"><a id="__codelineno-73-59" name="__codelineno-73-59" href="#__codelineno-73-59"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># 0 &lt; ratio1 &lt; 1, 0 &lt; ratio2 &lt; 1 to be inside quad</span>
</span><span id="__span-73-60"><a id="__codelineno-73-60" name="__codelineno-73-60" href="#__codelineno-73-60"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v4</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span>
</span><span id="__span-73-61"><a id="__codelineno-73-61" name="__codelineno-73-61" href="#__codelineno-73-61"></a>
</span><span id="__span-73-62"><a id="__codelineno-73-62" name="__codelineno-73-62" href="#__codelineno-73-62"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># ratio1 &gt; 0, ratio2 &gt; 0, ratio1+ratio2 &lt; 1 to be inside triangle</span>
</span><span id="__span-73-63"><a id="__codelineno-73-63" name="__codelineno-73-63" href="#__codelineno-73-63"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio1</span><span class="o">+</span><span class="p">(</span><span class="n">v3</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span><span class="o">+</span><span class="n">v1</span>
</span><span id="__span-73-64"><a id="__codelineno-73-64" name="__codelineno-73-64" href="#__codelineno-73-64"></a>
</span><span id="__span-73-65"><a id="__codelineno-73-65" name="__codelineno-73-65" href="#__codelineno-73-65"></a><span class="k">def</span><span class="w"> </span><span class="nf">pixelValue</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
</span><span id="__span-73-66"><a id="__codelineno-73-66" name="__codelineno-73-66" href="#__codelineno-73-66"></a>    <span class="p">[</span><span class="n">result</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">imageProjectionSurface</span><span class="o">.</span><span class="n">ClosestPoint</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="c1"># find closest point on surface</span>
</span><span id="__span-73-67"><a id="__codelineno-73-67" name="__codelineno-73-67" href="#__codelineno-73-67"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span> <span class="p">:</span> <span class="c1"># if it fails, return 0</span>
</span><span id="__span-73-68"><a id="__codelineno-73-68" name="__codelineno-73-68" href="#__codelineno-73-68"></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-73-69"><a id="__codelineno-73-69" name="__codelineno-73-69" href="#__codelineno-73-69"></a>    <span class="c1"># pick a pixel value on the tree branch matrix</span>
</span><span id="__span-73-70"><a id="__codelineno-73-70" name="__codelineno-73-70" href="#__codelineno-73-70"></a>    <span class="n">branch</span> <span class="o">=</span> <span class="n">imagePixelValue</span><span class="o">.</span><span class="n">Branches</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">imagePixelValue</span><span class="o">.</span><span class="n">BranchCount</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">)]</span> 
</span><span id="__span-73-71"><a id="__codelineno-73-71" name="__codelineno-73-71" href="#__codelineno-73-71"></a>    <span class="k">return</span> <span class="n">branch</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">branch</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="p">)]</span>
</span><span id="__span-73-72"><a id="__codelineno-73-72" name="__codelineno-73-72" href="#__codelineno-73-72"></a>
</span><span id="__span-73-73"><a id="__codelineno-73-73" name="__codelineno-73-73" href="#__codelineno-73-73"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="718-subdivision-15-quad-probabilistic-subdivision-with-depth-control-by-area">7.18 Subdivision 15: Quad Probabilistic Subdivision with Depth Control by Area</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), recursionProbability : float (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access)</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>            <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span><span class="p">):</span> <span class="c1"># probabilistic switch</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>                <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a>                <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a>                <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a>                <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-74-23"><a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-74-24"><a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a>
</span><span id="__span-74-25"><a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a>                <span class="n">area</span> <span class="o">=</span> <span class="n">quadArea</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">)</span> <span class="c1"># calculate area</span>
</span><span id="__span-74-26"><a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span> <span class="o">*</span> <span class="n">area</span> <span class="o">/</span> <span class="mi">100</span> <span class="c1"># control depth by area</span>
</span><span id="__span-74-27"><a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a>
</span><span id="__span-74-28"><a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a>                <span class="n">w1</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="mf">0.2</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="mf">0.1</span><span class="o">+</span><span class="n">v4</span><span class="o">*</span><span class="mf">0.2</span> <span class="c1"># some point on quad</span>
</span><span id="__span-74-29"><a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a>                <span class="n">w2</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="mf">0.2</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="mf">0.2</span><span class="o">+</span><span class="n">v4</span><span class="o">*</span><span class="mf">0.1</span> <span class="c1"># some point on quad</span>
</span><span id="__span-74-30"><a id="__codelineno-74-30" name="__codelineno-74-30" href="#__codelineno-74-30"></a>                <span class="n">w3</span> <span class="o">=</span> <span class="n">w1</span><span class="o">+</span><span class="n">n</span> <span class="c1"># offset out</span>
</span><span id="__span-74-31"><a id="__codelineno-74-31" name="__codelineno-74-31" href="#__codelineno-74-31"></a>                <span class="n">w4</span> <span class="o">=</span> <span class="n">w2</span><span class="o">+</span><span class="n">n</span> <span class="c1"># offset out</span>
</span><span id="__span-74-32"><a id="__codelineno-74-32" name="__codelineno-74-32" href="#__codelineno-74-32"></a>
</span><span id="__span-74-33"><a id="__codelineno-74-33" name="__codelineno-74-33" href="#__codelineno-74-33"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-74-34"><a id="__codelineno-74-34" name="__codelineno-74-34" href="#__codelineno-74-34"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-74-35"><a id="__codelineno-74-35" name="__codelineno-74-35" href="#__codelineno-74-35"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-74-36"><a id="__codelineno-74-36" name="__codelineno-74-36" href="#__codelineno-74-36"></a>                <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span>
</span><span id="__span-74-37"><a id="__codelineno-74-37" name="__codelineno-74-37" href="#__codelineno-74-37"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-74-38"><a id="__codelineno-74-38" name="__codelineno-74-38" href="#__codelineno-74-38"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-74-39"><a id="__codelineno-74-39" name="__codelineno-74-39" href="#__codelineno-74-39"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-74-40"><a id="__codelineno-74-40" name="__codelineno-74-40" href="#__codelineno-74-40"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-74-41"><a id="__codelineno-74-41" name="__codelineno-74-41" href="#__codelineno-74-41"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-74-42"><a id="__codelineno-74-42" name="__codelineno-74-42" href="#__codelineno-74-42"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-74-43"><a id="__codelineno-74-43" name="__codelineno-74-43" href="#__codelineno-74-43"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-74-44"><a id="__codelineno-74-44" name="__codelineno-74-44" href="#__codelineno-74-44"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-74-45"><a id="__codelineno-74-45" name="__codelineno-74-45" href="#__codelineno-74-45"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-74-46"><a id="__codelineno-74-46" name="__codelineno-74-46" href="#__codelineno-74-46"></a>
</span><span id="__span-74-47"><a id="__codelineno-74-47" name="__codelineno-74-47" href="#__codelineno-74-47"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-74-48"><a id="__codelineno-74-48" name="__codelineno-74-48" href="#__codelineno-74-48"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-74-49"><a id="__codelineno-74-49" name="__codelineno-74-49" href="#__codelineno-74-49"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">offset2</span><span class="o">*</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># offset amount is adjusted by recursion depth</span>
</span><span id="__span-74-50"><a id="__codelineno-74-50" name="__codelineno-74-50" href="#__codelineno-74-50"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-74-51"><a id="__codelineno-74-51" name="__codelineno-74-51" href="#__codelineno-74-51"></a>
</span><span id="__span-74-52"><a id="__codelineno-74-52" name="__codelineno-74-52" href="#__codelineno-74-52"></a><span class="k">def</span><span class="w"> </span><span class="nf">triangleArea</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">):</span> <span class="c1"># area calculation by 3 points</span>
</span><span id="__span-74-53"><a id="__codelineno-74-53" name="__codelineno-74-53" href="#__codelineno-74-53"></a>    <span class="n">crossVec</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span>
</span><span id="__span-74-54"><a id="__codelineno-74-54" name="__codelineno-74-54" href="#__codelineno-74-54"></a>    <span class="k">return</span> <span class="n">crossVec</span><span class="o">.</span><span class="n">Length</span><span class="o">/</span><span class="mi">2</span>
</span><span id="__span-74-55"><a id="__codelineno-74-55" name="__codelineno-74-55" href="#__codelineno-74-55"></a>
</span><span id="__span-74-56"><a id="__codelineno-74-56" name="__codelineno-74-56" href="#__codelineno-74-56"></a><span class="k">def</span><span class="w"> </span><span class="nf">quadArea</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">):</span> <span class="c1"># area calculation by 4 points</span>
</span><span id="__span-74-57"><a id="__codelineno-74-57" name="__codelineno-74-57" href="#__codelineno-74-57"></a>    <span class="k">return</span> <span class="n">triangleArea</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">)</span> <span class="o">+</span> <span class="n">triangleArea</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">v1</span><span class="p">)</span>
</span><span id="__span-74-58"><a id="__codelineno-74-58" name="__codelineno-74-58" href="#__codelineno-74-58"></a>
</span><span id="__span-74-59"><a id="__codelineno-74-59" name="__codelineno-74-59" href="#__codelineno-74-59"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.19 Subdivision 16: Linear Subdivision
<div class="language-PY highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), recursionProbability : float (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access), scale : float (Item Access), bend : float (Item Access)</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># new mesh</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a>    <span class="n">mesh3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># another new mesh</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset1</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a>
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a>        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span> <span class="p">:</span> <span class="c1"># quad face</span>
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-75-19"><a id="__codelineno-75-19" name="__codelineno-75-19" href="#__codelineno-75-19"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-75-20"><a id="__codelineno-75-20" name="__codelineno-75-20" href="#__codelineno-75-20"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-75-21"><a id="__codelineno-75-21" name="__codelineno-75-21" href="#__codelineno-75-21"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-75-22"><a id="__codelineno-75-22" name="__codelineno-75-22" href="#__codelineno-75-22"></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span> <span class="p">:</span>
</span><span id="__span-75-23"><a id="__codelineno-75-23" name="__codelineno-75-23" href="#__codelineno-75-23"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-75-24"><a id="__codelineno-75-24" name="__codelineno-75-24" href="#__codelineno-75-24"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-75-25"><a id="__codelineno-75-25" name="__codelineno-75-25" href="#__codelineno-75-25"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-75-26"><a id="__codelineno-75-26" name="__codelineno-75-26" href="#__codelineno-75-26"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-75-27"><a id="__codelineno-75-27" name="__codelineno-75-27" href="#__codelineno-75-27"></a>
</span><span id="__span-75-28"><a id="__codelineno-75-28" name="__codelineno-75-28" href="#__codelineno-75-28"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span>
</span><span id="__span-75-29"><a id="__codelineno-75-29" name="__codelineno-75-29" href="#__codelineno-75-29"></a>                <span class="n">w1</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">bend</span><span class="p">)</span>
</span><span id="__span-75-30"><a id="__codelineno-75-30" name="__codelineno-75-30" href="#__codelineno-75-30"></a>                <span class="n">w2</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">bend</span><span class="p">)</span>
</span><span id="__span-75-31"><a id="__codelineno-75-31" name="__codelineno-75-31" href="#__codelineno-75-31"></a>                <span class="n">w3</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">bend</span><span class="p">)</span>
</span><span id="__span-75-32"><a id="__codelineno-75-32" name="__codelineno-75-32" href="#__codelineno-75-32"></a>                <span class="n">w4</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">bend</span><span class="p">)</span>
</span><span id="__span-75-33"><a id="__codelineno-75-33" name="__codelineno-75-33" href="#__codelineno-75-33"></a>
</span><span id="__span-75-34"><a id="__codelineno-75-34" name="__codelineno-75-34" href="#__codelineno-75-34"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-75-35"><a id="__codelineno-75-35" name="__codelineno-75-35" href="#__codelineno-75-35"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-75-36"><a id="__codelineno-75-36" name="__codelineno-75-36" href="#__codelineno-75-36"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-75-37"><a id="__codelineno-75-37" name="__codelineno-75-37" href="#__codelineno-75-37"></a>                <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span>
</span><span id="__span-75-38"><a id="__codelineno-75-38" name="__codelineno-75-38" href="#__codelineno-75-38"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1"># tubular side face</span>
</span><span id="__span-75-39"><a id="__codelineno-75-39" name="__codelineno-75-39" href="#__codelineno-75-39"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1"># tubular side face</span>
</span><span id="__span-75-40"><a id="__codelineno-75-40" name="__codelineno-75-40" href="#__codelineno-75-40"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># tubular side face</span>
</span><span id="__span-75-41"><a id="__codelineno-75-41" name="__codelineno-75-41" href="#__codelineno-75-41"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span> <span class="c1"># tubular side face</span>
</span><span id="__span-75-42"><a id="__codelineno-75-42" name="__codelineno-75-42" href="#__codelineno-75-42"></a>
</span><span id="__span-75-43"><a id="__codelineno-75-43" name="__codelineno-75-43" href="#__codelineno-75-43"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-75-44"><a id="__codelineno-75-44" name="__codelineno-75-44" href="#__codelineno-75-44"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-75-45"><a id="__codelineno-75-45" name="__codelineno-75-45" href="#__codelineno-75-45"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-75-46"><a id="__codelineno-75-46" name="__codelineno-75-46" href="#__codelineno-75-46"></a>                <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w4</span><span class="p">)</span>
</span><span id="__span-75-47"><a id="__codelineno-75-47" name="__codelineno-75-47" href="#__codelineno-75-47"></a>                <span class="n">mesh3</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span> <span class="c1"># offset face</span>
</span><span id="__span-75-48"><a id="__codelineno-75-48" name="__codelineno-75-48" href="#__codelineno-75-48"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-75-49"><a id="__codelineno-75-49" name="__codelineno-75-49" href="#__codelineno-75-49"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span> <span class="c1"># original face</span>
</span><span id="__span-75-50"><a id="__codelineno-75-50" name="__codelineno-75-50" href="#__codelineno-75-50"></a>
</span><span id="__span-75-51"><a id="__codelineno-75-51" name="__codelineno-75-51" href="#__codelineno-75-51"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-75-52"><a id="__codelineno-75-52" name="__codelineno-75-52" href="#__codelineno-75-52"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-75-53"><a id="__codelineno-75-53" name="__codelineno-75-53" href="#__codelineno-75-53"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-75-54"><a id="__codelineno-75-54" name="__codelineno-75-54" href="#__codelineno-75-54"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-75-55"><a id="__codelineno-75-55" name="__codelineno-75-55" href="#__codelineno-75-55"></a>            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span> <span class="p">:</span>
</span><span id="__span-75-56"><a id="__codelineno-75-56" name="__codelineno-75-56" href="#__codelineno-75-56"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-75-57"><a id="__codelineno-75-57" name="__codelineno-75-57" href="#__codelineno-75-57"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-75-58"><a id="__codelineno-75-58" name="__codelineno-75-58" href="#__codelineno-75-58"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-75-59"><a id="__codelineno-75-59" name="__codelineno-75-59" href="#__codelineno-75-59"></a>
</span><span id="__span-75-60"><a id="__codelineno-75-60" name="__codelineno-75-60" href="#__codelineno-75-60"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset2</span>
</span><span id="__span-75-61"><a id="__codelineno-75-61" name="__codelineno-75-61" href="#__codelineno-75-61"></a>                <span class="n">w1</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span>
</span><span id="__span-75-62"><a id="__codelineno-75-62" name="__codelineno-75-62" href="#__codelineno-75-62"></a>                <span class="n">w2</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">bend</span><span class="p">)</span>
</span><span id="__span-75-63"><a id="__codelineno-75-63" name="__codelineno-75-63" href="#__codelineno-75-63"></a>                <span class="n">w3</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">bend</span><span class="p">)</span>
</span><span id="__span-75-64"><a id="__codelineno-75-64" name="__codelineno-75-64" href="#__codelineno-75-64"></a>
</span><span id="__span-75-65"><a id="__codelineno-75-65" name="__codelineno-75-65" href="#__codelineno-75-65"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-75-66"><a id="__codelineno-75-66" name="__codelineno-75-66" href="#__codelineno-75-66"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-75-67"><a id="__codelineno-75-67" name="__codelineno-75-67" href="#__codelineno-75-67"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-75-68"><a id="__codelineno-75-68" name="__codelineno-75-68" href="#__codelineno-75-68"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span> <span class="c1"># tubular side face</span>
</span><span id="__span-75-69"><a id="__codelineno-75-69" name="__codelineno-75-69" href="#__codelineno-75-69"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span> <span class="c1"># tubular side face</span>
</span><span id="__span-75-70"><a id="__codelineno-75-70" name="__codelineno-75-70" href="#__codelineno-75-70"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># tubular side face</span>
</span><span id="__span-75-71"><a id="__codelineno-75-71" name="__codelineno-75-71" href="#__codelineno-75-71"></a>
</span><span id="__span-75-72"><a id="__codelineno-75-72" name="__codelineno-75-72" href="#__codelineno-75-72"></a>                <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
</span><span id="__span-75-73"><a id="__codelineno-75-73" name="__codelineno-75-73" href="#__codelineno-75-73"></a>                <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w2</span><span class="p">)</span>
</span><span id="__span-75-74"><a id="__codelineno-75-74" name="__codelineno-75-74" href="#__codelineno-75-74"></a>                <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">w3</span><span class="p">)</span>
</span><span id="__span-75-75"><a id="__codelineno-75-75" name="__codelineno-75-75" href="#__codelineno-75-75"></a>                <span class="n">mesh3</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span> <span class="c1"># offset face</span>
</span><span id="__span-75-76"><a id="__codelineno-75-76" name="__codelineno-75-76" href="#__codelineno-75-76"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-75-77"><a id="__codelineno-75-77" name="__codelineno-75-77" href="#__codelineno-75-77"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span> <span class="c1"># original face</span>
</span><span id="__span-75-78"><a id="__codelineno-75-78" name="__codelineno-75-78" href="#__codelineno-75-78"></a>
</span><span id="__span-75-79"><a id="__codelineno-75-79" name="__codelineno-75-79" href="#__codelineno-75-79"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-75-80"><a id="__codelineno-75-80" name="__codelineno-75-80" href="#__codelineno-75-80"></a>    <span class="n">mesh3</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-75-81"><a id="__codelineno-75-81" name="__codelineno-75-81" href="#__codelineno-75-81"></a>    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh2</span><span class="p">)</span> <span class="c1"># tubular side mesh</span>
</span><span id="__span-75-82"><a id="__codelineno-75-82" name="__codelineno-75-82" href="#__codelineno-75-82"></a>
</span><span id="__span-75-83"><a id="__codelineno-75-83" name="__codelineno-75-83" href="#__codelineno-75-83"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-75-84"><a id="__codelineno-75-84" name="__codelineno-75-84" href="#__codelineno-75-84"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh3</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">)</span> <span class="c1"># subdivide offset mesh</span>
</span><span id="__span-75-85"><a id="__codelineno-75-85" name="__codelineno-75-85" href="#__codelineno-75-85"></a>    <span class="k">return</span> <span class="n">mesh3</span> <span class="c1"># return offset mesh</span>
</span><span id="__span-75-86"><a id="__codelineno-75-86" name="__codelineno-75-86" href="#__codelineno-75-86"></a>
</span><span id="__span-75-87"><a id="__codelineno-75-87" name="__codelineno-75-87" href="#__codelineno-75-87"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># 0 &lt; ratio1 &lt; 1, 0 &lt; ratio2 &lt; 1 to be inside quad</span>
</span><span id="__span-75-88"><a id="__codelineno-75-88" name="__codelineno-75-88" href="#__codelineno-75-88"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v4</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span>
</span><span id="__span-75-89"><a id="__codelineno-75-89" name="__codelineno-75-89" href="#__codelineno-75-89"></a>
</span><span id="__span-75-90"><a id="__codelineno-75-90" name="__codelineno-75-90" href="#__codelineno-75-90"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># ratio1 &gt; 0, ratio2 &gt; 0, ratio1+ratio2 &lt; 1 to be inside triangle</span>
</span><span id="__span-75-91"><a id="__codelineno-75-91" name="__codelineno-75-91" href="#__codelineno-75-91"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio1</span><span class="o">+</span><span class="p">(</span><span class="n">v3</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span><span class="o">+</span><span class="n">v1</span>
</span><span id="__span-75-92"><a id="__codelineno-75-92" name="__codelineno-75-92" href="#__codelineno-75-92"></a>
</span><span id="__span-75-93"><a id="__codelineno-75-93" name="__codelineno-75-93" href="#__codelineno-75-93"></a><span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">)</span> <span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.20 Subdivision 17: Tubular Subdivision
<div class="language-PY highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), recursionProbability : float (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access), offsetDepth3 : float (Item Access), holeRatio : float (Item Access)</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">,</span> <span class="n">offset3</span><span class="p">):</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>    <span class="n">offsetVtx</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># another set of offset vertices</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>    <span class="n">offsetNml</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># another set of normals</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset1</span>
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)</span> <span class="c1"># opposite normal</span>
</span><span id="__span-76-16"><a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a>        <span class="n">vtx3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset2</span>
</span><span id="__span-76-17"><a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a>        <span class="n">offsetVtx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vtx3</span><span class="p">)</span> <span class="c1"># offset vertices</span>
</span><span id="__span-76-18"><a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a>        <span class="n">offsetNml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1"># offset normals</span>
</span><span id="__span-76-19"><a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a>
</span><span id="__span-76-20"><a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-76-21"><a id="__codelineno-76-21" name="__codelineno-76-21" href="#__codelineno-76-21"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-76-22"><a id="__codelineno-76-22" name="__codelineno-76-22" href="#__codelineno-76-22"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-76-23"><a id="__codelineno-76-23" name="__codelineno-76-23" href="#__codelineno-76-23"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-76-24"><a id="__codelineno-76-24" name="__codelineno-76-24" href="#__codelineno-76-24"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-76-25"><a id="__codelineno-76-25" name="__codelineno-76-25" href="#__codelineno-76-25"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-76-26"><a id="__codelineno-76-26" name="__codelineno-76-26" href="#__codelineno-76-26"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-76-27"><a id="__codelineno-76-27" name="__codelineno-76-27" href="#__codelineno-76-27"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-76-28"><a id="__codelineno-76-28" name="__codelineno-76-28" href="#__codelineno-76-28"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-76-29"><a id="__codelineno-76-29" name="__codelineno-76-29" href="#__codelineno-76-29"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-76-30"><a id="__codelineno-76-30" name="__codelineno-76-30" href="#__codelineno-76-30"></a>            <span class="n">ov1</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-76-31"><a id="__codelineno-76-31" name="__codelineno-76-31" href="#__codelineno-76-31"></a>            <span class="n">ov2</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-76-32"><a id="__codelineno-76-32" name="__codelineno-76-32" href="#__codelineno-76-32"></a>            <span class="n">ov3</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-76-33"><a id="__codelineno-76-33" name="__codelineno-76-33" href="#__codelineno-76-33"></a>            <span class="n">ov4</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-76-34"><a id="__codelineno-76-34" name="__codelineno-76-34" href="#__codelineno-76-34"></a>            <span class="c1"># add offset vertices to mesh</span>
</span><span id="__span-76-35"><a id="__codelineno-76-35" name="__codelineno-76-35" href="#__codelineno-76-35"></a>            <span class="n">ovidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov1</span><span class="p">)</span>
</span><span id="__span-76-36"><a id="__codelineno-76-36" name="__codelineno-76-36" href="#__codelineno-76-36"></a>            <span class="n">ovidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov2</span><span class="p">)</span>
</span><span id="__span-76-37"><a id="__codelineno-76-37" name="__codelineno-76-37" href="#__codelineno-76-37"></a>            <span class="n">ovidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov3</span><span class="p">)</span>
</span><span id="__span-76-38"><a id="__codelineno-76-38" name="__codelineno-76-38" href="#__codelineno-76-38"></a>            <span class="n">ovidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov4</span><span class="p">)</span>
</span><span id="__span-76-39"><a id="__codelineno-76-39" name="__codelineno-76-39" href="#__codelineno-76-39"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span>
</span><span id="__span-76-40"><a id="__codelineno-76-40" name="__codelineno-76-40" href="#__codelineno-76-40"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span>
</span><span id="__span-76-41"><a id="__codelineno-76-41" name="__codelineno-76-41" href="#__codelineno-76-41"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span>
</span><span id="__span-76-42"><a id="__codelineno-76-42" name="__codelineno-76-42" href="#__codelineno-76-42"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx4</span><span class="p">])</span>
</span><span id="__span-76-43"><a id="__codelineno-76-43" name="__codelineno-76-43" href="#__codelineno-76-43"></a>
</span><span id="__span-76-44"><a id="__codelineno-76-44" name="__codelineno-76-44" href="#__codelineno-76-44"></a>            <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span><span class="p">):</span>
</span><span id="__span-76-45"><a id="__codelineno-76-45" name="__codelineno-76-45" href="#__codelineno-76-45"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset3</span>
</span><span id="__span-76-46"><a id="__codelineno-76-46" name="__codelineno-76-46" href="#__codelineno-76-46"></a>                <span class="c1"># inner vertices</span>
</span><span id="__span-76-47"><a id="__codelineno-76-47" name="__codelineno-76-47" href="#__codelineno-76-47"></a>                <span class="n">v5</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-76-48"><a id="__codelineno-76-48" name="__codelineno-76-48" href="#__codelineno-76-48"></a>                <span class="n">v6</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-76-49"><a id="__codelineno-76-49" name="__codelineno-76-49" href="#__codelineno-76-49"></a>                <span class="n">v7</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-76-50"><a id="__codelineno-76-50" name="__codelineno-76-50" href="#__codelineno-76-50"></a>                <span class="n">v8</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-76-51"><a id="__codelineno-76-51" name="__codelineno-76-51" href="#__codelineno-76-51"></a>                <span class="n">vidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span>
</span><span id="__span-76-52"><a id="__codelineno-76-52" name="__codelineno-76-52" href="#__codelineno-76-52"></a>                <span class="n">vidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v6</span><span class="p">)</span>
</span><span id="__span-76-53"><a id="__codelineno-76-53" name="__codelineno-76-53" href="#__codelineno-76-53"></a>                <span class="n">vidx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v7</span><span class="p">)</span>
</span><span id="__span-76-54"><a id="__codelineno-76-54" name="__codelineno-76-54" href="#__codelineno-76-54"></a>                <span class="n">vidx8</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v8</span><span class="p">)</span>
</span><span id="__span-76-55"><a id="__codelineno-76-55" name="__codelineno-76-55" href="#__codelineno-76-55"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v8</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">))</span>
</span><span id="__span-76-56"><a id="__codelineno-76-56" name="__codelineno-76-56" href="#__codelineno-76-56"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">))</span>
</span><span id="__span-76-57"><a id="__codelineno-76-57" name="__codelineno-76-57" href="#__codelineno-76-57"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v8</span><span class="p">))</span>
</span><span id="__span-76-58"><a id="__codelineno-76-58" name="__codelineno-76-58" href="#__codelineno-76-58"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v8</span><span class="p">,</span> <span class="n">v5</span><span class="p">))</span>
</span><span id="__span-76-59"><a id="__codelineno-76-59" name="__codelineno-76-59" href="#__codelineno-76-59"></a>                <span class="c1"># offset inner vertices</span>
</span><span id="__span-76-60"><a id="__codelineno-76-60" name="__codelineno-76-60" href="#__codelineno-76-60"></a>                <span class="n">ov5</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-76-61"><a id="__codelineno-76-61" name="__codelineno-76-61" href="#__codelineno-76-61"></a>                <span class="n">ov6</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-76-62"><a id="__codelineno-76-62" name="__codelineno-76-62" href="#__codelineno-76-62"></a>                <span class="n">ov7</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-76-63"><a id="__codelineno-76-63" name="__codelineno-76-63" href="#__codelineno-76-63"></a>                <span class="n">ov8</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-76-64"><a id="__codelineno-76-64" name="__codelineno-76-64" href="#__codelineno-76-64"></a>                <span class="n">ovidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov5</span><span class="p">)</span>
</span><span id="__span-76-65"><a id="__codelineno-76-65" name="__codelineno-76-65" href="#__codelineno-76-65"></a>                <span class="n">ovidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov6</span><span class="p">)</span>
</span><span id="__span-76-66"><a id="__codelineno-76-66" name="__codelineno-76-66" href="#__codelineno-76-66"></a>                <span class="n">ovidx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov7</span><span class="p">)</span>
</span><span id="__span-76-67"><a id="__codelineno-76-67" name="__codelineno-76-67" href="#__codelineno-76-67"></a>                <span class="n">ovidx8</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov8</span><span class="p">)</span>
</span><span id="__span-76-68"><a id="__codelineno-76-68" name="__codelineno-76-68" href="#__codelineno-76-68"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov8</span><span class="p">,</span> <span class="n">ov5</span><span class="p">,</span> <span class="n">ov6</span><span class="p">))</span>
</span><span id="__span-76-69"><a id="__codelineno-76-69" name="__codelineno-76-69" href="#__codelineno-76-69"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov5</span><span class="p">,</span> <span class="n">ov6</span><span class="p">,</span> <span class="n">ov7</span><span class="p">))</span>
</span><span id="__span-76-70"><a id="__codelineno-76-70" name="__codelineno-76-70" href="#__codelineno-76-70"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov6</span><span class="p">,</span> <span class="n">ov7</span><span class="p">,</span> <span class="n">ov8</span><span class="p">))</span>
</span><span id="__span-76-71"><a id="__codelineno-76-71" name="__codelineno-76-71" href="#__codelineno-76-71"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov7</span><span class="p">,</span> <span class="n">ov8</span><span class="p">,</span> <span class="n">ov5</span><span class="p">))</span>
</span><span id="__span-76-72"><a id="__codelineno-76-72" name="__codelineno-76-72" href="#__codelineno-76-72"></a>                <span class="c1"># frame faces</span>
</span><span id="__span-76-73"><a id="__codelineno-76-73" name="__codelineno-76-73" href="#__codelineno-76-73"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx6</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-76-74"><a id="__codelineno-76-74" name="__codelineno-76-74" href="#__codelineno-76-74"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx7</span><span class="p">,</span><span class="n">vidx6</span><span class="p">)</span>
</span><span id="__span-76-75"><a id="__codelineno-76-75" name="__codelineno-76-75" href="#__codelineno-76-75"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx8</span><span class="p">,</span><span class="n">vidx7</span><span class="p">)</span>
</span><span id="__span-76-76"><a id="__codelineno-76-76" name="__codelineno-76-76" href="#__codelineno-76-76"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx5</span><span class="p">,</span><span class="n">vidx8</span><span class="p">)</span>
</span><span id="__span-76-77"><a id="__codelineno-76-77" name="__codelineno-76-77" href="#__codelineno-76-77"></a>                <span class="c1"># offset frame faces</span>
</span><span id="__span-76-78"><a id="__codelineno-76-78" name="__codelineno-76-78" href="#__codelineno-76-78"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx1</span><span class="p">,</span><span class="n">ovidx2</span><span class="p">,</span><span class="n">ovidx6</span><span class="p">,</span><span class="n">ovidx5</span><span class="p">)</span>
</span><span id="__span-76-79"><a id="__codelineno-76-79" name="__codelineno-76-79" href="#__codelineno-76-79"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx2</span><span class="p">,</span><span class="n">ovidx3</span><span class="p">,</span><span class="n">ovidx7</span><span class="p">,</span><span class="n">ovidx6</span><span class="p">)</span>
</span><span id="__span-76-80"><a id="__codelineno-76-80" name="__codelineno-76-80" href="#__codelineno-76-80"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx3</span><span class="p">,</span><span class="n">ovidx4</span><span class="p">,</span><span class="n">ovidx8</span><span class="p">,</span><span class="n">ovidx7</span><span class="p">)</span>
</span><span id="__span-76-81"><a id="__codelineno-76-81" name="__codelineno-76-81" href="#__codelineno-76-81"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx4</span><span class="p">,</span><span class="n">ovidx1</span><span class="p">,</span><span class="n">ovidx5</span><span class="p">,</span><span class="n">ovidx8</span><span class="p">)</span>
</span><span id="__span-76-82"><a id="__codelineno-76-82" name="__codelineno-76-82" href="#__codelineno-76-82"></a>                <span class="c1"># tubular faces</span>
</span><span id="__span-76-83"><a id="__codelineno-76-83" name="__codelineno-76-83" href="#__codelineno-76-83"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx5</span><span class="p">,</span> <span class="n">vidx6</span><span class="p">,</span> <span class="n">ovidx6</span><span class="p">,</span> <span class="n">ovidx5</span><span class="p">)</span>
</span><span id="__span-76-84"><a id="__codelineno-76-84" name="__codelineno-76-84" href="#__codelineno-76-84"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx6</span><span class="p">,</span> <span class="n">vidx7</span><span class="p">,</span> <span class="n">ovidx7</span><span class="p">,</span> <span class="n">ovidx6</span><span class="p">)</span>
</span><span id="__span-76-85"><a id="__codelineno-76-85" name="__codelineno-76-85" href="#__codelineno-76-85"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx7</span><span class="p">,</span> <span class="n">vidx8</span><span class="p">,</span> <span class="n">ovidx8</span><span class="p">,</span> <span class="n">ovidx7</span><span class="p">)</span>
</span><span id="__span-76-86"><a id="__codelineno-76-86" name="__codelineno-76-86" href="#__codelineno-76-86"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx8</span><span class="p">,</span> <span class="n">vidx5</span><span class="p">,</span> <span class="n">ovidx5</span><span class="p">,</span> <span class="n">ovidx8</span><span class="p">)</span>
</span><span id="__span-76-87"><a id="__codelineno-76-87" name="__codelineno-76-87" href="#__codelineno-76-87"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-76-88"><a id="__codelineno-76-88" name="__codelineno-76-88" href="#__codelineno-76-88"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-76-89"><a id="__codelineno-76-89" name="__codelineno-76-89" href="#__codelineno-76-89"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx1</span><span class="p">,</span><span class="n">ovidx2</span><span class="p">,</span><span class="n">ovidx3</span><span class="p">,</span><span class="n">ovidx4</span><span class="p">)</span>
</span><span id="__span-76-90"><a id="__codelineno-76-90" name="__codelineno-76-90" href="#__codelineno-76-90"></a>
</span><span id="__span-76-91"><a id="__codelineno-76-91" name="__codelineno-76-91" href="#__codelineno-76-91"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-76-92"><a id="__codelineno-76-92" name="__codelineno-76-92" href="#__codelineno-76-92"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-76-93"><a id="__codelineno-76-93" name="__codelineno-76-93" href="#__codelineno-76-93"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-76-94"><a id="__codelineno-76-94" name="__codelineno-76-94" href="#__codelineno-76-94"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-76-95"><a id="__codelineno-76-95" name="__codelineno-76-95" href="#__codelineno-76-95"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-76-96"><a id="__codelineno-76-96" name="__codelineno-76-96" href="#__codelineno-76-96"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-76-97"><a id="__codelineno-76-97" name="__codelineno-76-97" href="#__codelineno-76-97"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-76-98"><a id="__codelineno-76-98" name="__codelineno-76-98" href="#__codelineno-76-98"></a>            <span class="n">ov1</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-76-99"><a id="__codelineno-76-99" name="__codelineno-76-99" href="#__codelineno-76-99"></a>            <span class="n">ov2</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-76-100"><a id="__codelineno-76-100" name="__codelineno-76-100" href="#__codelineno-76-100"></a>            <span class="n">ov3</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-76-101"><a id="__codelineno-76-101" name="__codelineno-76-101" href="#__codelineno-76-101"></a>            <span class="c1"># add offset vertices to mesh</span>
</span><span id="__span-76-102"><a id="__codelineno-76-102" name="__codelineno-76-102" href="#__codelineno-76-102"></a>            <span class="n">ovidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov1</span><span class="p">)</span>
</span><span id="__span-76-103"><a id="__codelineno-76-103" name="__codelineno-76-103" href="#__codelineno-76-103"></a>            <span class="n">ovidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov2</span><span class="p">)</span>
</span><span id="__span-76-104"><a id="__codelineno-76-104" name="__codelineno-76-104" href="#__codelineno-76-104"></a>            <span class="n">ovidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov3</span><span class="p">)</span>
</span><span id="__span-76-105"><a id="__codelineno-76-105" name="__codelineno-76-105" href="#__codelineno-76-105"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span>
</span><span id="__span-76-106"><a id="__codelineno-76-106" name="__codelineno-76-106" href="#__codelineno-76-106"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span>
</span><span id="__span-76-107"><a id="__codelineno-76-107" name="__codelineno-76-107" href="#__codelineno-76-107"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span>
</span><span id="__span-76-108"><a id="__codelineno-76-108" name="__codelineno-76-108" href="#__codelineno-76-108"></a>
</span><span id="__span-76-109"><a id="__codelineno-76-109" name="__codelineno-76-109" href="#__codelineno-76-109"></a>            <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span><span class="p">):</span>
</span><span id="__span-76-110"><a id="__codelineno-76-110" name="__codelineno-76-110" href="#__codelineno-76-110"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset3</span>
</span><span id="__span-76-111"><a id="__codelineno-76-111" name="__codelineno-76-111" href="#__codelineno-76-111"></a>                <span class="c1"># inner vertices</span>
</span><span id="__span-76-112"><a id="__codelineno-76-112" name="__codelineno-76-112" href="#__codelineno-76-112"></a>                <span class="n">v5</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-76-113"><a id="__codelineno-76-113" name="__codelineno-76-113" href="#__codelineno-76-113"></a>                <span class="n">v6</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-76-114"><a id="__codelineno-76-114" name="__codelineno-76-114" href="#__codelineno-76-114"></a>                <span class="n">v7</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-76-115"><a id="__codelineno-76-115" name="__codelineno-76-115" href="#__codelineno-76-115"></a>                <span class="n">vidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span>
</span><span id="__span-76-116"><a id="__codelineno-76-116" name="__codelineno-76-116" href="#__codelineno-76-116"></a>                <span class="n">vidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v6</span><span class="p">)</span>
</span><span id="__span-76-117"><a id="__codelineno-76-117" name="__codelineno-76-117" href="#__codelineno-76-117"></a>                <span class="n">vidx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v7</span><span class="p">)</span>
</span><span id="__span-76-118"><a id="__codelineno-76-118" name="__codelineno-76-118" href="#__codelineno-76-118"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">))</span>
</span><span id="__span-76-119"><a id="__codelineno-76-119" name="__codelineno-76-119" href="#__codelineno-76-119"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">))</span>
</span><span id="__span-76-120"><a id="__codelineno-76-120" name="__codelineno-76-120" href="#__codelineno-76-120"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v5</span><span class="p">))</span>
</span><span id="__span-76-121"><a id="__codelineno-76-121" name="__codelineno-76-121" href="#__codelineno-76-121"></a>                <span class="c1"># offset inner vertices</span>
</span><span id="__span-76-122"><a id="__codelineno-76-122" name="__codelineno-76-122" href="#__codelineno-76-122"></a>                <span class="n">ov5</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-76-123"><a id="__codelineno-76-123" name="__codelineno-76-123" href="#__codelineno-76-123"></a>                <span class="n">ov6</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-76-124"><a id="__codelineno-76-124" name="__codelineno-76-124" href="#__codelineno-76-124"></a>                <span class="n">ov7</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-76-125"><a id="__codelineno-76-125" name="__codelineno-76-125" href="#__codelineno-76-125"></a>                <span class="n">ovidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov5</span><span class="p">)</span>
</span><span id="__span-76-126"><a id="__codelineno-76-126" name="__codelineno-76-126" href="#__codelineno-76-126"></a>                <span class="n">ovidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov6</span><span class="p">)</span>
</span><span id="__span-76-127"><a id="__codelineno-76-127" name="__codelineno-76-127" href="#__codelineno-76-127"></a>                <span class="n">ovidx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov7</span><span class="p">)</span>
</span><span id="__span-76-128"><a id="__codelineno-76-128" name="__codelineno-76-128" href="#__codelineno-76-128"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov7</span><span class="p">,</span> <span class="n">ov5</span><span class="p">,</span> <span class="n">ov6</span><span class="p">))</span>
</span><span id="__span-76-129"><a id="__codelineno-76-129" name="__codelineno-76-129" href="#__codelineno-76-129"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov5</span><span class="p">,</span> <span class="n">ov6</span><span class="p">,</span> <span class="n">ov7</span><span class="p">))</span>
</span><span id="__span-76-130"><a id="__codelineno-76-130" name="__codelineno-76-130" href="#__codelineno-76-130"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov6</span><span class="p">,</span> <span class="n">ov7</span><span class="p">,</span> <span class="n">ov5</span><span class="p">))</span>
</span><span id="__span-76-131"><a id="__codelineno-76-131" name="__codelineno-76-131" href="#__codelineno-76-131"></a>                <span class="c1"># frame faces</span>
</span><span id="__span-76-132"><a id="__codelineno-76-132" name="__codelineno-76-132" href="#__codelineno-76-132"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx6</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-76-133"><a id="__codelineno-76-133" name="__codelineno-76-133" href="#__codelineno-76-133"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx7</span><span class="p">,</span><span class="n">vidx6</span><span class="p">)</span>
</span><span id="__span-76-134"><a id="__codelineno-76-134" name="__codelineno-76-134" href="#__codelineno-76-134"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx5</span><span class="p">,</span><span class="n">vidx7</span><span class="p">)</span>
</span><span id="__span-76-135"><a id="__codelineno-76-135" name="__codelineno-76-135" href="#__codelineno-76-135"></a>                <span class="c1"># offset frame faces</span>
</span><span id="__span-76-136"><a id="__codelineno-76-136" name="__codelineno-76-136" href="#__codelineno-76-136"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx1</span><span class="p">,</span><span class="n">ovidx2</span><span class="p">,</span><span class="n">ovidx6</span><span class="p">,</span><span class="n">ovidx5</span><span class="p">)</span>
</span><span id="__span-76-137"><a id="__codelineno-76-137" name="__codelineno-76-137" href="#__codelineno-76-137"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx2</span><span class="p">,</span><span class="n">ovidx3</span><span class="p">,</span><span class="n">ovidx7</span><span class="p">,</span><span class="n">ovidx6</span><span class="p">)</span>
</span><span id="__span-76-138"><a id="__codelineno-76-138" name="__codelineno-76-138" href="#__codelineno-76-138"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx3</span><span class="p">,</span><span class="n">ovidx1</span><span class="p">,</span><span class="n">ovidx5</span><span class="p">,</span><span class="n">ovidx7</span><span class="p">)</span>
</span><span id="__span-76-139"><a id="__codelineno-76-139" name="__codelineno-76-139" href="#__codelineno-76-139"></a>                <span class="c1"># tubular faces</span>
</span><span id="__span-76-140"><a id="__codelineno-76-140" name="__codelineno-76-140" href="#__codelineno-76-140"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx5</span><span class="p">,</span> <span class="n">vidx6</span><span class="p">,</span> <span class="n">ovidx6</span><span class="p">,</span> <span class="n">ovidx5</span><span class="p">)</span>
</span><span id="__span-76-141"><a id="__codelineno-76-141" name="__codelineno-76-141" href="#__codelineno-76-141"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx6</span><span class="p">,</span> <span class="n">vidx7</span><span class="p">,</span> <span class="n">ovidx7</span><span class="p">,</span> <span class="n">ovidx6</span><span class="p">)</span>
</span><span id="__span-76-142"><a id="__codelineno-76-142" name="__codelineno-76-142" href="#__codelineno-76-142"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx7</span><span class="p">,</span> <span class="n">vidx5</span><span class="p">,</span> <span class="n">ovidx5</span><span class="p">,</span> <span class="n">ovidx7</span><span class="p">)</span>
</span><span id="__span-76-143"><a id="__codelineno-76-143" name="__codelineno-76-143" href="#__codelineno-76-143"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-76-144"><a id="__codelineno-76-144" name="__codelineno-76-144" href="#__codelineno-76-144"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-76-145"><a id="__codelineno-76-145" name="__codelineno-76-145" href="#__codelineno-76-145"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx1</span><span class="p">,</span><span class="n">ovidx2</span><span class="p">,</span><span class="n">ovidx3</span><span class="p">)</span>
</span><span id="__span-76-146"><a id="__codelineno-76-146" name="__codelineno-76-146" href="#__codelineno-76-146"></a>
</span><span id="__span-76-147"><a id="__codelineno-76-147" name="__codelineno-76-147" href="#__codelineno-76-147"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># weld vertices</span>
</span><span id="__span-76-148"><a id="__codelineno-76-148" name="__codelineno-76-148" href="#__codelineno-76-148"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-76-149"><a id="__codelineno-76-149" name="__codelineno-76-149" href="#__codelineno-76-149"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset3</span><span class="p">)</span>
</span><span id="__span-76-150"><a id="__codelineno-76-150" name="__codelineno-76-150" href="#__codelineno-76-150"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">UnifyNormals</span><span class="p">()</span>
</span><span id="__span-76-151"><a id="__codelineno-76-151" name="__codelineno-76-151" href="#__codelineno-76-151"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-76-152"><a id="__codelineno-76-152" name="__codelineno-76-152" href="#__codelineno-76-152"></a>
</span><span id="__span-76-153"><a id="__codelineno-76-153" name="__codelineno-76-153" href="#__codelineno-76-153"></a><span class="k">def</span><span class="w"> </span><span class="nf">calcNormal</span><span class="p">(</span><span class="n">faceNml</span><span class="p">,</span> <span class="n">vtx1</span><span class="p">,</span> <span class="n">vtx2</span><span class="p">,</span> <span class="n">vtx3</span><span class="p">):</span>
</span><span id="__span-76-154"><a id="__codelineno-76-154" name="__codelineno-76-154" href="#__codelineno-76-154"></a>    <span class="n">vec1</span> <span class="o">=</span> <span class="n">vtx1</span> <span class="o">-</span> <span class="n">vtx2</span>
</span><span id="__span-76-155"><a id="__codelineno-76-155" name="__codelineno-76-155" href="#__codelineno-76-155"></a>    <span class="n">vec2</span> <span class="o">=</span> <span class="n">vtx3</span> <span class="o">-</span> <span class="n">vtx2</span>
</span><span id="__span-76-156"><a id="__codelineno-76-156" name="__codelineno-76-156" href="#__codelineno-76-156"></a>    <span class="n">vec1</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-76-157"><a id="__codelineno-76-157" name="__codelineno-76-157" href="#__codelineno-76-157"></a>    <span class="n">vec2</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-76-158"><a id="__codelineno-76-158" name="__codelineno-76-158" href="#__codelineno-76-158"></a>    <span class="n">faceNml</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-76-159"><a id="__codelineno-76-159" name="__codelineno-76-159" href="#__codelineno-76-159"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">vec1</span><span class="o">+</span><span class="n">vec2</span><span class="o">+</span><span class="n">faceNml</span>
</span><span id="__span-76-160"><a id="__codelineno-76-160" name="__codelineno-76-160" href="#__codelineno-76-160"></a>    <span class="n">n</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-76-161"><a id="__codelineno-76-161" name="__codelineno-76-161" href="#__codelineno-76-161"></a>    <span class="k">return</span> <span class="n">n</span>
</span><span id="__span-76-162"><a id="__codelineno-76-162" name="__codelineno-76-162" href="#__codelineno-76-162"></a>
</span><span id="__span-76-163"><a id="__codelineno-76-163" name="__codelineno-76-163" href="#__codelineno-76-163"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># 0 &lt; ratio1 &lt; 1, 0 &lt; ratio2 &lt; 1 to be inside quad</span>
</span><span id="__span-76-164"><a id="__codelineno-76-164" name="__codelineno-76-164" href="#__codelineno-76-164"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v4</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span>
</span><span id="__span-76-165"><a id="__codelineno-76-165" name="__codelineno-76-165" href="#__codelineno-76-165"></a>
</span><span id="__span-76-166"><a id="__codelineno-76-166" name="__codelineno-76-166" href="#__codelineno-76-166"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># ratio1 &gt; 0, ratio2 &gt; 0, ratio1+ratio2 &lt; 1 to be inside triangle</span>
</span><span id="__span-76-167"><a id="__codelineno-76-167" name="__codelineno-76-167" href="#__codelineno-76-167"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio1</span><span class="o">+</span><span class="p">(</span><span class="n">v3</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span><span class="o">+</span><span class="n">v1</span>
</span><span id="__span-76-168"><a id="__codelineno-76-168" name="__codelineno-76-168" href="#__codelineno-76-168"></a>
</span><span id="__span-76-169"><a id="__codelineno-76-169" name="__codelineno-76-169" href="#__codelineno-76-169"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">,</span> <span class="n">offsetDepth3</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="721-subdivision-18-tubular-subdivision-with-tab-faces">7.21 Subdivision 18: Tubular Subdivision with Tab Faces</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), recursionProbability : float (Item Access), offsetDepth1 : float (Item Access), offsetDepth2 : float (Item Access), offsetDepth3 : float (Item Access), holeRatio : float (Item Access)</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">,</span> <span class="n">offset3</span><span class="p">):</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a>    <span class="n">offsetVtx</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># another set of offset vertices</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>    <span class="n">offsetNml</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># another set of normals</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vtx</span><span class="p">)):</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a>        <span class="n">vtx2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset1</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx2</span><span class="p">)</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)</span> <span class="c1"># opposite normal</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a>        <span class="n">vtx3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset2</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a>        <span class="n">offsetVtx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vtx3</span><span class="p">)</span> <span class="c1"># offset vertices</span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a>        <span class="n">offsetNml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1"># offset normals</span>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a>
</span><span id="__span-77-20"><a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-77-21"><a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-77-22"><a id="__codelineno-77-22" name="__codelineno-77-22" href="#__codelineno-77-22"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-77-23"><a id="__codelineno-77-23" name="__codelineno-77-23" href="#__codelineno-77-23"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-77-24"><a id="__codelineno-77-24" name="__codelineno-77-24" href="#__codelineno-77-24"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-77-25"><a id="__codelineno-77-25" name="__codelineno-77-25" href="#__codelineno-77-25"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-77-26"><a id="__codelineno-77-26" name="__codelineno-77-26" href="#__codelineno-77-26"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-77-27"><a id="__codelineno-77-27" name="__codelineno-77-27" href="#__codelineno-77-27"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-77-28"><a id="__codelineno-77-28" name="__codelineno-77-28" href="#__codelineno-77-28"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-77-29"><a id="__codelineno-77-29" name="__codelineno-77-29" href="#__codelineno-77-29"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-77-30"><a id="__codelineno-77-30" name="__codelineno-77-30" href="#__codelineno-77-30"></a>            <span class="n">ov1</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-77-31"><a id="__codelineno-77-31" name="__codelineno-77-31" href="#__codelineno-77-31"></a>            <span class="n">ov2</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-77-32"><a id="__codelineno-77-32" name="__codelineno-77-32" href="#__codelineno-77-32"></a>            <span class="n">ov3</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-77-33"><a id="__codelineno-77-33" name="__codelineno-77-33" href="#__codelineno-77-33"></a>            <span class="n">ov4</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-77-34"><a id="__codelineno-77-34" name="__codelineno-77-34" href="#__codelineno-77-34"></a>            <span class="c1"># add offset vertices to mesh</span>
</span><span id="__span-77-35"><a id="__codelineno-77-35" name="__codelineno-77-35" href="#__codelineno-77-35"></a>            <span class="n">ovidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov1</span><span class="p">)</span>
</span><span id="__span-77-36"><a id="__codelineno-77-36" name="__codelineno-77-36" href="#__codelineno-77-36"></a>            <span class="n">ovidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov2</span><span class="p">)</span>
</span><span id="__span-77-37"><a id="__codelineno-77-37" name="__codelineno-77-37" href="#__codelineno-77-37"></a>            <span class="n">ovidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov3</span><span class="p">)</span>
</span><span id="__span-77-38"><a id="__codelineno-77-38" name="__codelineno-77-38" href="#__codelineno-77-38"></a>            <span class="n">ovidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov4</span><span class="p">)</span>
</span><span id="__span-77-39"><a id="__codelineno-77-39" name="__codelineno-77-39" href="#__codelineno-77-39"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span>
</span><span id="__span-77-40"><a id="__codelineno-77-40" name="__codelineno-77-40" href="#__codelineno-77-40"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span>
</span><span id="__span-77-41"><a id="__codelineno-77-41" name="__codelineno-77-41" href="#__codelineno-77-41"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span>
</span><span id="__span-77-42"><a id="__codelineno-77-42" name="__codelineno-77-42" href="#__codelineno-77-42"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx4</span><span class="p">])</span>
</span><span id="__span-77-43"><a id="__codelineno-77-43" name="__codelineno-77-43" href="#__codelineno-77-43"></a>
</span><span id="__span-77-44"><a id="__codelineno-77-44" name="__codelineno-77-44" href="#__codelineno-77-44"></a>            <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span><span class="p">):</span>
</span><span id="__span-77-45"><a id="__codelineno-77-45" name="__codelineno-77-45" href="#__codelineno-77-45"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset3</span>
</span><span id="__span-77-46"><a id="__codelineno-77-46" name="__codelineno-77-46" href="#__codelineno-77-46"></a>                <span class="c1"># inner vertices</span>
</span><span id="__span-77-47"><a id="__codelineno-77-47" name="__codelineno-77-47" href="#__codelineno-77-47"></a>                <span class="n">v5</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-48"><a id="__codelineno-77-48" name="__codelineno-77-48" href="#__codelineno-77-48"></a>                <span class="n">v6</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-49"><a id="__codelineno-77-49" name="__codelineno-77-49" href="#__codelineno-77-49"></a>                <span class="n">v7</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-50"><a id="__codelineno-77-50" name="__codelineno-77-50" href="#__codelineno-77-50"></a>                <span class="n">v8</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-51"><a id="__codelineno-77-51" name="__codelineno-77-51" href="#__codelineno-77-51"></a>                <span class="n">vidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span>
</span><span id="__span-77-52"><a id="__codelineno-77-52" name="__codelineno-77-52" href="#__codelineno-77-52"></a>                <span class="n">vidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v6</span><span class="p">)</span>
</span><span id="__span-77-53"><a id="__codelineno-77-53" name="__codelineno-77-53" href="#__codelineno-77-53"></a>                <span class="n">vidx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v7</span><span class="p">)</span>
</span><span id="__span-77-54"><a id="__codelineno-77-54" name="__codelineno-77-54" href="#__codelineno-77-54"></a>                <span class="n">vidx8</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v8</span><span class="p">)</span>
</span><span id="__span-77-55"><a id="__codelineno-77-55" name="__codelineno-77-55" href="#__codelineno-77-55"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v8</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">))</span>
</span><span id="__span-77-56"><a id="__codelineno-77-56" name="__codelineno-77-56" href="#__codelineno-77-56"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">))</span>
</span><span id="__span-77-57"><a id="__codelineno-77-57" name="__codelineno-77-57" href="#__codelineno-77-57"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v8</span><span class="p">))</span>
</span><span id="__span-77-58"><a id="__codelineno-77-58" name="__codelineno-77-58" href="#__codelineno-77-58"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v8</span><span class="p">,</span> <span class="n">v5</span><span class="p">))</span>
</span><span id="__span-77-59"><a id="__codelineno-77-59" name="__codelineno-77-59" href="#__codelineno-77-59"></a>                <span class="c1"># offset inner vertices</span>
</span><span id="__span-77-60"><a id="__codelineno-77-60" name="__codelineno-77-60" href="#__codelineno-77-60"></a>                <span class="n">ov5</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-61"><a id="__codelineno-77-61" name="__codelineno-77-61" href="#__codelineno-77-61"></a>                <span class="n">ov6</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-62"><a id="__codelineno-77-62" name="__codelineno-77-62" href="#__codelineno-77-62"></a>                <span class="n">ov7</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-63"><a id="__codelineno-77-63" name="__codelineno-77-63" href="#__codelineno-77-63"></a>                <span class="n">ov8</span> <span class="o">=</span> <span class="n">interpolateQuad</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-64"><a id="__codelineno-77-64" name="__codelineno-77-64" href="#__codelineno-77-64"></a>                <span class="c1"># offset tab vertices</span>
</span><span id="__span-77-65"><a id="__codelineno-77-65" name="__codelineno-77-65" href="#__codelineno-77-65"></a>                <span class="n">ov9</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-66"><a id="__codelineno-77-66" name="__codelineno-77-66" href="#__codelineno-77-66"></a>                <span class="n">ov10</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov1</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-67"><a id="__codelineno-77-67" name="__codelineno-77-67" href="#__codelineno-77-67"></a>                <span class="n">ov11</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-68"><a id="__codelineno-77-68" name="__codelineno-77-68" href="#__codelineno-77-68"></a>                <span class="n">ov12</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-69"><a id="__codelineno-77-69" name="__codelineno-77-69" href="#__codelineno-77-69"></a>                <span class="n">ov13</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-70"><a id="__codelineno-77-70" name="__codelineno-77-70" href="#__codelineno-77-70"></a>                <span class="n">ov14</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov4</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-71"><a id="__codelineno-77-71" name="__codelineno-77-71" href="#__codelineno-77-71"></a>                <span class="n">ov15</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov4</span><span class="p">,</span><span class="n">ov1</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-72"><a id="__codelineno-77-72" name="__codelineno-77-72" href="#__codelineno-77-72"></a>                <span class="n">ov16</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov4</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-73"><a id="__codelineno-77-73" name="__codelineno-77-73" href="#__codelineno-77-73"></a>                <span class="c1"># add offset vertices and normals</span>
</span><span id="__span-77-74"><a id="__codelineno-77-74" name="__codelineno-77-74" href="#__codelineno-77-74"></a>                <span class="n">ovidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov5</span><span class="p">)</span>
</span><span id="__span-77-75"><a id="__codelineno-77-75" name="__codelineno-77-75" href="#__codelineno-77-75"></a>                <span class="n">ovidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov6</span><span class="p">)</span>
</span><span id="__span-77-76"><a id="__codelineno-77-76" name="__codelineno-77-76" href="#__codelineno-77-76"></a>                <span class="n">ovidx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov7</span><span class="p">)</span>
</span><span id="__span-77-77"><a id="__codelineno-77-77" name="__codelineno-77-77" href="#__codelineno-77-77"></a>                <span class="n">ovidx8</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov8</span><span class="p">)</span>
</span><span id="__span-77-78"><a id="__codelineno-77-78" name="__codelineno-77-78" href="#__codelineno-77-78"></a>                <span class="n">ovidx9</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov9</span><span class="p">)</span>
</span><span id="__span-77-79"><a id="__codelineno-77-79" name="__codelineno-77-79" href="#__codelineno-77-79"></a>                <span class="n">ovidx10</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov10</span><span class="p">)</span>
</span><span id="__span-77-80"><a id="__codelineno-77-80" name="__codelineno-77-80" href="#__codelineno-77-80"></a>                <span class="n">ovidx11</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov11</span><span class="p">)</span>
</span><span id="__span-77-81"><a id="__codelineno-77-81" name="__codelineno-77-81" href="#__codelineno-77-81"></a>                <span class="n">ovidx12</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov12</span><span class="p">)</span>
</span><span id="__span-77-82"><a id="__codelineno-77-82" name="__codelineno-77-82" href="#__codelineno-77-82"></a>                <span class="n">ovidx13</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov13</span><span class="p">)</span>
</span><span id="__span-77-83"><a id="__codelineno-77-83" name="__codelineno-77-83" href="#__codelineno-77-83"></a>                <span class="n">ovidx14</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov14</span><span class="p">)</span>
</span><span id="__span-77-84"><a id="__codelineno-77-84" name="__codelineno-77-84" href="#__codelineno-77-84"></a>                <span class="n">ovidx15</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov15</span><span class="p">)</span>
</span><span id="__span-77-85"><a id="__codelineno-77-85" name="__codelineno-77-85" href="#__codelineno-77-85"></a>                <span class="n">ovidx16</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov16</span><span class="p">)</span>
</span><span id="__span-77-86"><a id="__codelineno-77-86" name="__codelineno-77-86" href="#__codelineno-77-86"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov8</span><span class="p">,</span> <span class="n">ov5</span><span class="p">,</span> <span class="n">ov6</span><span class="p">))</span>
</span><span id="__span-77-87"><a id="__codelineno-77-87" name="__codelineno-77-87" href="#__codelineno-77-87"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov5</span><span class="p">,</span> <span class="n">ov6</span><span class="p">,</span> <span class="n">ov7</span><span class="p">))</span>
</span><span id="__span-77-88"><a id="__codelineno-77-88" name="__codelineno-77-88" href="#__codelineno-77-88"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov6</span><span class="p">,</span> <span class="n">ov7</span><span class="p">,</span> <span class="n">ov8</span><span class="p">))</span>
</span><span id="__span-77-89"><a id="__codelineno-77-89" name="__codelineno-77-89" href="#__codelineno-77-89"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov7</span><span class="p">,</span> <span class="n">ov8</span><span class="p">,</span> <span class="n">ov5</span><span class="p">))</span>
</span><span id="__span-77-90"><a id="__codelineno-77-90" name="__codelineno-77-90" href="#__codelineno-77-90"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span>
</span><span id="__span-77-91"><a id="__codelineno-77-91" name="__codelineno-77-91" href="#__codelineno-77-91"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span>
</span><span id="__span-77-92"><a id="__codelineno-77-92" name="__codelineno-77-92" href="#__codelineno-77-92"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span>
</span><span id="__span-77-93"><a id="__codelineno-77-93" name="__codelineno-77-93" href="#__codelineno-77-93"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span>
</span><span id="__span-77-94"><a id="__codelineno-77-94" name="__codelineno-77-94" href="#__codelineno-77-94"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span>
</span><span id="__span-77-95"><a id="__codelineno-77-95" name="__codelineno-77-95" href="#__codelineno-77-95"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx4</span><span class="p">])</span>
</span><span id="__span-77-96"><a id="__codelineno-77-96" name="__codelineno-77-96" href="#__codelineno-77-96"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx4</span><span class="p">])</span>
</span><span id="__span-77-97"><a id="__codelineno-77-97" name="__codelineno-77-97" href="#__codelineno-77-97"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span>
</span><span id="__span-77-98"><a id="__codelineno-77-98" name="__codelineno-77-98" href="#__codelineno-77-98"></a>                <span class="c1"># frame faces</span>
</span><span id="__span-77-99"><a id="__codelineno-77-99" name="__codelineno-77-99" href="#__codelineno-77-99"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx6</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-77-100"><a id="__codelineno-77-100" name="__codelineno-77-100" href="#__codelineno-77-100"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx7</span><span class="p">,</span><span class="n">vidx6</span><span class="p">)</span>
</span><span id="__span-77-101"><a id="__codelineno-77-101" name="__codelineno-77-101" href="#__codelineno-77-101"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx8</span><span class="p">,</span><span class="n">vidx7</span><span class="p">)</span>
</span><span id="__span-77-102"><a id="__codelineno-77-102" name="__codelineno-77-102" href="#__codelineno-77-102"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx5</span><span class="p">,</span><span class="n">vidx8</span><span class="p">)</span>
</span><span id="__span-77-103"><a id="__codelineno-77-103" name="__codelineno-77-103" href="#__codelineno-77-103"></a>                <span class="c1"># offset tab faces</span>
</span><span id="__span-77-104"><a id="__codelineno-77-104" name="__codelineno-77-104" href="#__codelineno-77-104"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx9</span><span class="p">,</span><span class="n">ovidx10</span><span class="p">,</span><span class="n">ovidx6</span><span class="p">,</span><span class="n">ovidx5</span><span class="p">)</span>
</span><span id="__span-77-105"><a id="__codelineno-77-105" name="__codelineno-77-105" href="#__codelineno-77-105"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx11</span><span class="p">,</span><span class="n">ovidx12</span><span class="p">,</span><span class="n">ovidx7</span><span class="p">,</span><span class="n">ovidx6</span><span class="p">)</span>
</span><span id="__span-77-106"><a id="__codelineno-77-106" name="__codelineno-77-106" href="#__codelineno-77-106"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx13</span><span class="p">,</span><span class="n">ovidx14</span><span class="p">,</span><span class="n">ovidx8</span><span class="p">,</span><span class="n">ovidx7</span><span class="p">)</span>
</span><span id="__span-77-107"><a id="__codelineno-77-107" name="__codelineno-77-107" href="#__codelineno-77-107"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx15</span><span class="p">,</span><span class="n">ovidx16</span><span class="p">,</span><span class="n">ovidx5</span><span class="p">,</span><span class="n">ovidx8</span><span class="p">)</span>
</span><span id="__span-77-108"><a id="__codelineno-77-108" name="__codelineno-77-108" href="#__codelineno-77-108"></a>                <span class="c1"># tubular faces</span>
</span><span id="__span-77-109"><a id="__codelineno-77-109" name="__codelineno-77-109" href="#__codelineno-77-109"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx5</span><span class="p">,</span> <span class="n">vidx6</span><span class="p">,</span> <span class="n">ovidx6</span><span class="p">,</span> <span class="n">ovidx5</span><span class="p">)</span>
</span><span id="__span-77-110"><a id="__codelineno-77-110" name="__codelineno-77-110" href="#__codelineno-77-110"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx6</span><span class="p">,</span> <span class="n">vidx7</span><span class="p">,</span> <span class="n">ovidx7</span><span class="p">,</span> <span class="n">ovidx6</span><span class="p">)</span>
</span><span id="__span-77-111"><a id="__codelineno-77-111" name="__codelineno-77-111" href="#__codelineno-77-111"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx7</span><span class="p">,</span> <span class="n">vidx8</span><span class="p">,</span> <span class="n">ovidx8</span><span class="p">,</span> <span class="n">ovidx7</span><span class="p">)</span>
</span><span id="__span-77-112"><a id="__codelineno-77-112" name="__codelineno-77-112" href="#__codelineno-77-112"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx8</span><span class="p">,</span> <span class="n">vidx5</span><span class="p">,</span> <span class="n">ovidx5</span><span class="p">,</span> <span class="n">ovidx8</span><span class="p">)</span>
</span><span id="__span-77-113"><a id="__codelineno-77-113" name="__codelineno-77-113" href="#__codelineno-77-113"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-77-114"><a id="__codelineno-77-114" name="__codelineno-77-114" href="#__codelineno-77-114"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-77-115"><a id="__codelineno-77-115" name="__codelineno-77-115" href="#__codelineno-77-115"></a>
</span><span id="__span-77-116"><a id="__codelineno-77-116" name="__codelineno-77-116" href="#__codelineno-77-116"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-77-117"><a id="__codelineno-77-117" name="__codelineno-77-117" href="#__codelineno-77-117"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-77-118"><a id="__codelineno-77-118" name="__codelineno-77-118" href="#__codelineno-77-118"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-77-119"><a id="__codelineno-77-119" name="__codelineno-77-119" href="#__codelineno-77-119"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-77-120"><a id="__codelineno-77-120" name="__codelineno-77-120" href="#__codelineno-77-120"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-77-121"><a id="__codelineno-77-121" name="__codelineno-77-121" href="#__codelineno-77-121"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-77-122"><a id="__codelineno-77-122" name="__codelineno-77-122" href="#__codelineno-77-122"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-77-123"><a id="__codelineno-77-123" name="__codelineno-77-123" href="#__codelineno-77-123"></a>            <span class="n">ov1</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-77-124"><a id="__codelineno-77-124" name="__codelineno-77-124" href="#__codelineno-77-124"></a>            <span class="n">ov2</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-77-125"><a id="__codelineno-77-125" name="__codelineno-77-125" href="#__codelineno-77-125"></a>            <span class="n">ov3</span> <span class="o">=</span> <span class="n">offsetVtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-77-126"><a id="__codelineno-77-126" name="__codelineno-77-126" href="#__codelineno-77-126"></a>            <span class="c1"># add offset vertices to mesh</span>
</span><span id="__span-77-127"><a id="__codelineno-77-127" name="__codelineno-77-127" href="#__codelineno-77-127"></a>            <span class="n">ovidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov1</span><span class="p">)</span>
</span><span id="__span-77-128"><a id="__codelineno-77-128" name="__codelineno-77-128" href="#__codelineno-77-128"></a>            <span class="n">ovidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov2</span><span class="p">)</span>
</span><span id="__span-77-129"><a id="__codelineno-77-129" name="__codelineno-77-129" href="#__codelineno-77-129"></a>            <span class="n">ovidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov3</span><span class="p">)</span>
</span><span id="__span-77-130"><a id="__codelineno-77-130" name="__codelineno-77-130" href="#__codelineno-77-130"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span>
</span><span id="__span-77-131"><a id="__codelineno-77-131" name="__codelineno-77-131" href="#__codelineno-77-131"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span>
</span><span id="__span-77-132"><a id="__codelineno-77-132" name="__codelineno-77-132" href="#__codelineno-77-132"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span>
</span><span id="__span-77-133"><a id="__codelineno-77-133" name="__codelineno-77-133" href="#__codelineno-77-133"></a>
</span><span id="__span-77-134"><a id="__codelineno-77-134" name="__codelineno-77-134" href="#__codelineno-77-134"></a>            <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">recursionProbability</span><span class="p">):</span>
</span><span id="__span-77-135"><a id="__codelineno-77-135" name="__codelineno-77-135" href="#__codelineno-77-135"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset3</span>
</span><span id="__span-77-136"><a id="__codelineno-77-136" name="__codelineno-77-136" href="#__codelineno-77-136"></a>                <span class="c1"># inner vertices</span>
</span><span id="__span-77-137"><a id="__codelineno-77-137" name="__codelineno-77-137" href="#__codelineno-77-137"></a>                <span class="n">v5</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-77-138"><a id="__codelineno-77-138" name="__codelineno-77-138" href="#__codelineno-77-138"></a>                <span class="n">v6</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-77-139"><a id="__codelineno-77-139" name="__codelineno-77-139" href="#__codelineno-77-139"></a>                <span class="n">v7</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-77-140"><a id="__codelineno-77-140" name="__codelineno-77-140" href="#__codelineno-77-140"></a>                <span class="n">vidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span>
</span><span id="__span-77-141"><a id="__codelineno-77-141" name="__codelineno-77-141" href="#__codelineno-77-141"></a>                <span class="n">vidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v6</span><span class="p">)</span>
</span><span id="__span-77-142"><a id="__codelineno-77-142" name="__codelineno-77-142" href="#__codelineno-77-142"></a>                <span class="n">vidx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v7</span><span class="p">)</span>
</span><span id="__span-77-143"><a id="__codelineno-77-143" name="__codelineno-77-143" href="#__codelineno-77-143"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">))</span>
</span><span id="__span-77-144"><a id="__codelineno-77-144" name="__codelineno-77-144" href="#__codelineno-77-144"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">))</span>
</span><span id="__span-77-145"><a id="__codelineno-77-145" name="__codelineno-77-145" href="#__codelineno-77-145"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v5</span><span class="p">))</span>
</span><span id="__span-77-146"><a id="__codelineno-77-146" name="__codelineno-77-146" href="#__codelineno-77-146"></a>                <span class="c1"># offset inner vertices</span>
</span><span id="__span-77-147"><a id="__codelineno-77-147" name="__codelineno-77-147" href="#__codelineno-77-147"></a>                <span class="n">ov5</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-77-148"><a id="__codelineno-77-148" name="__codelineno-77-148" href="#__codelineno-77-148"></a>                <span class="n">ov6</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-77-149"><a id="__codelineno-77-149" name="__codelineno-77-149" href="#__codelineno-77-149"></a>                <span class="n">ov7</span> <span class="o">=</span> <span class="n">interpolateTriangle</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">holeRatio</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-77-150"><a id="__codelineno-77-150" name="__codelineno-77-150" href="#__codelineno-77-150"></a>                <span class="c1"># offset tab vertices</span>
</span><span id="__span-77-151"><a id="__codelineno-77-151" name="__codelineno-77-151" href="#__codelineno-77-151"></a>                <span class="n">ov9</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-152"><a id="__codelineno-77-152" name="__codelineno-77-152" href="#__codelineno-77-152"></a>                <span class="n">ov10</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov1</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-153"><a id="__codelineno-77-153" name="__codelineno-77-153" href="#__codelineno-77-153"></a>                <span class="n">ov11</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov2</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-154"><a id="__codelineno-77-154" name="__codelineno-77-154" href="#__codelineno-77-154"></a>                <span class="n">ov12</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov2</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-155"><a id="__codelineno-77-155" name="__codelineno-77-155" href="#__codelineno-77-155"></a>                <span class="n">ov13</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov3</span><span class="p">,</span><span class="n">ov1</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-156"><a id="__codelineno-77-156" name="__codelineno-77-156" href="#__codelineno-77-156"></a>                <span class="n">ov14</span> <span class="o">=</span> <span class="n">interpolateLine</span><span class="p">(</span><span class="n">ov1</span><span class="p">,</span><span class="n">ov3</span><span class="p">,</span> <span class="n">holeRatio</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-77-157"><a id="__codelineno-77-157" name="__codelineno-77-157" href="#__codelineno-77-157"></a>                <span class="c1"># add offset vertices and normals</span>
</span><span id="__span-77-158"><a id="__codelineno-77-158" name="__codelineno-77-158" href="#__codelineno-77-158"></a>                <span class="n">ovidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov5</span><span class="p">)</span>
</span><span id="__span-77-159"><a id="__codelineno-77-159" name="__codelineno-77-159" href="#__codelineno-77-159"></a>                <span class="n">ovidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov6</span><span class="p">)</span>
</span><span id="__span-77-160"><a id="__codelineno-77-160" name="__codelineno-77-160" href="#__codelineno-77-160"></a>                <span class="n">ovidx7</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov7</span><span class="p">)</span>
</span><span id="__span-77-161"><a id="__codelineno-77-161" name="__codelineno-77-161" href="#__codelineno-77-161"></a>                <span class="n">ovidx9</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov9</span><span class="p">)</span>
</span><span id="__span-77-162"><a id="__codelineno-77-162" name="__codelineno-77-162" href="#__codelineno-77-162"></a>                <span class="n">ovidx10</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov10</span><span class="p">)</span>
</span><span id="__span-77-163"><a id="__codelineno-77-163" name="__codelineno-77-163" href="#__codelineno-77-163"></a>                <span class="n">ovidx11</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov11</span><span class="p">)</span>
</span><span id="__span-77-164"><a id="__codelineno-77-164" name="__codelineno-77-164" href="#__codelineno-77-164"></a>                <span class="n">ovidx12</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov12</span><span class="p">)</span>
</span><span id="__span-77-165"><a id="__codelineno-77-165" name="__codelineno-77-165" href="#__codelineno-77-165"></a>                <span class="n">ovidx13</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov13</span><span class="p">)</span>
</span><span id="__span-77-166"><a id="__codelineno-77-166" name="__codelineno-77-166" href="#__codelineno-77-166"></a>                <span class="n">ovidx14</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ov14</span><span class="p">)</span>
</span><span id="__span-77-167"><a id="__codelineno-77-167" name="__codelineno-77-167" href="#__codelineno-77-167"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov7</span><span class="p">,</span> <span class="n">ov5</span><span class="p">,</span> <span class="n">ov6</span><span class="p">))</span>
</span><span id="__span-77-168"><a id="__codelineno-77-168" name="__codelineno-77-168" href="#__codelineno-77-168"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov5</span><span class="p">,</span> <span class="n">ov6</span><span class="p">,</span> <span class="n">ov7</span><span class="p">))</span>
</span><span id="__span-77-169"><a id="__codelineno-77-169" name="__codelineno-77-169" href="#__codelineno-77-169"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">calcNormal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ov6</span><span class="p">,</span> <span class="n">ov7</span><span class="p">,</span> <span class="n">ov5</span><span class="p">))</span>
</span><span id="__span-77-170"><a id="__codelineno-77-170" name="__codelineno-77-170" href="#__codelineno-77-170"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span>
</span><span id="__span-77-171"><a id="__codelineno-77-171" name="__codelineno-77-171" href="#__codelineno-77-171"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span>
</span><span id="__span-77-172"><a id="__codelineno-77-172" name="__codelineno-77-172" href="#__codelineno-77-172"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span>
</span><span id="__span-77-173"><a id="__codelineno-77-173" name="__codelineno-77-173" href="#__codelineno-77-173"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span>
</span><span id="__span-77-174"><a id="__codelineno-77-174" name="__codelineno-77-174" href="#__codelineno-77-174"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span>
</span><span id="__span-77-175"><a id="__codelineno-77-175" name="__codelineno-77-175" href="#__codelineno-77-175"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">offsetNml</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span>
</span><span id="__span-77-176"><a id="__codelineno-77-176" name="__codelineno-77-176" href="#__codelineno-77-176"></a>                <span class="c1"># frame faces</span>
</span><span id="__span-77-177"><a id="__codelineno-77-177" name="__codelineno-77-177" href="#__codelineno-77-177"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx6</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-77-178"><a id="__codelineno-77-178" name="__codelineno-77-178" href="#__codelineno-77-178"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx7</span><span class="p">,</span><span class="n">vidx6</span><span class="p">)</span>
</span><span id="__span-77-179"><a id="__codelineno-77-179" name="__codelineno-77-179" href="#__codelineno-77-179"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx5</span><span class="p">,</span><span class="n">vidx7</span><span class="p">)</span>
</span><span id="__span-77-180"><a id="__codelineno-77-180" name="__codelineno-77-180" href="#__codelineno-77-180"></a>                <span class="c1"># offset tab faces</span>
</span><span id="__span-77-181"><a id="__codelineno-77-181" name="__codelineno-77-181" href="#__codelineno-77-181"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx9</span><span class="p">,</span><span class="n">ovidx10</span><span class="p">,</span><span class="n">ovidx6</span><span class="p">,</span><span class="n">ovidx5</span><span class="p">)</span>
</span><span id="__span-77-182"><a id="__codelineno-77-182" name="__codelineno-77-182" href="#__codelineno-77-182"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx11</span><span class="p">,</span><span class="n">ovidx12</span><span class="p">,</span><span class="n">ovidx7</span><span class="p">,</span><span class="n">ovidx6</span><span class="p">)</span>
</span><span id="__span-77-183"><a id="__codelineno-77-183" name="__codelineno-77-183" href="#__codelineno-77-183"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">ovidx13</span><span class="p">,</span><span class="n">ovidx14</span><span class="p">,</span><span class="n">ovidx5</span><span class="p">,</span><span class="n">ovidx7</span><span class="p">)</span>
</span><span id="__span-77-184"><a id="__codelineno-77-184" name="__codelineno-77-184" href="#__codelineno-77-184"></a>                <span class="c1"># tubular faces</span>
</span><span id="__span-77-185"><a id="__codelineno-77-185" name="__codelineno-77-185" href="#__codelineno-77-185"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx5</span><span class="p">,</span> <span class="n">vidx6</span><span class="p">,</span> <span class="n">ovidx6</span><span class="p">,</span> <span class="n">ovidx5</span><span class="p">)</span>
</span><span id="__span-77-186"><a id="__codelineno-77-186" name="__codelineno-77-186" href="#__codelineno-77-186"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx6</span><span class="p">,</span> <span class="n">vidx7</span><span class="p">,</span> <span class="n">ovidx7</span><span class="p">,</span> <span class="n">ovidx6</span><span class="p">)</span>
</span><span id="__span-77-187"><a id="__codelineno-77-187" name="__codelineno-77-187" href="#__codelineno-77-187"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx7</span><span class="p">,</span> <span class="n">vidx5</span><span class="p">,</span> <span class="n">ovidx5</span><span class="p">,</span> <span class="n">ovidx7</span><span class="p">)</span>
</span><span id="__span-77-188"><a id="__codelineno-77-188" name="__codelineno-77-188" href="#__codelineno-77-188"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-77-189"><a id="__codelineno-77-189" name="__codelineno-77-189" href="#__codelineno-77-189"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-77-190"><a id="__codelineno-77-190" name="__codelineno-77-190" href="#__codelineno-77-190"></a>
</span><span id="__span-77-191"><a id="__codelineno-77-191" name="__codelineno-77-191" href="#__codelineno-77-191"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># weld vertices</span>
</span><span id="__span-77-192"><a id="__codelineno-77-192" name="__codelineno-77-192" href="#__codelineno-77-192"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-77-193"><a id="__codelineno-77-193" name="__codelineno-77-193" href="#__codelineno-77-193"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset3</span><span class="p">)</span>
</span><span id="__span-77-194"><a id="__codelineno-77-194" name="__codelineno-77-194" href="#__codelineno-77-194"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">UnifyNormals</span><span class="p">()</span>
</span><span id="__span-77-195"><a id="__codelineno-77-195" name="__codelineno-77-195" href="#__codelineno-77-195"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-77-196"><a id="__codelineno-77-196" name="__codelineno-77-196" href="#__codelineno-77-196"></a>
</span><span id="__span-77-197"><a id="__codelineno-77-197" name="__codelineno-77-197" href="#__codelineno-77-197"></a><span class="k">def</span><span class="w"> </span><span class="nf">calcNormal</span><span class="p">(</span><span class="n">faceNml</span><span class="p">,</span> <span class="n">vtx1</span><span class="p">,</span> <span class="n">vtx2</span><span class="p">,</span> <span class="n">vtx3</span><span class="p">):</span>
</span><span id="__span-77-198"><a id="__codelineno-77-198" name="__codelineno-77-198" href="#__codelineno-77-198"></a>    <span class="n">vec1</span> <span class="o">=</span> <span class="n">vtx1</span> <span class="o">-</span> <span class="n">vtx2</span>
</span><span id="__span-77-199"><a id="__codelineno-77-199" name="__codelineno-77-199" href="#__codelineno-77-199"></a>    <span class="n">vec2</span> <span class="o">=</span> <span class="n">vtx3</span> <span class="o">-</span> <span class="n">vtx2</span>
</span><span id="__span-77-200"><a id="__codelineno-77-200" name="__codelineno-77-200" href="#__codelineno-77-200"></a>    <span class="n">vec1</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-77-201"><a id="__codelineno-77-201" name="__codelineno-77-201" href="#__codelineno-77-201"></a>    <span class="n">vec2</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-77-202"><a id="__codelineno-77-202" name="__codelineno-77-202" href="#__codelineno-77-202"></a>    <span class="n">faceNml</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-77-203"><a id="__codelineno-77-203" name="__codelineno-77-203" href="#__codelineno-77-203"></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">vec1</span><span class="o">+</span><span class="n">vec2</span><span class="o">+</span><span class="n">faceNml</span>
</span><span id="__span-77-204"><a id="__codelineno-77-204" name="__codelineno-77-204" href="#__codelineno-77-204"></a>    <span class="n">n</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-77-205"><a id="__codelineno-77-205" name="__codelineno-77-205" href="#__codelineno-77-205"></a>    <span class="k">return</span> <span class="n">n</span>
</span><span id="__span-77-206"><a id="__codelineno-77-206" name="__codelineno-77-206" href="#__codelineno-77-206"></a>
</span><span id="__span-77-207"><a id="__codelineno-77-207" name="__codelineno-77-207" href="#__codelineno-77-207"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateQuad</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># 0 &lt; ratio1 &lt; 1, 0 &lt; ratio2 &lt; 1 to be inside quad</span>
</span><span id="__span-77-208"><a id="__codelineno-77-208" name="__codelineno-77-208" href="#__codelineno-77-208"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v2</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">v4</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio1</span><span class="p">)</span><span class="o">+</span><span class="n">v3</span><span class="o">*</span><span class="n">ratio1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span>
</span><span id="__span-77-209"><a id="__codelineno-77-209" name="__codelineno-77-209" href="#__codelineno-77-209"></a>
</span><span id="__span-77-210"><a id="__codelineno-77-210" name="__codelineno-77-210" href="#__codelineno-77-210"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateTriangle</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">ratio1</span><span class="p">,</span> <span class="n">ratio2</span><span class="p">):</span> <span class="c1"># ratio1 &gt; 0, ratio2 &gt; 0, ratio1+ratio2 &lt; 1 to be inside triangle</span>
</span><span id="__span-77-211"><a id="__codelineno-77-211" name="__codelineno-77-211" href="#__codelineno-77-211"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio1</span><span class="o">+</span><span class="p">(</span><span class="n">v3</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">ratio2</span><span class="o">+</span><span class="n">v1</span>
</span><span id="__span-77-212"><a id="__codelineno-77-212" name="__codelineno-77-212" href="#__codelineno-77-212"></a>
</span><span id="__span-77-213"><a id="__codelineno-77-213" name="__codelineno-77-213" href="#__codelineno-77-213"></a><span class="k">def</span><span class="w"> </span><span class="nf">interpolateLine</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">ratio</span><span class="p">):</span> <span class="c1"># 0 &lt; ratio &lt; 1</span>
</span><span id="__span-77-214"><a id="__codelineno-77-214" name="__codelineno-77-214" href="#__codelineno-77-214"></a>    <span class="k">return</span> <span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="n">v2</span><span class="o">*</span><span class="n">ratio</span>
</span><span id="__span-77-215"><a id="__codelineno-77-215" name="__codelineno-77-215" href="#__codelineno-77-215"></a>
</span><span id="__span-77-216"><a id="__codelineno-77-216" name="__codelineno-77-216" href="#__codelineno-77-216"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth1</span><span class="p">,</span> <span class="n">offsetDepth2</span><span class="p">,</span> <span class="n">offsetDepth3</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<h4 id="722-subdivision-19-long-edge-subdivision">7.22 Subdivision 19: Long Edge Subdivision</h4>
<p><div class="language-PY highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), maxEdgeLength : float (Item Access)</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursion</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">AddVertices</span><span class="p">(</span><span class="n">vtx</span><span class="p">)</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a>        <span class="k">if</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">):</span> <span class="c1"># quad face</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span>
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># mid point</span>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># mid point</span>
</span><span id="__span-78-21"><a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># mid point</span>
</span><span id="__span-78-22"><a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v4</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># mid point</span>
</span><span id="__span-78-23"><a id="__codelineno-78-23" name="__codelineno-78-23" href="#__codelineno-78-23"></a>            <span class="n">widx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># center point</span>
</span><span id="__span-78-24"><a id="__codelineno-78-24" name="__codelineno-78-24" href="#__codelineno-78-24"></a>            <span class="n">dist12</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span><span id="__span-78-25"><a id="__codelineno-78-25" name="__codelineno-78-25" href="#__codelineno-78-25"></a>            <span class="n">dist23</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</span><span id="__span-78-26"><a id="__codelineno-78-26" name="__codelineno-78-26" href="#__codelineno-78-26"></a>            <span class="n">dist34</span> <span class="o">=</span> <span class="n">v3</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span>
</span><span id="__span-78-27"><a id="__codelineno-78-27" name="__codelineno-78-27" href="#__codelineno-78-27"></a>            <span class="n">dist41</span> <span class="o">=</span> <span class="n">v4</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</span><span id="__span-78-28"><a id="__codelineno-78-28" name="__codelineno-78-28" href="#__codelineno-78-28"></a>            <span class="k">if</span><span class="p">(</span><span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist23</span><span class="o">&gt;</span><span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist34</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist41</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">):</span> <span class="c1"># quad subdiv</span>
</span><span id="__span-78-29"><a id="__codelineno-78-29" name="__codelineno-78-29" href="#__codelineno-78-29"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-78-30"><a id="__codelineno-78-30" name="__codelineno-78-30" href="#__codelineno-78-30"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-31"><a id="__codelineno-78-31" name="__codelineno-78-31" href="#__codelineno-78-31"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-32"><a id="__codelineno-78-32" name="__codelineno-78-32" href="#__codelineno-78-32"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx5</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-33"><a id="__codelineno-78-33" name="__codelineno-78-33" href="#__codelineno-78-33"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist34</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 quad, 3 triangles</span>
</span><span id="__span-78-34"><a id="__codelineno-78-34" name="__codelineno-78-34" href="#__codelineno-78-34"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-78-35"><a id="__codelineno-78-35" name="__codelineno-78-35" href="#__codelineno-78-35"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-36"><a id="__codelineno-78-36" name="__codelineno-78-36" href="#__codelineno-78-36"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-37"><a id="__codelineno-78-37" name="__codelineno-78-37" href="#__codelineno-78-37"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-38"><a id="__codelineno-78-38" name="__codelineno-78-38" href="#__codelineno-78-38"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist34</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist41</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 quad, 3 triangles</span>
</span><span id="__span-78-39"><a id="__codelineno-78-39" name="__codelineno-78-39" href="#__codelineno-78-39"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">)</span>
</span><span id="__span-78-40"><a id="__codelineno-78-40" name="__codelineno-78-40" href="#__codelineno-78-40"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-41"><a id="__codelineno-78-41" name="__codelineno-78-41" href="#__codelineno-78-41"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-78-42"><a id="__codelineno-78-42" name="__codelineno-78-42" href="#__codelineno-78-42"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-78-43"><a id="__codelineno-78-43" name="__codelineno-78-43" href="#__codelineno-78-43"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist34</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist41</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 quad, 3 triangles</span>
</span><span id="__span-78-44"><a id="__codelineno-78-44" name="__codelineno-78-44" href="#__codelineno-78-44"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">)</span>
</span><span id="__span-78-45"><a id="__codelineno-78-45" name="__codelineno-78-45" href="#__codelineno-78-45"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-78-46"><a id="__codelineno-78-46" name="__codelineno-78-46" href="#__codelineno-78-46"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-47"><a id="__codelineno-78-47" name="__codelineno-78-47" href="#__codelineno-78-47"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-48"><a id="__codelineno-78-48" name="__codelineno-78-48" href="#__codelineno-78-48"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist41</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 quad, 3 triangles</span>
</span><span id="__span-78-49"><a id="__codelineno-78-49" name="__codelineno-78-49" href="#__codelineno-78-49"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-78-50"><a id="__codelineno-78-50" name="__codelineno-78-50" href="#__codelineno-78-50"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-51"><a id="__codelineno-78-51" name="__codelineno-78-51" href="#__codelineno-78-51"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-52"><a id="__codelineno-78-52" name="__codelineno-78-52" href="#__codelineno-78-52"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-53"><a id="__codelineno-78-53" name="__codelineno-78-53" href="#__codelineno-78-53"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist34</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">):</span> <span class="c1"># 2 quads</span>
</span><span id="__span-78-54"><a id="__codelineno-78-54" name="__codelineno-78-54" href="#__codelineno-78-54"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-78-55"><a id="__codelineno-78-55" name="__codelineno-78-55" href="#__codelineno-78-55"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-56"><a id="__codelineno-78-56" name="__codelineno-78-56" href="#__codelineno-78-56"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist41</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">):</span> <span class="c1"># 2 quads</span>
</span><span id="__span-78-57"><a id="__codelineno-78-57" name="__codelineno-78-57" href="#__codelineno-78-57"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-78-58"><a id="__codelineno-78-58" name="__codelineno-78-58" href="#__codelineno-78-58"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-78-59"><a id="__codelineno-78-59" name="__codelineno-78-59" href="#__codelineno-78-59"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">):</span> <span class="c1"># 1 quad, 2 triangles</span>
</span><span id="__span-78-60"><a id="__codelineno-78-60" name="__codelineno-78-60" href="#__codelineno-78-60"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-61"><a id="__codelineno-78-61" name="__codelineno-78-61" href="#__codelineno-78-61"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-62"><a id="__codelineno-78-62" name="__codelineno-78-62" href="#__codelineno-78-62"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">)</span>
</span><span id="__span-78-63"><a id="__codelineno-78-63" name="__codelineno-78-63" href="#__codelineno-78-63"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist34</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">):</span> <span class="c1"># 1 quad, 2 triangles</span>
</span><span id="__span-78-64"><a id="__codelineno-78-64" name="__codelineno-78-64" href="#__codelineno-78-64"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-65"><a id="__codelineno-78-65" name="__codelineno-78-65" href="#__codelineno-78-65"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-66"><a id="__codelineno-78-66" name="__codelineno-78-66" href="#__codelineno-78-66"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">)</span>
</span><span id="__span-78-67"><a id="__codelineno-78-67" name="__codelineno-78-67" href="#__codelineno-78-67"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist34</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist41</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">):</span> <span class="c1"># 1 quad, 2 triangles</span>
</span><span id="__span-78-68"><a id="__codelineno-78-68" name="__codelineno-78-68" href="#__codelineno-78-68"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-69"><a id="__codelineno-78-69" name="__codelineno-78-69" href="#__codelineno-78-69"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-70"><a id="__codelineno-78-70" name="__codelineno-78-70" href="#__codelineno-78-70"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-78-71"><a id="__codelineno-78-71" name="__codelineno-78-71" href="#__codelineno-78-71"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist41</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">):</span> <span class="c1"># 1 quad, 2 triangles</span>
</span><span id="__span-78-72"><a id="__codelineno-78-72" name="__codelineno-78-72" href="#__codelineno-78-72"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-78-73"><a id="__codelineno-78-73" name="__codelineno-78-73" href="#__codelineno-78-73"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">)</span>
</span><span id="__span-78-74"><a id="__codelineno-78-74" name="__codelineno-78-74" href="#__codelineno-78-74"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-78-75"><a id="__codelineno-78-75" name="__codelineno-78-75" href="#__codelineno-78-75"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 quad, 1 triangle</span>
</span><span id="__span-78-76"><a id="__codelineno-78-76" name="__codelineno-78-76" href="#__codelineno-78-76"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span> <span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-78-77"><a id="__codelineno-78-77" name="__codelineno-78-77" href="#__codelineno-78-77"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-78-78"><a id="__codelineno-78-78" name="__codelineno-78-78" href="#__codelineno-78-78"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 quad, 1 triangle</span>
</span><span id="__span-78-79"><a id="__codelineno-78-79" name="__codelineno-78-79" href="#__codelineno-78-79"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span> <span class="n">vidx1</span><span class="p">)</span>
</span><span id="__span-78-80"><a id="__codelineno-78-80" name="__codelineno-78-80" href="#__codelineno-78-80"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-78-81"><a id="__codelineno-78-81" name="__codelineno-78-81" href="#__codelineno-78-81"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist34</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 quad, 1 triangle</span>
</span><span id="__span-78-82"><a id="__codelineno-78-82" name="__codelineno-78-82" href="#__codelineno-78-82"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span> <span class="n">vidx2</span><span class="p">)</span>
</span><span id="__span-78-83"><a id="__codelineno-78-83" name="__codelineno-78-83" href="#__codelineno-78-83"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">)</span>
</span><span id="__span-78-84"><a id="__codelineno-78-84" name="__codelineno-78-84" href="#__codelineno-78-84"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist41</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 quad, 1 triangle</span>
</span><span id="__span-78-85"><a id="__codelineno-78-85" name="__codelineno-78-85" href="#__codelineno-78-85"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span> <span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-78-86"><a id="__codelineno-78-86" name="__codelineno-78-86" href="#__codelineno-78-86"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">)</span>
</span><span id="__span-78-87"><a id="__codelineno-78-87" name="__codelineno-78-87" href="#__codelineno-78-87"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-78-88"><a id="__codelineno-78-88" name="__codelineno-78-88" href="#__codelineno-78-88"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-78-89"><a id="__codelineno-78-89" name="__codelineno-78-89" href="#__codelineno-78-89"></a>
</span><span id="__span-78-90"><a id="__codelineno-78-90" name="__codelineno-78-90" href="#__codelineno-78-90"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># triangular face</span>
</span><span id="__span-78-91"><a id="__codelineno-78-91" name="__codelineno-78-91" href="#__codelineno-78-91"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-78-92"><a id="__codelineno-78-92" name="__codelineno-78-92" href="#__codelineno-78-92"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-78-93"><a id="__codelineno-78-93" name="__codelineno-78-93" href="#__codelineno-78-93"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-78-94"><a id="__codelineno-78-94" name="__codelineno-78-94" href="#__codelineno-78-94"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span>
</span><span id="__span-78-95"><a id="__codelineno-78-95" name="__codelineno-78-95" href="#__codelineno-78-95"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span>
</span><span id="__span-78-96"><a id="__codelineno-78-96" name="__codelineno-78-96" href="#__codelineno-78-96"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span>
</span><span id="__span-78-97"><a id="__codelineno-78-97" name="__codelineno-78-97" href="#__codelineno-78-97"></a>            <span class="n">widx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># mid point</span>
</span><span id="__span-78-98"><a id="__codelineno-78-98" name="__codelineno-78-98" href="#__codelineno-78-98"></a>            <span class="n">widx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># mid point</span>
</span><span id="__span-78-99"><a id="__codelineno-78-99" name="__codelineno-78-99" href="#__codelineno-78-99"></a>            <span class="n">widx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v3</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># mid point</span>
</span><span id="__span-78-100"><a id="__codelineno-78-100" name="__codelineno-78-100" href="#__codelineno-78-100"></a>            <span class="n">widx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># center point</span>
</span><span id="__span-78-101"><a id="__codelineno-78-101" name="__codelineno-78-101" href="#__codelineno-78-101"></a>            <span class="n">dist12</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span><span id="__span-78-102"><a id="__codelineno-78-102" name="__codelineno-78-102" href="#__codelineno-78-102"></a>            <span class="n">dist23</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</span><span id="__span-78-103"><a id="__codelineno-78-103" name="__codelineno-78-103" href="#__codelineno-78-103"></a>            <span class="n">dist31</span> <span class="o">=</span> <span class="n">v3</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</span><span id="__span-78-104"><a id="__codelineno-78-104" name="__codelineno-78-104" href="#__codelineno-78-104"></a>            <span class="k">if</span><span class="p">(</span><span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist23</span><span class="o">&gt;</span><span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist31</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 3 quads</span>
</span><span id="__span-78-105"><a id="__codelineno-78-105" name="__codelineno-78-105" href="#__codelineno-78-105"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-106"><a id="__codelineno-78-106" name="__codelineno-78-106" href="#__codelineno-78-106"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-107"><a id="__codelineno-78-107" name="__codelineno-78-107" href="#__codelineno-78-107"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx4</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-108"><a id="__codelineno-78-108" name="__codelineno-78-108" href="#__codelineno-78-108"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 triangle, 1 quad</span>
</span><span id="__span-78-109"><a id="__codelineno-78-109" name="__codelineno-78-109" href="#__codelineno-78-109"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-110"><a id="__codelineno-78-110" name="__codelineno-78-110" href="#__codelineno-78-110"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">)</span>
</span><span id="__span-78-111"><a id="__codelineno-78-111" name="__codelineno-78-111" href="#__codelineno-78-111"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist31</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 triangle, 1 quad</span>
</span><span id="__span-78-112"><a id="__codelineno-78-112" name="__codelineno-78-112" href="#__codelineno-78-112"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-113"><a id="__codelineno-78-113" name="__codelineno-78-113" href="#__codelineno-78-113"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">)</span>
</span><span id="__span-78-114"><a id="__codelineno-78-114" name="__codelineno-78-114" href="#__codelineno-78-114"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist31</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 1 triangle, 1 quad</span>
</span><span id="__span-78-115"><a id="__codelineno-78-115" name="__codelineno-78-115" href="#__codelineno-78-115"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-116"><a id="__codelineno-78-116" name="__codelineno-78-116" href="#__codelineno-78-116"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">)</span>
</span><span id="__span-78-117"><a id="__codelineno-78-117" name="__codelineno-78-117" href="#__codelineno-78-117"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist12</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 2 triangles</span>
</span><span id="__span-78-118"><a id="__codelineno-78-118" name="__codelineno-78-118" href="#__codelineno-78-118"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-78-119"><a id="__codelineno-78-119" name="__codelineno-78-119" href="#__codelineno-78-119"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-78-120"><a id="__codelineno-78-120" name="__codelineno-78-120" href="#__codelineno-78-120"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist23</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 2 triangles</span>
</span><span id="__span-78-121"><a id="__codelineno-78-121" name="__codelineno-78-121" href="#__codelineno-78-121"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx1</span><span class="p">)</span>
</span><span id="__span-78-122"><a id="__codelineno-78-122" name="__codelineno-78-122" href="#__codelineno-78-122"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">)</span>
</span><span id="__span-78-123"><a id="__codelineno-78-123" name="__codelineno-78-123" href="#__codelineno-78-123"></a>            <span class="k">elif</span><span class="p">(</span><span class="n">dist31</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">):</span> <span class="c1"># 2 triangles</span>
</span><span id="__span-78-124"><a id="__codelineno-78-124" name="__codelineno-78-124" href="#__codelineno-78-124"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx2</span><span class="p">)</span>
</span><span id="__span-78-125"><a id="__codelineno-78-125" name="__codelineno-78-125" href="#__codelineno-78-125"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">widx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">)</span>
</span><span id="__span-78-126"><a id="__codelineno-78-126" name="__codelineno-78-126" href="#__codelineno-78-126"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-78-127"><a id="__codelineno-78-127" name="__codelineno-78-127" href="#__codelineno-78-127"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-78-128"><a id="__codelineno-78-128" name="__codelineno-78-128" href="#__codelineno-78-128"></a>
</span><span id="__span-78-129"><a id="__codelineno-78-129" name="__codelineno-78-129" href="#__codelineno-78-129"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-78-130"><a id="__codelineno-78-130" name="__codelineno-78-130" href="#__codelineno-78-130"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
</span><span id="__span-78-131"><a id="__codelineno-78-131" name="__codelineno-78-131" href="#__codelineno-78-131"></a>    <span class="k">if</span><span class="p">(</span><span class="n">recursion</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-78-132"><a id="__codelineno-78-132" name="__codelineno-78-132" href="#__codelineno-78-132"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">recursion</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</span><span id="__span-78-133"><a id="__codelineno-78-133" name="__codelineno-78-133" href="#__codelineno-78-133"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-78-134"><a id="__codelineno-78-134" name="__codelineno-78-134" href="#__codelineno-78-134"></a>
</span><span id="__span-78-135"><a id="__codelineno-78-135" name="__codelineno-78-135" href="#__codelineno-78-135"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="n">recursionLevel</span><span class="p">,</span><span class="n">maxEdgeLength</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.23 Subdivision 20: Mesh Face Offset with Attractors 
<div class="language-PY highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1"># offset mesh faces scaled by attractors</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), </span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="c1"># offsetDepth : float (Item Access), scaleFactor : float (Item Access), </span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="c1"># attractors : Point3d (List Access), attractorRange : float (Item Access)</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">offsetMeshFaces</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a>    <span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span> <span class="c1"># in case FaceNormals are missing</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span> <span class="c1"># get all vertices in a list</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a>        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">:</span>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="p">]</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span><span class="p">]</span>
</span><span id="__span-79-20"><a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a>            <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span> <span class="o">+</span> <span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
</span><span id="__span-79-21"><a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a>            <span class="n">aval</span> <span class="o">=</span> <span class="n">attractorValue</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span>
</span><span id="__span-79-22"><a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a>            <span class="k">if</span> <span class="n">aval</span><span class="o">*</span><span class="n">scale</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
</span><span id="__span-79-23"><a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-79-24"><a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-79-25"><a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-79-26"><a id="__codelineno-79-26" name="__codelineno-79-26" href="#__codelineno-79-26"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-79-27"><a id="__codelineno-79-27" name="__codelineno-79-27" href="#__codelineno-79-27"></a>                <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</span><span id="__span-79-28"><a id="__codelineno-79-28" name="__codelineno-79-28" href="#__codelineno-79-28"></a>                <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span><span id="__span-79-29"><a id="__codelineno-79-29" name="__codelineno-79-29" href="#__codelineno-79-29"></a>                <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</span><span id="__span-79-30"><a id="__codelineno-79-30" name="__codelineno-79-30" href="#__codelineno-79-30"></a>                <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span>
</span><span id="__span-79-31"><a id="__codelineno-79-31" name="__codelineno-79-31" href="#__codelineno-79-31"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-79-32"><a id="__codelineno-79-32" name="__codelineno-79-32" href="#__codelineno-79-32"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-79-33"><a id="__codelineno-79-33" name="__codelineno-79-33" href="#__codelineno-79-33"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-79-34"><a id="__codelineno-79-34" name="__codelineno-79-34" href="#__codelineno-79-34"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="p">]</span>
</span><span id="__span-79-35"><a id="__codelineno-79-35" name="__codelineno-79-35" href="#__codelineno-79-35"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>
</span><span id="__span-79-36"><a id="__codelineno-79-36" name="__codelineno-79-36" href="#__codelineno-79-36"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
</span><span id="__span-79-37"><a id="__codelineno-79-37" name="__codelineno-79-37" href="#__codelineno-79-37"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
</span><span id="__span-79-38"><a id="__codelineno-79-38" name="__codelineno-79-38" href="#__codelineno-79-38"></a>            <span class="n">aval</span> <span class="o">=</span> <span class="n">attractorValue</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span>
</span><span id="__span-79-39"><a id="__codelineno-79-39" name="__codelineno-79-39" href="#__codelineno-79-39"></a>            <span class="k">if</span> <span class="n">aval</span><span class="o">*</span><span class="n">scale</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
</span><span id="__span-79-40"><a id="__codelineno-79-40" name="__codelineno-79-40" href="#__codelineno-79-40"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-79-41"><a id="__codelineno-79-41" name="__codelineno-79-41" href="#__codelineno-79-41"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-79-42"><a id="__codelineno-79-42" name="__codelineno-79-42" href="#__codelineno-79-42"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-79-43"><a id="__codelineno-79-43" name="__codelineno-79-43" href="#__codelineno-79-43"></a>                <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</span><span id="__span-79-44"><a id="__codelineno-79-44" name="__codelineno-79-44" href="#__codelineno-79-44"></a>                <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span><span id="__span-79-45"><a id="__codelineno-79-45" name="__codelineno-79-45" href="#__codelineno-79-45"></a>                <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</span><span id="__span-79-46"><a id="__codelineno-79-46" name="__codelineno-79-46" href="#__codelineno-79-46"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-79-47"><a id="__codelineno-79-47" name="__codelineno-79-47" href="#__codelineno-79-47"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-79-48"><a id="__codelineno-79-48" name="__codelineno-79-48" href="#__codelineno-79-48"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh2</span><span class="p">)</span>
</span><span id="__span-79-49"><a id="__codelineno-79-49" name="__codelineno-79-49" href="#__codelineno-79-49"></a>    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-79-50"><a id="__codelineno-79-50" name="__codelineno-79-50" href="#__codelineno-79-50"></a>        <span class="n">offsetMeshFaces</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-79-51"><a id="__codelineno-79-51" name="__codelineno-79-51" href="#__codelineno-79-51"></a>
</span><span id="__span-79-52"><a id="__codelineno-79-52" name="__codelineno-79-52" href="#__codelineno-79-52"></a><span class="k">def</span><span class="w"> </span><span class="nf">attractorValue</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span> <span class="c1"># calculate value of 0-1 by attractors</span>
</span><span id="__span-79-53"><a id="__codelineno-79-53" name="__codelineno-79-53" href="#__codelineno-79-53"></a>    <span class="n">minDist</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-79-54"><a id="__codelineno-79-54" name="__codelineno-79-54" href="#__codelineno-79-54"></a>    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attractors</span><span class="p">:</span> <span class="c1"># find closest attractor</span>
</span><span id="__span-79-55"><a id="__codelineno-79-55" name="__codelineno-79-55" href="#__codelineno-79-55"></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span><span id="__span-79-56"><a id="__codelineno-79-56" name="__codelineno-79-56" href="#__codelineno-79-56"></a>        <span class="k">if</span><span class="p">(</span> <span class="n">minDist</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">minDist</span> <span class="p">):</span>
</span><span id="__span-79-57"><a id="__codelineno-79-57" name="__codelineno-79-57" href="#__codelineno-79-57"></a>            <span class="n">minDist</span> <span class="o">=</span> <span class="n">dist</span>
</span><span id="__span-79-58"><a id="__codelineno-79-58" name="__codelineno-79-58" href="#__codelineno-79-58"></a>    <span class="k">if</span><span class="p">(</span><span class="n">minDist</span> <span class="o">&lt;</span> <span class="n">attractorRange</span><span class="p">):</span> <span class="c1"># check range and scale value to 0 - 1</span>
</span><span id="__span-79-59"><a id="__codelineno-79-59" name="__codelineno-79-59" href="#__codelineno-79-59"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">attractorRange</span> <span class="o">-</span> <span class="n">minDist</span><span class="p">)</span><span class="o">/</span><span class="n">attractorRange</span> <span class="c1"># value from 0 to 1</span>
</span><span id="__span-79-60"><a id="__codelineno-79-60" name="__codelineno-79-60" href="#__codelineno-79-60"></a>    <span class="k">return</span> <span class="mi">0</span> <span class="c1"># when out of range</span>
</span><span id="__span-79-61"><a id="__codelineno-79-61" name="__codelineno-79-61" href="#__codelineno-79-61"></a>
</span><span id="__span-79-62"><a id="__codelineno-79-62" name="__codelineno-79-62" href="#__codelineno-79-62"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-79-63"><a id="__codelineno-79-63" name="__codelineno-79-63" href="#__codelineno-79-63"></a><span class="n">offsetMeshFaces</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div></p>
<p>7.24 Subdivision 21: Mesh Face Offset with Randomness
<div class="language-PY highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="c1"># offset mesh faces and scale random choice of opposite edges</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), level : int (Item Access), </span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="c1"># offsetDepth : float (Item Access),  scaleFactor : float (Item Access) </span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">offsetMeshFaces</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span> <span class="c1"># get all vertices in a list</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a>        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">:</span>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span>
</span><span id="__span-80-17"><a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-80-18"><a id="__codelineno-80-18" name="__codelineno-80-18" href="#__codelineno-80-18"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-80-19"><a id="__codelineno-80-19" name="__codelineno-80-19" href="#__codelineno-80-19"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-80-20"><a id="__codelineno-80-20" name="__codelineno-80-20" href="#__codelineno-80-20"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx4</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">vidx4</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-80-21"><a id="__codelineno-80-21" name="__codelineno-80-21" href="#__codelineno-80-21"></a>            <span class="n">randomVal</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="__span-80-22"><a id="__codelineno-80-22" name="__codelineno-80-22" href="#__codelineno-80-22"></a>            <span class="k">if</span> <span class="n">randomVal</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span> <span class="c1"># scaling random choice of edges</span>
</span><span id="__span-80-23"><a id="__codelineno-80-23" name="__codelineno-80-23" href="#__codelineno-80-23"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v4</span>
</span><span id="__span-80-24"><a id="__codelineno-80-24" name="__codelineno-80-24" href="#__codelineno-80-24"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v3</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v3</span>
</span><span id="__span-80-25"><a id="__codelineno-80-25" name="__codelineno-80-25" href="#__codelineno-80-25"></a>            <span class="k">elif</span> <span class="n">randomVal</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
</span><span id="__span-80-26"><a id="__codelineno-80-26" name="__codelineno-80-26" href="#__codelineno-80-26"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v1</span>
</span><span id="__span-80-27"><a id="__codelineno-80-27" name="__codelineno-80-27" href="#__codelineno-80-27"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v4</span>
</span><span id="__span-80-28"><a id="__codelineno-80-28" name="__codelineno-80-28" href="#__codelineno-80-28"></a>            <span class="k">elif</span> <span class="n">randomVal</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span>
</span><span id="__span-80-29"><a id="__codelineno-80-29" name="__codelineno-80-29" href="#__codelineno-80-29"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v2</span>
</span><span id="__span-80-30"><a id="__codelineno-80-30" name="__codelineno-80-30" href="#__codelineno-80-30"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">-</span> <span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v1</span>
</span><span id="__span-80-31"><a id="__codelineno-80-31" name="__codelineno-80-31" href="#__codelineno-80-31"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-80-32"><a id="__codelineno-80-32" name="__codelineno-80-32" href="#__codelineno-80-32"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">-</span> <span class="n">v3</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v3</span>
</span><span id="__span-80-33"><a id="__codelineno-80-33" name="__codelineno-80-33" href="#__codelineno-80-33"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v2</span>
</span><span id="__span-80-34"><a id="__codelineno-80-34" name="__codelineno-80-34" href="#__codelineno-80-34"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</span><span id="__span-80-35"><a id="__codelineno-80-35" name="__codelineno-80-35" href="#__codelineno-80-35"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span><span id="__span-80-36"><a id="__codelineno-80-36" name="__codelineno-80-36" href="#__codelineno-80-36"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</span><span id="__span-80-37"><a id="__codelineno-80-37" name="__codelineno-80-37" href="#__codelineno-80-37"></a>            <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span>
</span><span id="__span-80-38"><a id="__codelineno-80-38" name="__codelineno-80-38" href="#__codelineno-80-38"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-80-39"><a id="__codelineno-80-39" name="__codelineno-80-39" href="#__codelineno-80-39"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-80-40"><a id="__codelineno-80-40" name="__codelineno-80-40" href="#__codelineno-80-40"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
</span><span id="__span-80-41"><a id="__codelineno-80-41" name="__codelineno-80-41" href="#__codelineno-80-41"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span>
</span><span id="__span-80-42"><a id="__codelineno-80-42" name="__codelineno-80-42" href="#__codelineno-80-42"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span>
</span><span id="__span-80-43"><a id="__codelineno-80-43" name="__codelineno-80-43" href="#__codelineno-80-43"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">vidx1</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-80-44"><a id="__codelineno-80-44" name="__codelineno-80-44" href="#__codelineno-80-44"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx2</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">vidx2</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-80-45"><a id="__codelineno-80-45" name="__codelineno-80-45" href="#__codelineno-80-45"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">vidx3</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">vidx3</span><span class="p">])</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-80-46"><a id="__codelineno-80-46" name="__codelineno-80-46" href="#__codelineno-80-46"></a>            <span class="n">randomVal</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="__span-80-47"><a id="__codelineno-80-47" name="__codelineno-80-47" href="#__codelineno-80-47"></a>            <span class="k">if</span> <span class="n">randomVal</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span> <span class="c1"># scaling random choice of edges</span>
</span><span id="__span-80-48"><a id="__codelineno-80-48" name="__codelineno-80-48" href="#__codelineno-80-48"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v3</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v3</span>
</span><span id="__span-80-49"><a id="__codelineno-80-49" name="__codelineno-80-49" href="#__codelineno-80-49"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v3</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v3</span>
</span><span id="__span-80-50"><a id="__codelineno-80-50" name="__codelineno-80-50" href="#__codelineno-80-50"></a>            <span class="k">elif</span> <span class="n">randomVal</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">:</span>
</span><span id="__span-80-51"><a id="__codelineno-80-51" name="__codelineno-80-51" href="#__codelineno-80-51"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v1</span>
</span><span id="__span-80-52"><a id="__codelineno-80-52" name="__codelineno-80-52" href="#__codelineno-80-52"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v1</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v1</span>
</span><span id="__span-80-53"><a id="__codelineno-80-53" name="__codelineno-80-53" href="#__codelineno-80-53"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-80-54"><a id="__codelineno-80-54" name="__codelineno-80-54" href="#__codelineno-80-54"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v2</span>
</span><span id="__span-80-55"><a id="__codelineno-80-55" name="__codelineno-80-55" href="#__codelineno-80-55"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v2</span>
</span><span id="__span-80-56"><a id="__codelineno-80-56" name="__codelineno-80-56" href="#__codelineno-80-56"></a>            <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</span><span id="__span-80-57"><a id="__codelineno-80-57" name="__codelineno-80-57" href="#__codelineno-80-57"></a>            <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span><span id="__span-80-58"><a id="__codelineno-80-58" name="__codelineno-80-58" href="#__codelineno-80-58"></a>            <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</span><span id="__span-80-59"><a id="__codelineno-80-59" name="__codelineno-80-59" href="#__codelineno-80-59"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">)</span>
</span><span id="__span-80-60"><a id="__codelineno-80-60" name="__codelineno-80-60" href="#__codelineno-80-60"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-80-61"><a id="__codelineno-80-61" name="__codelineno-80-61" href="#__codelineno-80-61"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-80-62"><a id="__codelineno-80-62" name="__codelineno-80-62" href="#__codelineno-80-62"></a>    <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh2</span><span class="p">)</span>
</span><span id="__span-80-63"><a id="__codelineno-80-63" name="__codelineno-80-63" href="#__codelineno-80-63"></a>
</span><span id="__span-80-64"><a id="__codelineno-80-64" name="__codelineno-80-64" href="#__codelineno-80-64"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-80-65"><a id="__codelineno-80-65" name="__codelineno-80-65" href="#__codelineno-80-65"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">level</span><span class="p">):</span> <span class="c1"># not recursion but repetition</span>
</span><span id="__span-80-66"><a id="__codelineno-80-66" name="__codelineno-80-66" href="#__codelineno-80-66"></a>    <span class="n">offsetMeshFaces</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">offsetDepth</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">scaleFactor</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="__span-80-67"><a id="__codelineno-80-67" name="__codelineno-80-67" href="#__codelineno-80-67"></a>    <span class="n">scaleFactor</span> <span class="o">*=</span> <span class="n">scaleFactor</span>
</span></code></pre></div>
- TBD</p>
<p>7.25 Subdivision 22: Extruded Face Offset with Attractors
<div class="language-PY highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1"># offset extruded closed mesh from faces</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), offsetDepth : float (Item Access),</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="c1"># height : float (Item Access), scale : float (Item Access), attractors : Point3d (List Access), attractorRange : float (Item Access)</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">offsetMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a>    <span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span> <span class="c1"># in case FaceNormals are missing</span>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span> <span class="c1"># get all vertices in a list</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a>        <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a>        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">:</span>
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="p">]</span>
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
</span><span id="__span-81-18"><a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span><span class="p">]</span>
</span><span id="__span-81-19"><a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a>            <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
</span><span id="__span-81-20"><a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a>            <span class="n">aval</span> <span class="o">=</span> <span class="n">attractorValue</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span>
</span><span id="__span-81-21"><a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a>            <span class="k">if</span> <span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span> <span class="c1"># ignore if too small</span>
</span><span id="__span-81-22"><a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a>                <span class="n">v1a</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-23"><a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a>                <span class="n">v2a</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-24"><a id="__codelineno-81-24" name="__codelineno-81-24" href="#__codelineno-81-24"></a>                <span class="n">v3a</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-25"><a id="__codelineno-81-25" name="__codelineno-81-25" href="#__codelineno-81-25"></a>                <span class="n">v4a</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-26"><a id="__codelineno-81-26" name="__codelineno-81-26" href="#__codelineno-81-26"></a>                <span class="n">v1b</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-27"><a id="__codelineno-81-27" name="__codelineno-81-27" href="#__codelineno-81-27"></a>                <span class="n">v2b</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-28"><a id="__codelineno-81-28" name="__codelineno-81-28" href="#__codelineno-81-28"></a>                <span class="n">v3b</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-29"><a id="__codelineno-81-29" name="__codelineno-81-29" href="#__codelineno-81-29"></a>                <span class="n">v4b</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-30"><a id="__codelineno-81-30" name="__codelineno-81-30" href="#__codelineno-81-30"></a>                <span class="n">vidx1a</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1a</span><span class="p">)</span> <span class="c1"># bottom 4 vertices</span>
</span><span id="__span-81-31"><a id="__codelineno-81-31" name="__codelineno-81-31" href="#__codelineno-81-31"></a>                <span class="n">vidx2a</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2a</span><span class="p">)</span>
</span><span id="__span-81-32"><a id="__codelineno-81-32" name="__codelineno-81-32" href="#__codelineno-81-32"></a>                <span class="n">vidx3a</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3a</span><span class="p">)</span>
</span><span id="__span-81-33"><a id="__codelineno-81-33" name="__codelineno-81-33" href="#__codelineno-81-33"></a>                <span class="n">vidx4a</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4a</span><span class="p">)</span>
</span><span id="__span-81-34"><a id="__codelineno-81-34" name="__codelineno-81-34" href="#__codelineno-81-34"></a>                <span class="n">vidx1b</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1b</span><span class="p">)</span> <span class="c1"># top 4 vertices</span>
</span><span id="__span-81-35"><a id="__codelineno-81-35" name="__codelineno-81-35" href="#__codelineno-81-35"></a>                <span class="n">vidx2b</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2b</span><span class="p">)</span>
</span><span id="__span-81-36"><a id="__codelineno-81-36" name="__codelineno-81-36" href="#__codelineno-81-36"></a>                <span class="n">vidx3b</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3b</span><span class="p">)</span>
</span><span id="__span-81-37"><a id="__codelineno-81-37" name="__codelineno-81-37" href="#__codelineno-81-37"></a>                <span class="n">vidx4b</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4b</span><span class="p">)</span>
</span><span id="__span-81-38"><a id="__codelineno-81-38" name="__codelineno-81-38" href="#__codelineno-81-38"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1a</span><span class="p">,</span><span class="n">vidx2a</span><span class="p">,</span><span class="n">vidx2b</span><span class="p">,</span><span class="n">vidx1b</span><span class="p">)</span>
</span><span id="__span-81-39"><a id="__codelineno-81-39" name="__codelineno-81-39" href="#__codelineno-81-39"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2a</span><span class="p">,</span><span class="n">vidx3a</span><span class="p">,</span><span class="n">vidx3b</span><span class="p">,</span><span class="n">vidx2b</span><span class="p">)</span>
</span><span id="__span-81-40"><a id="__codelineno-81-40" name="__codelineno-81-40" href="#__codelineno-81-40"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3a</span><span class="p">,</span><span class="n">vidx4a</span><span class="p">,</span><span class="n">vidx4b</span><span class="p">,</span><span class="n">vidx3b</span><span class="p">)</span>
</span><span id="__span-81-41"><a id="__codelineno-81-41" name="__codelineno-81-41" href="#__codelineno-81-41"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4a</span><span class="p">,</span><span class="n">vidx1a</span><span class="p">,</span><span class="n">vidx1b</span><span class="p">,</span><span class="n">vidx4b</span><span class="p">)</span>
</span><span id="__span-81-42"><a id="__codelineno-81-42" name="__codelineno-81-42" href="#__codelineno-81-42"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1a</span><span class="p">,</span><span class="n">vidx4a</span><span class="p">,</span><span class="n">vidx3a</span><span class="p">,</span><span class="n">vidx2a</span><span class="p">)</span>
</span><span id="__span-81-43"><a id="__codelineno-81-43" name="__codelineno-81-43" href="#__codelineno-81-43"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1b</span><span class="p">,</span><span class="n">vidx2b</span><span class="p">,</span><span class="n">vidx3b</span><span class="p">,</span><span class="n">vidx4b</span><span class="p">)</span>
</span><span id="__span-81-44"><a id="__codelineno-81-44" name="__codelineno-81-44" href="#__codelineno-81-44"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-81-45"><a id="__codelineno-81-45" name="__codelineno-81-45" href="#__codelineno-81-45"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-81-46"><a id="__codelineno-81-46" name="__codelineno-81-46" href="#__codelineno-81-46"></a>            <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="p">]</span>
</span><span id="__span-81-47"><a id="__codelineno-81-47" name="__codelineno-81-47" href="#__codelineno-81-47"></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>
</span><span id="__span-81-48"><a id="__codelineno-81-48" name="__codelineno-81-48" href="#__codelineno-81-48"></a>            <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
</span><span id="__span-81-49"><a id="__codelineno-81-49" name="__codelineno-81-49" href="#__codelineno-81-49"></a>            <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
</span><span id="__span-81-50"><a id="__codelineno-81-50" name="__codelineno-81-50" href="#__codelineno-81-50"></a>            <span class="n">aval</span> <span class="o">=</span> <span class="n">attractorValue</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span>
</span><span id="__span-81-51"><a id="__codelineno-81-51" name="__codelineno-81-51" href="#__codelineno-81-51"></a>            <span class="k">if</span> <span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span> <span class="c1"># ignore if too small</span>
</span><span id="__span-81-52"><a id="__codelineno-81-52" name="__codelineno-81-52" href="#__codelineno-81-52"></a>                <span class="n">v1a</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-53"><a id="__codelineno-81-53" name="__codelineno-81-53" href="#__codelineno-81-53"></a>                <span class="n">v2a</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-54"><a id="__codelineno-81-54" name="__codelineno-81-54" href="#__codelineno-81-54"></a>                <span class="n">v3a</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-55"><a id="__codelineno-81-55" name="__codelineno-81-55" href="#__codelineno-81-55"></a>                <span class="n">v1b</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-56"><a id="__codelineno-81-56" name="__codelineno-81-56" href="#__codelineno-81-56"></a>                <span class="n">v2b</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-57"><a id="__codelineno-81-57" name="__codelineno-81-57" href="#__codelineno-81-57"></a>                <span class="n">v3b</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">aval</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">aval</span>
</span><span id="__span-81-58"><a id="__codelineno-81-58" name="__codelineno-81-58" href="#__codelineno-81-58"></a>                <span class="n">vidx1a</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1a</span><span class="p">)</span> <span class="c1"># bottom 3 vertices</span>
</span><span id="__span-81-59"><a id="__codelineno-81-59" name="__codelineno-81-59" href="#__codelineno-81-59"></a>                <span class="n">vidx2a</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2a</span><span class="p">)</span>
</span><span id="__span-81-60"><a id="__codelineno-81-60" name="__codelineno-81-60" href="#__codelineno-81-60"></a>                <span class="n">vidx3a</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3a</span><span class="p">)</span>
</span><span id="__span-81-61"><a id="__codelineno-81-61" name="__codelineno-81-61" href="#__codelineno-81-61"></a>                <span class="n">vidx1b</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1b</span><span class="p">)</span> <span class="c1"># top 3 vertices</span>
</span><span id="__span-81-62"><a id="__codelineno-81-62" name="__codelineno-81-62" href="#__codelineno-81-62"></a>                <span class="n">vidx2b</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2b</span><span class="p">)</span>
</span><span id="__span-81-63"><a id="__codelineno-81-63" name="__codelineno-81-63" href="#__codelineno-81-63"></a>                <span class="n">vidx3b</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3b</span><span class="p">)</span>
</span><span id="__span-81-64"><a id="__codelineno-81-64" name="__codelineno-81-64" href="#__codelineno-81-64"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1a</span><span class="p">,</span><span class="n">vidx2a</span><span class="p">,</span><span class="n">vidx2b</span><span class="p">,</span><span class="n">vidx1b</span><span class="p">)</span>
</span><span id="__span-81-65"><a id="__codelineno-81-65" name="__codelineno-81-65" href="#__codelineno-81-65"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2a</span><span class="p">,</span><span class="n">vidx3a</span><span class="p">,</span><span class="n">vidx3b</span><span class="p">,</span><span class="n">vidx2b</span><span class="p">)</span>
</span><span id="__span-81-66"><a id="__codelineno-81-66" name="__codelineno-81-66" href="#__codelineno-81-66"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3a</span><span class="p">,</span><span class="n">vidx1a</span><span class="p">,</span><span class="n">vidx1b</span><span class="p">,</span><span class="n">vidx3b</span><span class="p">)</span>
</span><span id="__span-81-67"><a id="__codelineno-81-67" name="__codelineno-81-67" href="#__codelineno-81-67"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1a</span><span class="p">,</span><span class="n">vidx3a</span><span class="p">,</span><span class="n">vidx2a</span><span class="p">)</span>
</span><span id="__span-81-68"><a id="__codelineno-81-68" name="__codelineno-81-68" href="#__codelineno-81-68"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1b</span><span class="p">,</span><span class="n">vidx2b</span><span class="p">,</span><span class="n">vidx3b</span><span class="p">)</span>
</span><span id="__span-81-69"><a id="__codelineno-81-69" name="__codelineno-81-69" href="#__codelineno-81-69"></a>        <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-81-70"><a id="__codelineno-81-70" name="__codelineno-81-70" href="#__codelineno-81-70"></a>        <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh2</span><span class="p">)</span>
</span><span id="__span-81-71"><a id="__codelineno-81-71" name="__codelineno-81-71" href="#__codelineno-81-71"></a>        <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-81-72"><a id="__codelineno-81-72" name="__codelineno-81-72" href="#__codelineno-81-72"></a>            <span class="n">offsetMesh</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">height</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-81-73"><a id="__codelineno-81-73" name="__codelineno-81-73" href="#__codelineno-81-73"></a>
</span><span id="__span-81-74"><a id="__codelineno-81-74" name="__codelineno-81-74" href="#__codelineno-81-74"></a><span class="k">def</span><span class="w"> </span><span class="nf">attractorValue</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span> <span class="c1"># calculate value of 0-1 by attractors</span>
</span><span id="__span-81-75"><a id="__codelineno-81-75" name="__codelineno-81-75" href="#__codelineno-81-75"></a>    <span class="n">minDist</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-81-76"><a id="__codelineno-81-76" name="__codelineno-81-76" href="#__codelineno-81-76"></a>    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attractors</span><span class="p">:</span> <span class="c1"># find closest attractor</span>
</span><span id="__span-81-77"><a id="__codelineno-81-77" name="__codelineno-81-77" href="#__codelineno-81-77"></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span><span id="__span-81-78"><a id="__codelineno-81-78" name="__codelineno-81-78" href="#__codelineno-81-78"></a>        <span class="k">if</span><span class="p">(</span> <span class="n">minDist</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">minDist</span> <span class="p">):</span>
</span><span id="__span-81-79"><a id="__codelineno-81-79" name="__codelineno-81-79" href="#__codelineno-81-79"></a>            <span class="n">minDist</span> <span class="o">=</span> <span class="n">dist</span>
</span><span id="__span-81-80"><a id="__codelineno-81-80" name="__codelineno-81-80" href="#__codelineno-81-80"></a>    <span class="k">if</span><span class="p">(</span><span class="n">minDist</span> <span class="o">&lt;</span> <span class="n">attractorRange</span><span class="p">):</span> <span class="c1"># check range and scale value to 0 - 1</span>
</span><span id="__span-81-81"><a id="__codelineno-81-81" name="__codelineno-81-81" href="#__codelineno-81-81"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">attractorRange</span> <span class="o">-</span> <span class="n">minDist</span><span class="p">)</span><span class="o">/</span><span class="n">attractorRange</span> <span class="c1"># value from 0 to 1</span>
</span><span id="__span-81-82"><a id="__codelineno-81-82" name="__codelineno-81-82" href="#__codelineno-81-82"></a>    <span class="k">return</span> <span class="mi">0</span> <span class="c1"># when out of range</span>
</span><span id="__span-81-83"><a id="__codelineno-81-83" name="__codelineno-81-83" href="#__codelineno-81-83"></a>
</span><span id="__span-81-84"><a id="__codelineno-81-84" name="__codelineno-81-84" href="#__codelineno-81-84"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-81-85"><a id="__codelineno-81-85" name="__codelineno-81-85" href="#__codelineno-81-85"></a><span class="n">offsetMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div>
- TBD</p>
<p>7.26 Subdivision 23: Polyhedron Face Offset with Randomness
<div class="language-PY highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="c1"># offset polyhedron mesh from faces</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), recursionLevel : int (Item Access), probability : float (Item Access), </span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="c1"># offsetDepth : float (Item Access), height : float (Item Access), scale : float (Item Access)</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">offsetMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">resultList</span><span class="p">):</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>    <span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span> <span class="c1"># in case FaceNormals are missing</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span> <span class="c1"># get all vertices in a list</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="n">probability</span> <span class="p">:</span> <span class="c1"># randomly adding faces</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a>            <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a>            <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">IsQuad</span><span class="p">:</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16" href="#__codelineno-82-16"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="p">]</span>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17" href="#__codelineno-82-17"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>
</span><span id="__span-82-18"><a id="__codelineno-82-18" name="__codelineno-82-18" href="#__codelineno-82-18"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
</span><span id="__span-82-19"><a id="__codelineno-82-19" name="__codelineno-82-19" href="#__codelineno-82-19"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">D</span><span class="p">]</span>
</span><span id="__span-82-20"><a id="__codelineno-82-20" name="__codelineno-82-20" href="#__codelineno-82-20"></a>                <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">+</span><span class="n">v2</span><span class="o">+</span><span class="n">v3</span><span class="o">+</span><span class="n">v4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
</span><span id="__span-82-21"><a id="__codelineno-82-21" name="__codelineno-82-21" href="#__codelineno-82-21"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-82-22"><a id="__codelineno-82-22" name="__codelineno-82-22" href="#__codelineno-82-22"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-82-23"><a id="__codelineno-82-23" name="__codelineno-82-23" href="#__codelineno-82-23"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-82-24"><a id="__codelineno-82-24" name="__codelineno-82-24" href="#__codelineno-82-24"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span> <span class="o">-</span> <span class="n">v5</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-82-25"><a id="__codelineno-82-25" name="__codelineno-82-25" href="#__codelineno-82-25"></a>                <span class="n">v5</span> <span class="o">=</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span>
</span><span id="__span-82-26"><a id="__codelineno-82-26" name="__codelineno-82-26" href="#__codelineno-82-26"></a>                <span class="n">v6</span> <span class="o">=</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span>
</span><span id="__span-82-27"><a id="__codelineno-82-27" name="__codelineno-82-27" href="#__codelineno-82-27"></a>                <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="c1"># 4 side vertices</span>
</span><span id="__span-82-28"><a id="__codelineno-82-28" name="__codelineno-82-28" href="#__codelineno-82-28"></a>                <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span><span id="__span-82-29"><a id="__codelineno-82-29" name="__codelineno-82-29" href="#__codelineno-82-29"></a>                <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</span><span id="__span-82-30"><a id="__codelineno-82-30" name="__codelineno-82-30" href="#__codelineno-82-30"></a>                <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span>
</span><span id="__span-82-31"><a id="__codelineno-82-31" name="__codelineno-82-31" href="#__codelineno-82-31"></a>                <span class="n">vidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span> <span class="c1"># bottom vertex</span>
</span><span id="__span-82-32"><a id="__codelineno-82-32" name="__codelineno-82-32" href="#__codelineno-82-32"></a>                <span class="n">vidx6</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v6</span><span class="p">)</span> <span class="c1"># top vertex</span>
</span><span id="__span-82-33"><a id="__codelineno-82-33" name="__codelineno-82-33" href="#__codelineno-82-33"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-82-34"><a id="__codelineno-82-34" name="__codelineno-82-34" href="#__codelineno-82-34"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-82-35"><a id="__codelineno-82-35" name="__codelineno-82-35" href="#__codelineno-82-35"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-82-36"><a id="__codelineno-82-36" name="__codelineno-82-36" href="#__codelineno-82-36"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-82-37"><a id="__codelineno-82-37" name="__codelineno-82-37" href="#__codelineno-82-37"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx6</span><span class="p">)</span>
</span><span id="__span-82-38"><a id="__codelineno-82-38" name="__codelineno-82-38" href="#__codelineno-82-38"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx6</span><span class="p">)</span>
</span><span id="__span-82-39"><a id="__codelineno-82-39" name="__codelineno-82-39" href="#__codelineno-82-39"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx6</span><span class="p">)</span>
</span><span id="__span-82-40"><a id="__codelineno-82-40" name="__codelineno-82-40" href="#__codelineno-82-40"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx4</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx6</span><span class="p">)</span>
</span><span id="__span-82-41"><a id="__codelineno-82-41" name="__codelineno-82-41" href="#__codelineno-82-41"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-82-42"><a id="__codelineno-82-42" name="__codelineno-82-42" href="#__codelineno-82-42"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">FaceNormals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-82-43"><a id="__codelineno-82-43" name="__codelineno-82-43" href="#__codelineno-82-43"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="p">]</span>
</span><span id="__span-82-44"><a id="__codelineno-82-44" name="__codelineno-82-44" href="#__codelineno-82-44"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>
</span><span id="__span-82-45"><a id="__codelineno-82-45" name="__codelineno-82-45" href="#__codelineno-82-45"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">C</span><span class="p">]</span>
</span><span id="__span-82-46"><a id="__codelineno-82-46" name="__codelineno-82-46" href="#__codelineno-82-46"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2</span> <span class="o">+</span> <span class="n">v3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
</span><span id="__span-82-47"><a id="__codelineno-82-47" name="__codelineno-82-47" href="#__codelineno-82-47"></a>                <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-82-48"><a id="__codelineno-82-48" name="__codelineno-82-48" href="#__codelineno-82-48"></a>                <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-82-49"><a id="__codelineno-82-49" name="__codelineno-82-49" href="#__codelineno-82-49"></a>                <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="n">v4</span><span class="p">)</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">offset</span>
</span><span id="__span-82-50"><a id="__codelineno-82-50" name="__codelineno-82-50" href="#__codelineno-82-50"></a>                <span class="n">v4</span> <span class="o">=</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span>
</span><span id="__span-82-51"><a id="__codelineno-82-51" name="__codelineno-82-51" href="#__codelineno-82-51"></a>                <span class="n">v5</span> <span class="o">=</span> <span class="n">v4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span>
</span><span id="__span-82-52"><a id="__codelineno-82-52" name="__codelineno-82-52" href="#__codelineno-82-52"></a>                <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="c1"># 3 side vertices</span>
</span><span id="__span-82-53"><a id="__codelineno-82-53" name="__codelineno-82-53" href="#__codelineno-82-53"></a>                <span class="n">vidx2</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
</span><span id="__span-82-54"><a id="__codelineno-82-54" name="__codelineno-82-54" href="#__codelineno-82-54"></a>                <span class="n">vidx3</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>
</span><span id="__span-82-55"><a id="__codelineno-82-55" name="__codelineno-82-55" href="#__codelineno-82-55"></a>                <span class="n">vidx4</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span> <span class="c1"># bottom vertex</span>
</span><span id="__span-82-56"><a id="__codelineno-82-56" name="__codelineno-82-56" href="#__codelineno-82-56"></a>                <span class="n">vidx5</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span> <span class="c1"># top vertex</span>
</span><span id="__span-82-57"><a id="__codelineno-82-57" name="__codelineno-82-57" href="#__codelineno-82-57"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-82-58"><a id="__codelineno-82-58" name="__codelineno-82-58" href="#__codelineno-82-58"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-82-59"><a id="__codelineno-82-59" name="__codelineno-82-59" href="#__codelineno-82-59"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx4</span><span class="p">)</span>
</span><span id="__span-82-60"><a id="__codelineno-82-60" name="__codelineno-82-60" href="#__codelineno-82-60"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-82-61"><a id="__codelineno-82-61" name="__codelineno-82-61" href="#__codelineno-82-61"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx2</span><span class="p">,</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-82-62"><a id="__codelineno-82-62" name="__codelineno-82-62" href="#__codelineno-82-62"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">vidx3</span><span class="p">,</span><span class="n">vidx1</span><span class="p">,</span><span class="n">vidx5</span><span class="p">)</span>
</span><span id="__span-82-63"><a id="__codelineno-82-63" name="__codelineno-82-63" href="#__codelineno-82-63"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-82-64"><a id="__codelineno-82-64" name="__codelineno-82-64" href="#__codelineno-82-64"></a>            <span class="n">resultList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh2</span><span class="p">)</span>
</span><span id="__span-82-65"><a id="__codelineno-82-65" name="__codelineno-82-65" href="#__codelineno-82-65"></a>            <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-82-66"><a id="__codelineno-82-66" name="__codelineno-82-66" href="#__codelineno-82-66"></a>                <span class="n">offsetMesh</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">resultList</span><span class="p">)</span>
</span><span id="__span-82-67"><a id="__codelineno-82-67" name="__codelineno-82-67" href="#__codelineno-82-67"></a>
</span><span id="__span-82-68"><a id="__codelineno-82-68" name="__codelineno-82-68" href="#__codelineno-82-68"></a><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-82-69"><a id="__codelineno-82-69" name="__codelineno-82-69" href="#__codelineno-82-69"></a><span class="n">offsetMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">recursionLevel</span><span class="p">,</span> <span class="n">offsetDepth</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></code></pre></div></p>
<p>-TBD</p>
<h4 id="727-subdivision-24-vertex-based-subdivision-1">7.27 Subdivision 24: Vertex-Based Subdivision 1</h4>
<div class="language-PY highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># subdivide mesh by adding faces around vertices</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), depth : int (Item Access), offset : float (Item Access)</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a>    <span class="n">vnum</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="o">.</span><span class="n">Count</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span> <span class="c1"># convert topology vertices into Point3d</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a>        <span class="n">vtx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a>    <span class="n">edgePts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a>        <span class="n">vidcs</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="o">.</span><span class="n">ConnectedTopologyVertices</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># vertex with connection info</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a>        <span class="n">nml</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="o">.</span><span class="n">MeshVertexIndices</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># normal at topology vertex</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a>        <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">nml</span><span class="p">)</span> <span class="o">*</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a>        <span class="n">vidx2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a>        <span class="n">edgePts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># to remember mid points on edges</span>
</span><span id="__span-83-19"><a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vidcs</span><span class="p">:</span>
</span><span id="__span-83-20"><a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a>            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">edgePts</span><span class="p">:</span> <span class="c1"># mid point already exists</span>
</span><span id="__span-83-21"><a id="__codelineno-83-21" name="__codelineno-83-21" href="#__codelineno-83-21"></a>                <span class="n">evidx</span> <span class="o">=</span> <span class="n">edgePts</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-83-22"><a id="__codelineno-83-22" name="__codelineno-83-22" href="#__codelineno-83-22"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-83-23"><a id="__codelineno-83-23" name="__codelineno-83-23" href="#__codelineno-83-23"></a>                <span class="n">evidx</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">vtx</span><span class="p">[</span><span class="n">v</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1"># add new mid point</span>
</span><span id="__span-83-24"><a id="__codelineno-83-24" name="__codelineno-83-24" href="#__codelineno-83-24"></a>                <span class="n">edgePts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">evidx</span> <span class="c1"># add new vertex</span>
</span><span id="__span-83-25"><a id="__codelineno-83-25" name="__codelineno-83-25" href="#__codelineno-83-25"></a>            <span class="n">vidx2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">evidx</span><span class="p">)</span>
</span><span id="__span-83-26"><a id="__codelineno-83-26" name="__codelineno-83-26" href="#__codelineno-83-26"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)):</span> <span class="c1"># add triangular faces around a vertex</span>
</span><span id="__span-83-27"><a id="__codelineno-83-27" name="__codelineno-83-27" href="#__codelineno-83-27"></a>            <span class="n">dir1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">vidx2</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="o">-</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-83-28"><a id="__codelineno-83-28" name="__codelineno-83-28" href="#__codelineno-83-28"></a>            <span class="n">dir2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">vidx2</span><span class="p">[(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)]])</span> <span class="o">-</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-83-29"><a id="__codelineno-83-29" name="__codelineno-83-29" href="#__codelineno-83-29"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">dir1</span><span class="p">,</span> <span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-83-30"><a id="__codelineno-83-30" name="__codelineno-83-30" href="#__codelineno-83-30"></a>            <span class="k">if</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">Multiply</span><span class="p">(</span><span class="n">nml</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># exclude adding face on naked edges</span>
</span><span id="__span-83-31"><a id="__codelineno-83-31" name="__codelineno-83-31" href="#__codelineno-83-31"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span> <span class="n">vidx1</span><span class="p">,</span> <span class="n">vidx2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vidx2</span><span class="p">[(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)]</span> <span class="p">)</span>
</span><span id="__span-83-32"><a id="__codelineno-83-32" name="__codelineno-83-32" href="#__codelineno-83-32"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-83-33"><a id="__codelineno-83-33" name="__codelineno-83-33" href="#__codelineno-83-33"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-83-34"><a id="__codelineno-83-34" name="__codelineno-83-34" href="#__codelineno-83-34"></a>    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-83-35"><a id="__codelineno-83-35" name="__codelineno-83-35" href="#__codelineno-83-35"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-83-36"><a id="__codelineno-83-36" name="__codelineno-83-36" href="#__codelineno-83-36"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-83-37"><a id="__codelineno-83-37" name="__codelineno-83-37" href="#__codelineno-83-37"></a>
</span><span id="__span-83-38"><a id="__codelineno-83-38" name="__codelineno-83-38" href="#__codelineno-83-38"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span></code></pre></div>
<p>-TBD</p>
<h4 id="728-subdivision-25-vertex-based-subdivision-2">7.28 Subdivision 25: Vertex-Based Subdivision 2</h4>
<div class="language-PY highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1"># subdivide mesh by adding faces around vertices</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), depth : float (Item Access), </span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="c1"># offset : float (Item Access), ratio : float (Item Access)</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>    <span class="n">vnum</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="o">.</span><span class="n">Count</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span> <span class="c1"># convert topology vertices into Point3d</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a>        <span class="n">vtx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a>        <span class="n">vidcs</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="o">.</span><span class="n">ConnectedTopologyVertices</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># vertex with connection info</span>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a>        <span class="n">nml</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Normals</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="o">.</span><span class="n">MeshVertexIndices</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># normal at topology vertex</span>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a>        <span class="n">vidx1</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">nml</span><span class="p">)</span> <span class="o">*</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a>        <span class="n">vidx2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vidcs</span><span class="p">:</span>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a>            <span class="n">evidx</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio</span><span class="p">)</span><span class="o">+</span><span class="n">vtx</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">*</span><span class="n">ratio</span> <span class="p">)</span> <span class="p">)</span> <span class="c1"># add vertex on edge</span>
</span><span id="__span-84-20"><a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a>            <span class="n">vidx2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">evidx</span><span class="p">)</span>
</span><span id="__span-84-21"><a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)):</span> <span class="c1"># add triangular faces around a vertex</span>
</span><span id="__span-84-22"><a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a>            <span class="n">dir1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">vidx2</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="o">-</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-84-23"><a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a>            <span class="n">dir2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">vidx2</span><span class="p">[(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)]])</span> <span class="o">-</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-84-24"><a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">dir1</span><span class="p">,</span> <span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-84-25"><a id="__codelineno-84-25" name="__codelineno-84-25" href="#__codelineno-84-25"></a>            <span class="k">if</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">Multiply</span><span class="p">(</span><span class="n">nml</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># exclude adding face on naked edges</span>
</span><span id="__span-84-26"><a id="__codelineno-84-26" name="__codelineno-84-26" href="#__codelineno-84-26"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span> <span class="n">vidx1</span><span class="p">,</span> <span class="n">vidx2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vidx2</span><span class="p">[(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)]</span> <span class="p">)</span>
</span><span id="__span-84-27"><a id="__codelineno-84-27" name="__codelineno-84-27" href="#__codelineno-84-27"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-84-28"><a id="__codelineno-84-28" name="__codelineno-84-28" href="#__codelineno-84-28"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-84-29"><a id="__codelineno-84-29" name="__codelineno-84-29" href="#__codelineno-84-29"></a>    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-84-30"><a id="__codelineno-84-30" name="__codelineno-84-30" href="#__codelineno-84-30"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">offset</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-84-31"><a id="__codelineno-84-31" name="__codelineno-84-31" href="#__codelineno-84-31"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-84-32"><a id="__codelineno-84-32" name="__codelineno-84-32" href="#__codelineno-84-32"></a>
</span><span id="__span-84-33"><a id="__codelineno-84-33" name="__codelineno-84-33" href="#__codelineno-84-33"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="729-subdivision-26-vertex-based-polyhedron-subdivision">7.29 Subdivision 26: Vertex-Based Polyhedron Subdivision</h4>
<div class="language-PY highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c1"># subdivide mesh by adding polyhedron faces around vertices</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), depth : int (Item Access), ratio : float (Item Access),</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="c1"># offset1 : float (Item Access), offset2 : float (Item Access)</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">):</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># create a new mesh</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a>    <span class="n">vnum</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="o">.</span><span class="n">Count</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span> <span class="c1"># convert topology vertices into Point3d</span>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a>        <span class="n">vtx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vnum</span><span class="p">):</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a>        <span class="n">vidcs</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">TopologyVertices</span><span class="o">.</span><span class="n">ConnectedTopologyVertices</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># vertex with connection info</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a>        <span class="n">nml</span> <span class="o">=</span> <span class="n">averageNormal</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">vidcs</span><span class="p">)</span> <span class="c1"># calculate normal from connected vertices</span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a>        <span class="n">vidx1a</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">nml</span><span class="p">)</span><span class="o">*</span><span class="n">offset1</span><span class="p">)</span> <span class="c1"># new top vertex</span>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a>        <span class="n">vidx1b</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="n">nml</span><span class="p">)</span><span class="o">*</span><span class="n">offset2</span><span class="p">)</span> <span class="c1"># new bottom vertex</span>
</span><span id="__span-85-18"><a id="__codelineno-85-18" name="__codelineno-85-18" href="#__codelineno-85-18"></a>        <span class="n">vidx2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-85-19"><a id="__codelineno-85-19" name="__codelineno-85-19" href="#__codelineno-85-19"></a>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vidcs</span><span class="p">:</span>
</span><span id="__span-85-20"><a id="__codelineno-85-20" name="__codelineno-85-20" href="#__codelineno-85-20"></a>            <span class="n">evidx</span> <span class="o">=</span> <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ratio</span><span class="p">)</span><span class="o">+</span><span class="n">vtx</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">*</span><span class="n">ratio</span> <span class="p">)</span> <span class="c1"># add vertex on edge</span>
</span><span id="__span-85-21"><a id="__codelineno-85-21" name="__codelineno-85-21" href="#__codelineno-85-21"></a>            <span class="n">vidx2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">evidx</span><span class="p">)</span>
</span><span id="__span-85-22"><a id="__codelineno-85-22" name="__codelineno-85-22" href="#__codelineno-85-22"></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)):</span>
</span><span id="__span-85-23"><a id="__codelineno-85-23" name="__codelineno-85-23" href="#__codelineno-85-23"></a>            <span class="n">dir1</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">vidx2</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="o">-</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-85-24"><a id="__codelineno-85-24" name="__codelineno-85-24" href="#__codelineno-85-24"></a>            <span class="n">dir2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Point3d</span><span class="p">(</span><span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">vidx2</span><span class="p">[(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)]])</span> <span class="o">-</span> <span class="n">vtx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-85-25"><a id="__codelineno-85-25" name="__codelineno-85-25" href="#__codelineno-85-25"></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">dir1</span><span class="p">,</span> <span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-85-26"><a id="__codelineno-85-26" name="__codelineno-85-26" href="#__codelineno-85-26"></a>            <span class="k">if</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">Multiply</span><span class="p">(</span><span class="n">nml</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># add polyhedron faces</span>
</span><span id="__span-85-27"><a id="__codelineno-85-27" name="__codelineno-85-27" href="#__codelineno-85-27"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span> <span class="n">vidx1a</span><span class="p">,</span> <span class="n">vidx2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vidx2</span><span class="p">[(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)]</span> <span class="p">)</span>
</span><span id="__span-85-28"><a id="__codelineno-85-28" name="__codelineno-85-28" href="#__codelineno-85-28"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span> <span class="n">vidx1b</span><span class="p">,</span> <span class="n">vidx2</span><span class="p">[(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)],</span> <span class="n">vidx2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
</span><span id="__span-85-29"><a id="__codelineno-85-29" name="__codelineno-85-29" href="#__codelineno-85-29"></a>            <span class="k">else</span><span class="p">:</span> <span class="c1"># close faces on naked edge</span>
</span><span id="__span-85-30"><a id="__codelineno-85-30" name="__codelineno-85-30" href="#__codelineno-85-30"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span> <span class="n">vidx1a</span><span class="p">,</span> <span class="n">vidx2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vidx1b</span> <span class="p">)</span>
</span><span id="__span-85-31"><a id="__codelineno-85-31" name="__codelineno-85-31" href="#__codelineno-85-31"></a>                <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span> <span class="n">vidx1a</span><span class="p">,</span> <span class="n">vidx1b</span><span class="p">,</span> <span class="n">vidx2</span><span class="p">[(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">vidx2</span><span class="p">)]</span> <span class="p">)</span>
</span><span id="__span-85-32"><a id="__codelineno-85-32" name="__codelineno-85-32" href="#__codelineno-85-32"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-85-33"><a id="__codelineno-85-33" name="__codelineno-85-33" href="#__codelineno-85-33"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Weld</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-85-34"><a id="__codelineno-85-34" name="__codelineno-85-34" href="#__codelineno-85-34"></a>    <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-85-35"><a id="__codelineno-85-35" name="__codelineno-85-35" href="#__codelineno-85-35"></a>        <span class="k">return</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">offset1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-85-36"><a id="__codelineno-85-36" name="__codelineno-85-36" href="#__codelineno-85-36"></a>    <span class="k">return</span> <span class="n">mesh2</span>
</span><span id="__span-85-37"><a id="__codelineno-85-37" name="__codelineno-85-37" href="#__codelineno-85-37"></a>
</span><span id="__span-85-38"><a id="__codelineno-85-38" name="__codelineno-85-38" href="#__codelineno-85-38"></a><span class="k">def</span><span class="w"> </span><span class="nf">averageNormal</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">centerIdx</span><span class="p">,</span> <span class="n">linkIdx</span><span class="p">):</span> <span class="c1"># calculate normal from sorted linked vertices</span>
</span><span id="__span-85-39"><a id="__codelineno-85-39" name="__codelineno-85-39" href="#__codelineno-85-39"></a>    <span class="n">nml</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-85-40"><a id="__codelineno-85-40" name="__codelineno-85-40" href="#__codelineno-85-40"></a>    <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linkIdx</span><span class="p">)</span>
</span><span id="__span-85-41"><a id="__codelineno-85-41" name="__codelineno-85-41" href="#__codelineno-85-41"></a>    <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># if only 2 vertices, calc only 1 normal</span>
</span><span id="__span-85-42"><a id="__codelineno-85-42" name="__codelineno-85-42" href="#__codelineno-85-42"></a>        <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-85-43"><a id="__codelineno-85-43" name="__codelineno-85-43" href="#__codelineno-85-43"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="__span-85-44"><a id="__codelineno-85-44" name="__codelineno-85-44" href="#__codelineno-85-44"></a>        <span class="n">dir1</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">linkIdx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-</span> <span class="n">vtx</span><span class="p">[</span><span class="n">centerIdx</span><span class="p">]</span>
</span><span id="__span-85-45"><a id="__codelineno-85-45" name="__codelineno-85-45" href="#__codelineno-85-45"></a>        <span class="n">dir2</span> <span class="o">=</span> <span class="n">vtx</span><span class="p">[</span><span class="n">linkIdx</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">linkIdx</span><span class="p">)]]</span> <span class="o">-</span> <span class="n">vtx</span><span class="p">[</span><span class="n">centerIdx</span><span class="p">]</span>
</span><span id="__span-85-46"><a id="__codelineno-85-46" name="__codelineno-85-46" href="#__codelineno-85-46"></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">CrossProduct</span><span class="p">(</span><span class="n">dir1</span><span class="p">,</span> <span class="n">dir2</span><span class="p">)</span>
</span><span id="__span-85-47"><a id="__codelineno-85-47" name="__codelineno-85-47" href="#__codelineno-85-47"></a>        <span class="n">n</span><span class="o">.</span><span class="n">Unitize</span><span class="p">()</span>
</span><span id="__span-85-48"><a id="__codelineno-85-48" name="__codelineno-85-48" href="#__codelineno-85-48"></a>        <span class="n">nml</span> <span class="o">+=</span> <span class="n">n</span>
</span><span id="__span-85-49"><a id="__codelineno-85-49" name="__codelineno-85-49" href="#__codelineno-85-49"></a>    <span class="k">return</span> <span class="n">nml</span>
</span><span id="__span-85-50"><a id="__codelineno-85-50" name="__codelineno-85-50" href="#__codelineno-85-50"></a>
</span><span id="__span-85-51"><a id="__codelineno-85-51" name="__codelineno-85-51" href="#__codelineno-85-51"></a><span class="n">a</span> <span class="o">=</span> <span class="n">subdivide</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">offset1</span><span class="p">,</span> <span class="n">offset2</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="730-custom-mesh-tool-1-dispatch-faces-randomly">7.30 Custom Mesh Tool 1: Dispatch Faces Randomly</h4>
<div class="language-PY highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), probability : float (Item Access)</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span><span class="n">mesh</span><span class="p">):</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># new mesh</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a>    <span class="n">mesh3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># another new mesh</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">AddVertices</span><span class="p">(</span><span class="n">vtx</span><span class="p">)</span> <span class="c1"># add all vertices</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a>    <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">AddVertices</span><span class="p">(</span><span class="n">vtx</span><span class="p">)</span> <span class="c1"># add all vertices</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;</span> <span class="n">probability</span><span class="p">:</span> <span class="c1"># probabilistic switch with randomness</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a>            <span class="n">mesh3</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a>    <span class="n">mesh3</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">mesh3</span><span class="p">]</span> <span class="n">returns</span> <span class="n">two</span> <span class="n">meshes</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">dispatch</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="731-custom-mesh-tool-2-dispatch-faces-by-attractors">7.31 Custom Mesh Tool 2: Dispatch Faces by Attractors</h4>
<div class="language-PY highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="c1"># move each vertex by the closest attractor and create a new mesh</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="c1"># input type - mesh : Mesh (Item Access), attractors : Point3d (List Access), attractorRange : float (Item Access)</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">rhinoscriptsyntax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rs</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">Rhino.Geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rg</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span><span class="n">mesh</span><span class="p">):</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>    <span class="n">mesh2</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># new mesh</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a>    <span class="n">mesh3</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Mesh</span><span class="p">()</span> <span class="c1"># another new mesh</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">AddVertices</span><span class="p">(</span><span class="n">vtx</span><span class="p">)</span> <span class="c1"># add all vertices</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a>    <span class="n">mesh3</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">AddVertices</span><span class="p">(</span><span class="n">vtx</span><span class="p">)</span> <span class="c1"># add all vertices</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">Count</span><span class="p">):</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a>        <span class="k">if</span> <span class="n">isAttractorInRange</span><span class="p">(</span><span class="n">faceCenter</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span> <span class="c1"># if face center is within attractor range</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a>            <span class="n">mesh2</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a>            <span class="n">mesh3</span><span class="o">.</span><span class="n">Faces</span><span class="o">.</span><span class="n">AddFace</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a>    <span class="n">mesh2</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a>    <span class="n">mesh3</span><span class="o">.</span><span class="n">Normals</span><span class="o">.</span><span class="n">ComputeNormals</span><span class="p">()</span>
</span><span id="__span-87-21"><a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">mesh2</span><span class="p">,</span> <span class="n">mesh3</span><span class="p">]</span>
</span><span id="__span-87-22"><a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a>
</span><span id="__span-87-23"><a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a><span class="k">def</span><span class="w"> </span><span class="nf">faceCenter</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">face</span><span class="p">):</span>
</span><span id="__span-87-24"><a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a>    <span class="n">vtx</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">Vertices</span><span class="o">.</span><span class="n">ToPoint3dArray</span><span class="p">()</span>
</span><span id="__span-87-25"><a id="__codelineno-87-25" name="__codelineno-87-25" href="#__codelineno-87-25"></a>    <span class="k">if</span> <span class="n">face</span><span class="o">.</span><span class="n">IsTriangle</span><span class="p">:</span>
</span><span id="__span-87-26"><a id="__codelineno-87-26" name="__codelineno-87-26" href="#__codelineno-87-26"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">A</span><span class="p">]</span> <span class="o">+</span> <span class="n">vtx</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">B</span><span class="p">]</span> <span class="o">+</span> <span class="n">vtx</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">C</span><span class="p">])</span><span class="o">/</span><span class="mi">3</span> <span class="c1"># center of 3 vertices</span>
</span><span id="__span-87-27"><a id="__codelineno-87-27" name="__codelineno-87-27" href="#__codelineno-87-27"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">vtx</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">A</span><span class="p">]</span> <span class="o">+</span> <span class="n">vtx</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">B</span><span class="p">]</span> <span class="o">+</span> <span class="n">vtx</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">C</span><span class="p">]</span> <span class="o">+</span> <span class="n">vtx</span><span class="p">[</span><span class="n">face</span><span class="o">.</span><span class="n">D</span><span class="p">])</span><span class="o">/</span><span class="mi">4</span> <span class="c1"># center of 4 vertices</span>
</span><span id="__span-87-28"><a id="__codelineno-87-28" name="__codelineno-87-28" href="#__codelineno-87-28"></a>
</span><span id="__span-87-29"><a id="__codelineno-87-29" name="__codelineno-87-29" href="#__codelineno-87-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">isAttractorInRange</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span> <span class="c1"># check if any attractor is in range</span>
</span><span id="__span-87-30"><a id="__codelineno-87-30" name="__codelineno-87-30" href="#__codelineno-87-30"></a>    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attractors</span><span class="p">:</span> 
</span><span id="__span-87-31"><a id="__codelineno-87-31" name="__codelineno-87-31" href="#__codelineno-87-31"></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</span><span id="__span-87-32"><a id="__codelineno-87-32" name="__codelineno-87-32" href="#__codelineno-87-32"></a>        <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">attractorRange</span> <span class="p">:</span>
</span><span id="__span-87-33"><a id="__codelineno-87-33" name="__codelineno-87-33" href="#__codelineno-87-33"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-87-34"><a id="__codelineno-87-34" name="__codelineno-87-34" href="#__codelineno-87-34"></a>    <span class="k">return</span> <span class="kc">False</span> <span class="c1"># when out of range</span>
</span><span id="__span-87-35"><a id="__codelineno-87-35" name="__codelineno-87-35" href="#__codelineno-87-35"></a>
</span><span id="__span-87-36"><a id="__codelineno-87-36" name="__codelineno-87-36" href="#__codelineno-87-36"></a><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">dispatch</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="7323334-custom-subdivision-combination-example-1">7.32/33/34  Custom Subdivision Combination Example 1</h4>
<div class="language-PY highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="n">组合技巧</span><span class="err">，</span><span class="n">再整理</span>
</span></code></pre></div>


  <nav class="md-tags" >
    
      
      
      
        
        
          
        
      
      
        <span class="md-tag md-tag-icon md-tag--rhino">Rhino</span>
      
    
      
      
      
        
        
      
      
        <span class="md-tag md-tag-icon">grasshopper</span>
      
    
  </nav>








  
  



  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-circle-arrow-up" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4M12 16V8"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <!-- Footer -->
<footer class="md-footer">

    <!-- Link to previous and/or next page -->
    
    
    
    <nav class="md-footer__inner md-grid" aria-label="页脚" >

        <!-- Link to previous page -->
        
        
        <a href="../Grasshooper%E5%85%A5%E9%97%A8%E4%B8%8E%E6%8F%90%E9%AB%98/" aria-label="上一页: Grasshooper入门与提高">
            <div class="md-footer__direction">
                ◀ Grasshooper入门与提高
            </div>
        </a>
        

        <!-- Link to next page -->
        
        
        <a href="../Rhino%20Python%20Primer%20101%20%E7%AC%AC8%E7%AB%A0/Rhino-Python-Primer-101-%E7%AC%AC8%E7%AB%A01%E8%8A%82/" aria-label="下一页: 8.1 openNURB(tm)内核">
            <div class="md-footer__direction">
                8.1 openNURB(tm)内核 ▶
            </div>
        </a>
        
    </nav>
    
    
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      
      <script id="__config" type="application/json">{"annotate":null,"base":"../..","features":["announce.dismiss","content.code.annotate","content.code.copy","content.code.select","content.footnote.tooltips","content.tabs.link","content.tooltips","navigation.footer","navigation.indexes","navigation.instant","navigation.instant.prefetch","navigation.path","navigation.sections","navigation.tabs","navigation.tabs.sticky","navigation.top","navigation.tracking","search.highlight","toc.follow"],"search":"../../assets/javascripts/workers/search.e2d2d235.min.js","tags":{"Life":"life","Python":"py","Rhino":"rhino"},"translations":{"clipboard.copied":"已复制","clipboard.copy":"复制","search.result.more.one":"在该页上还有 1 个符合条件的结果","search.result.more.other":"在该页上还有 # 个符合条件的结果","search.result.none":"没有找到符合条件的结果","search.result.one":"找到 1 个符合条件的结果","search.result.other":"# 个符合条件的结果","search.result.placeholder":"键入以开始搜索","search.result.term.missing":"缺少","select.version":"选择当前版本"},"version":null}</script>
    
    
      <script src="../../assets/javascripts/bundle.00c35305.min.js"></script>
      
        <script src="../../assets/js/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>